import{_ as g}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,b as n,t as v,e,n as y,g as b,w as a,d as s,f as r,r as i,o as f}from"./app-BgNevrm5.js";const w={},_={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},I={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},x={class:"table-of-contents"},M=n("hr",null,null,-1),q=n("p",null,"As your application grows, you might find yourself considering a move from a modular monolith to microservices. This transition isn't just a technical shift. It's a strategic move that can reshape how your entire system operates. But let's be clear: it's not a magic solution and comes with its own challenges.",-1),A=n("p",null,"In this article, I'll share my experience of migrating from a modular monolith to microservices.",-1),T=n("p",null,"We'll explore why you might consider microservices, how to prepare for the migration and the critical steps in the migration process - from choosing your first module to implementing inter-service communication and managing data migration.",-1),P=n("p",null,"Let's dive in!",-1),j=n("hr",null,null,-1),S=n("h2",{id:"why-consider-microservices",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#why-consider-microservices"},[n("span",null,"Why Consider Microservices?")])],-1),R=n("strong",null,"modular monolith",-1),B=r(`<p>Here are the key challenges I&#39;ve encountered with modular monoliths:</p><ul><li>High-load modules can become bottlenecks, affecting the entire system&#39;s performance</li><li>As the monolith grows, deployments become riskier and more time-consuming</li><li>Large teams working on a single codebase often step on each other&#39;s toes</li><li>You&#39;re locked into a single technology stack for the entire application</li></ul><p>Microservices can address these issues, but it&#39;s not a decision to be taken lightly.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_109/modular_monolith_vs_microservices.png?imwidth=3840" alt="Modular monolith to microservices comparison." tabindex="0" loading="lazy"><figcaption>Modular monolith to microservices comparison.</figcaption></figure><p>Here&#39;s how microservices can help:</p><ul><li><strong>Scalability</strong>: You can scale individual services based on their specific load, optimizing resource use.</li><li><strong>Independent deployability</strong>: Updates to one service don&#39;t require redeploying the entire application, reducing risk and downtime.</li><li><strong>Team autonomy</strong>: Separate teams can own different services, leading to faster development cycles.</li></ul><p>The good news? If you&#39;ve built a well-designed modular monolith, you&#39;re already halfway there. The clear boundaries between modules in your monolith can serve as a blueprint for your microservices architecture.</p><p>Remember, microservices come with their own complexities in areas like data consistency and inter-service communication. But for the right use cases, they can provide the flexibility and scalability needed for growing applications.</p><hr><h2 id="preparing-for-migration" tabindex="-1"><a class="header-anchor" href="#preparing-for-migration"><span>Preparing for Migration</span></a></h2><p>The success of your migration largely depends on how well you prepare. Your best starting point is a well-structured modular monolith.</p><p>Here are key areas to focus on:</p><ol><li><strong>Review module boundaries</strong>: I can&#39;t stress this enough: clear module boundaries are crucial. Each module should have a distinct responsibility and minimal dependencies on others. If boundaries are blurry, refactor before migrating.</li><li><strong>Ensure proper data encapsulation</strong>: Modules should not directly access each other&#39;s data stores. I make sure each module owns and manages its data exclusively. No shared tables, no direct database access across modules. This clean separation makes it much easier to extract modules into microservices later.</li><li><strong>Implement clean public APIs</strong>: Define clear contracts between modules to facilitate future separation. Modules should communicate through well-defined APIs, not by accessing each other&#39;s internals.</li></ol><p>Here&#39;s an example of the above:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line"><span class="token comment">// Good: Clear module boundary</span></span>
<span class="line"><span class="token keyword">namespace</span> <span class="token namespace">BookingsModule</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBooking</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IBookingRepository</span> _bookingRepository<span class="token punctuation">;</span></span>
<span class="line highlighted">    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IPaymentGateway</span> _paymentGateway<span class="token punctuation">;</span> <span class="token comment">// Public API</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">CreateBooking</span><span class="token punctuation">(</span><span class="token class-name">IBookingRepository</span> bookingRepository<span class="token punctuation">,</span> <span class="token class-name">IPaymentGateway</span> paymentGateway<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        _bookingRepository <span class="token operator">=</span> bookingRepository<span class="token punctuation">;</span></span>
<span class="line">        _paymentGateway <span class="token operator">=</span> paymentGateway<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>BookingResult<span class="token punctuation">&gt;</span></span> <span class="token function">CreateBookingAsync</span><span class="token punctuation">(</span><span class="token class-name">BookingRequest</span> request<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> booking <span class="token operator">=</span> <span class="token keyword">await</span> _bookingRepository<span class="token punctuation">.</span><span class="token function">CreateAsync</span><span class="token punctuation">(</span>Booking<span class="token punctuation">.</span><span class="token function">FromRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Accessing the other module&#39;s data through an abstraction</span></span>
<span class="line highlighted">        <span class="token class-name"><span class="token keyword">var</span></span> paymentResult <span class="token operator">=</span> <span class="token keyword">await</span> _paymentGateway<span class="token punctuation">.</span><span class="token function">ProcessPaymentAsync</span><span class="token punctuation">(</span>booking<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> booking<span class="token punctuation">.</span>TotalAmount<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BookingResult</span><span class="token punctuation">(</span>booking<span class="token punctuation">,</span> paymentResult<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>By focusing on these areas, you&#39;re not just preparing for migration - you&#39;re improving your modular monolith. Even if you decide not to migrate, these steps will make your system more maintainable and scalable.</p><hr><h2 id="choosing-and-extracting-the-first-module" tabindex="-1"><a class="header-anchor" href="#choosing-and-extracting-the-first-module"><span>Choosing and Extracting the First Module</span></a></h2><p>Selecting the right module to extract first can set the tone for your entire migration. In my experience, it&#39;s crucial to start with a module that&#39;s self-contained and has clear boundaries.</p><p>When I&#39;m evaluating modules, I look for these characteristics:</p><ul><li>Low coupling with other modules</li><li>High cohesion within the module</li><li>A distinct business function</li><li>Potential performance or scalability gains from separation</li></ul><p>For instance, in an e-commerce system, I might choose the product catalog module. It typically has a clear purpose, doesn&#39;t heavily depend on other modules, and could benefit from independent scaling.</p><p>Once you&#39;ve chosen your module, here&#39;s the extraction process I follow:</p><ol><li>Create a new project for the microservice.</li><li>Move the module&#39;s code to the new project. This often reveals hidden dependencies, which is valuable information.</li><li>Update the dependencies, ensuring the microservice is self-contained. This might involve copying some shared code or refactoring to remove unnecessary dependencies.</li><li>Set up a separate database for the microservice. This enforces data independence.</li><li>Implement a data migration strategy (more on this later)</li></ol><p>Here&#39;s what this might look like in practice:</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_109/modular_monolith_extraction.png?imwidth=3840" alt="Modular monolith extraction process into microservices." tabindex="0" loading="lazy"><figcaption>Modular monolith extraction process into microservices.</figcaption></figure><p>Remember, the goal isn&#39;t perfection on the first try. I often iterate on this process, gradually refining the separation between the new microservice and the monolith.</p><p>The first extraction is a learning experience. It&#39;ll show you how to approach subsequent modules and help you refine the overall migration strategy.</p><hr><h2 id="implementing-inter-service-communication" tabindex="-1"><a class="header-anchor" href="#implementing-inter-service-communication"><span>Implementing Inter-Service Communication</span></a></h2>`,30),C=n("strong",null,"module's communication",-1),D=n("p",null,"Here's how I approach this transition:",-1),H=n("strong",null,"Refit",-1),z=n("div",{class:"language-csharp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cs","data-title":"cs"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token comment"},"// Before: Direct method call")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},"BookingDto"),s(" booking "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" _bookingService"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"GetAsync"),n("span",{class:"token punctuation"},"("),s("bookingId"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token comment"},"// After: HTTP API call")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" response "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" _httpClient"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"GetAsync"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"http://bookings-service/api/bookings/'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"bookingId"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" booking "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" response"),n("span",{class:"token punctuation"},"."),s("Content"),n("span",{class:"token punctuation"},"."),n("span",{class:"token generic-method"},[n("span",{class:"token function"},"ReadFromJsonAsync"),n("span",{class:"token generic class-name"},[n("span",{class:"token punctuation"},"<"),s("BookingDto"),n("span",{class:"token punctuation"},">")])]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),G=n("strong",null,"RabbitMQ",-1),E=n("strong",null,"Amazon SQS and SNS",-1),Y=n("strong",null,"Azure Service Bus",-1),F=n("p",null,[s("Network communication introduces new failure modes, so I always implement "),n("a",{href:"building-resilient-cloud-applications-with-dotnet"},[n("strong",null,"resilience patterns")]),s(". Here's how I use Polly with resilience pipelines:")],-1),N=n("div",{class:"language-csharp line-numbers-mode","data-highlighter":"prismjs","data-ext":"cs","data-title":"cs"},[n("pre",null,[n("code",null,[n("span",{class:"line"},[n("span",{class:"token class-name"},"sing"),s(" Polly"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" pipeline "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},[s("ResiliencePipelineBuilder"),n("span",{class:"token punctuation"},"<"),s("HttpResponseMessage"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"AddRetry"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"RetryStrategyOptions")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        ShouldHandle "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"PredicateBuilder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token generic-method"},[n("span",{class:"token function"},"Handle"),n("span",{class:"token generic class-name"},[n("span",{class:"token punctuation"},"<"),s("ConflictException"),n("span",{class:"token punctuation"},">")])]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        Delay "),n("span",{class:"token operator"},"="),s(" TimeSpan"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"FromSeconds"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        MaxRetryAttempts "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        BackoffType "),n("span",{class:"token operator"},"="),s(" DelayBackoffType"),n("span",{class:"token punctuation"},"."),s("Exponential"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("        UseJitter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"true")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"AddTimeout"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"TimeoutStrategyOptions")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"{")]),s(`
`),n("span",{class:"line"},[s("        Timeout "),n("span",{class:"token operator"},"="),s(" TimeSpan"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"FromSeconds"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Build"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" response "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" pipeline"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ExecuteAsync"),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"async"),s(" ct "),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token keyword"},"await"),s(" _httpClient"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"GetAsync"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"http://bookings-service/api/bookings/'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"bookingId"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},","),s(" ct"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("    cancellationToken"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),O=n("strong",null,"API versioning",-1),W=n("hr",null,null,-1),J=n("h2",{id:"implementing-an-api-gateway",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#implementing-an-api-gateway"},[n("span",null,"Implementing an API Gateway")])],-1),L=n("p",null,"As you extract more services, managing the communication between clients and your microservices can become complex. An API Gateway can help manage this complexity by providing a single entry point for all clients.",-1),U=n("strong",null,"implementing an API Gateway",-1),V=r(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line"><span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddReverseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">LoadFromConfig</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;ReverseProxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">MapReverseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Z=n("code",null,"appsettings.json",-1),$=r(`<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;ReverseProxy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;Routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;bookings-route&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bookings-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/bookings/{**catch-all}&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;payments-route&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;payments-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/payments/{**catch-all}&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Clusters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;bookings-cluster&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Destinations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;destination1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://bookings-service/&quot;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;payments-cluster&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Destinations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;destination1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://payments-service/&quot;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This setup routes requests to the appropriate microservice based on the path. For example, any request to <code>/api/bookings/*</code> will be routed to the <code>bookings-service</code>.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_109/modular_monolith_extraction_api_gateway.png?imwidth=3840" alt="Modular monolith extraction process into microservices with an API gateway introduced." tabindex="0" loading="lazy"><figcaption>Modular monolith extraction process into microservices with an API gateway introduced.</figcaption></figure><p>In my projects, I&#39;ve found that an API Gateway often becomes a critical point for implementing cross-cutting concerns. As your architecture evolves, consider adding features like:</p><ul><li><a href="advanced-rate-limiting-use-cases-in-dotnet"><strong>Rate limiting</strong></a> to protect your services from overload</li><li><a href="caching-in-aspnetcore-improving-application-performance"><strong>Caching</strong></a> to improve response times for frequently requested data</li><li>Request/response transformation to adapt your internal APIs for external consumption</li></ul><p>Start simple, but be prepared to evolve your gateway as you learn more about your system&#39;s needs and usage patterns.</p><hr><h2 id="data-migration-strategy" tabindex="-1"><a class="header-anchor" href="#data-migration-strategy"><span>Data Migration Strategy</span></a></h2><p>Data migration is often the trickiest part of moving from a modular monolith to microservices. In my experience, there are two main approaches:</p><h3 id="_1-the-one-and-done-approach" tabindex="-1"><a class="header-anchor" href="#_1-the-one-and-done-approach"><span>1. The &quot;One and Done&quot; Approach</span></a></h3><p>For simpler systems or those that can handle some downtime, I use this method:</p><ul><li>Create a new database for the microservice</li><li>Copy the relevant schema and data from the monolith</li><li>Switch the application to use the new database</li></ul><p>It&#39;s quick and simple but requires a brief downtime.</p><h3 id="_2-the-synchronization-approach" tabindex="-1"><a class="header-anchor" href="#_2-the-synchronization-approach"><span>2. The Synchronization Approach</span></a></h3><p>For complex systems needing minimal disruption, I use this method:</p>`,15),Q=n("li",null,"Copy the schema and initial data to the new database",-1),K={href:"https://en.wikipedia.org/wiki/Change_data_capture",target:"_blank",rel:"noopener noreferrer"},X=n("li",null,"Gradually shift traffic to the new microservice",-1),nn=n("li",null,"Eventually, remove the old schema from the monolith",-1),sn=n("p",null,"This approach is more complex but allows for a smoother transition.",-1),an=n("p",null,"In both cases, I always ensure I have a solid backup and rollback plan. The key is to choose the method that best fits your system's needs and tolerance for complexity.",-1),en=n("strong",null,"separate database schemas for each module",-1),tn=n("hr",null,null,-1),on=n("h2",{id:"summary",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#summary"},[n("span",null,"Summary")])],-1),ln=n("p",null,"Migrating from a modular monolith to microservices is a journey I've taken several times, and it's always both challenging and rewarding. The process we've covered here - from preparing your monolith and choosing the right module to extract to implementing proper communication patterns - forms the foundation of a successful migration.",-1),cn=n("p",null,"Don't rush the process. Careful planning and incremental changes are key. Each step teaches you something valuable about your system.",-1),rn=n("p",null,"While we've covered the fundamentals, there's always more to learn. I recommend exploring these advanced topics:",-1),pn=n("strong",null,"Service discovery",-1),un=n("strong",null,"Monitoring and observability",-1),dn=n("strong",null,"deployment strategies",-1),mn=n("strong",null,"Modular Monolith Architecture",-1),hn=n("p",null,"Remember, the goal isn't to blindly adopt microservices but to evolve your architecture to best serve your business needs. Sometimes, a well-structured modular monolith is the right solution. Other times, a full microservices architecture is the way to go. The key is understanding the trade-offs and making informed decisions.",-1),gn=n("p",null,"Good luck out there, and I'll see you next week.",-1);function kn(u,vn){const d=i("VPCard"),o=i("router-link"),m=i("SiteInfo"),t=i("RouteLink"),h=i("Tabs"),p=i("FontIcon");return f(),k("div",null,[n("h1",_,[n("a",I,[n("span",null,v(u.$frontmatter.title)+" ê´€ë ¨",1)])]),e(d,y(b({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",x,[n("ul",null,[n("li",null,[e(o,{to:"#why-consider-microservices"},{default:a(()=>[s("Why Consider Microservices?")]),_:1})]),n("li",null,[e(o,{to:"#preparing-for-migration"},{default:a(()=>[s("Preparing for Migration")]),_:1})]),n("li",null,[e(o,{to:"#choosing-and-extracting-the-first-module"},{default:a(()=>[s("Choosing and Extracting the First Module")]),_:1})]),n("li",null,[e(o,{to:"#implementing-inter-service-communication"},{default:a(()=>[s("Implementing Inter-Service Communication")]),_:1})]),n("li",null,[e(o,{to:"#implementing-an-api-gateway"},{default:a(()=>[s("Implementing an API Gateway")]),_:1})]),n("li",null,[e(o,{to:"#data-migration-strategy"},{default:a(()=>[s("Data Migration Strategy")]),_:1}),n("ul",null,[n("li",null,[e(o,{to:"#_1-the-one-and-done-approach"},{default:a(()=>[s('1. The "One and Done" Approach')]),_:1})]),n("li",null,[e(o,{to:"#_2-the-synchronization-approach"},{default:a(()=>[s("2. The Synchronization Approach")]),_:1})])])]),n("li",null,[e(o,{to:"#summary"},{default:a(()=>[s("Summary")]),_:1})])])]),M,e(m,{name:"Breaking It Down: How to Migrate Your Modular Monolith to Microservices",desc:"Transitioning from a modular monolith to microservices can significantly enhance your system's scalability and your team's productivity, but it's a journey that requires careful planning and execution. In this practical guide, I'll walk you through the key steps of this migration process, from preparing your monolith and selecting the right module to extract, to implementing effective inter-service communication and data migration strategies, all based on real-world experience with .NET applications.",url:"https://milanjovanovic.tech/blog/breaking-it-down-how-to-migrate-your-modular-monolith-to-microservices",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_109.png"}),q,A,T,P,j,S,n("p",null,[s("A "),e(t,{to:"/milanjovanovic.tech/what-is-a-modular-monolith.html"},{default:a(()=>[R]),_:1}),s(" serves as an excellent starting point for many applications. It's simpler to develop, easier to understand, and faster to deploy than a distributed system. But as your application grows, you might start facing some problems.")]),B,n("p",null,[s("Once you've extracted a module into a microservice, you have to update the "),e(t,{to:"/milanjovanovic.tech/modular-monolith-communication-patterns.html"},{default:a(()=>[C]),_:1}),s(" with the rest of the system. This typically involves transitioning from direct method calls to network-based communication.")]),D,e(h,{id:"206",data:[{id:"1."},{id:"2."},{id:"3."}],active:0},{title0:a(({value:l,isActive:c})=>[s("1.")]),title1:a(({value:l,isActive:c})=>[s("2.")]),title2:a(({value:l,isActive:c})=>[s("3.")]),tab0:a(({value:l,isActive:c})=>[n("p",null,[s("Replace direct method calls with HTTP API calls. I often use libraries like "),e(t,{to:"/milanjovanovic.tech/refit-in-dotnet-building-robust-api-clients-in-csharp.html"},{default:a(()=>[H]),_:1}),s(" to simplify API interactions. Here's a before and after example:")]),z]),tab1:a(({value:l,isActive:c})=>[n("p",null,[s("For asynchronous communication, consider implementing a messaging system. While the implementation details vary, tools like "),e(t,{to:"/milanjovanovic.tech/using-masstransit-with-rabbitmq-and-azure-service-bus.html"},{default:a(()=>[G]),_:1}),s(", "),e(t,{to:"/milanjovanovic.tech/complete-guide-to-amazon-sqs-and-amazon-sns-with-masstransit.html"},{default:a(()=>[E]),_:1}),s(", or "),e(t,{to:"/milanjovanovic.tech/messaging-made-easy-with-azure-service-bus.html"},{default:a(()=>[Y]),_:1}),s(" can significantly improve system resilience and decoupling.")])]),tab2:a(({value:l,isActive:c})=>[F,N]),_:1}),n("p",null,[s("Transitioning to HTTP-based communication always brings new problems to solve. Serialization, error handling, and "),e(t,{to:"/milanjovanovic.tech/api-versioning-in-aspnetcore.html"},{default:a(()=>[O]),_:1}),s(" become crucial. I've learned to plan for these aspects from the start to avoid headaches down the line.")]),W,J,L,n("p",null,[s("YARP (Yet Another Reverse Proxy) is an excellent tool for "),e(t,{to:"/milanjovanovic.tech/implementing-an-api-gateway-for-microservices-with-yarp.html"},{default:a(()=>[U]),_:1}),s(" in .NET. Here's how I typically set it up:")]),V,n("p",null,[s("Then, I configure the routing in "),e(p,{icon:"iconfont icon-json"}),Z,s(":")]),$,n("ul",null,[Q,n("li",null,[s("Set up a sync mechanism (like "),n("a",K,[e(p,{icon:"fa-brands fa-wikipedia-w"}),s("change data capture")]),s(") to keep the new database updated")]),X,nn]),sn,an,n("p",null,[s("Remember, if your modular monolith already uses "),e(t,{to:"/milanjovanovic.tech/modular-monolith-data-isolation.html"},{default:a(()=>[en]),_:1}),s(", you're starting with an advantage. This logical isolation makes the migration process significantly easier.")]),tn,on,ln,cn,rn,n("ul",null,[n("li",null,[e(t,{to:"/milanjovanovic.tech/service-discovery-in-microservices-with-net-and-consul.html"},{default:a(()=>[pn]),_:1}),s(" and API gateway patterns")]),n("li",null,[e(t,{to:"/milanjovanovic.tech/introduction-to-distributed-tracing-with-opentelemetry-in-dotnet.html"},{default:a(()=>[un]),_:1}),s(" in a microservices environment")]),n("li",null,[s("Advanced "),e(t,{to:"/milanjovanovic.tech/how-to-build-ci-cd-pipeline-with-github-actions-and-dotnet.html"},{default:a(()=>[dn]),_:1}),s(", like blue-green deployment")])]),n("p",null,[s("If you're ready to master this process and gain hands-on experience, I've put together a comprehensive "),e(t,{to:"/milanjovanovic.tech/modular-monolith-architecture/"},{default:a(()=>[mn]),_:1}),s(" course. There's an entire chapter dedicated to extracting modules and moving to microservices. You'll gain practical skills to confidently navigate your microservices transformation.")]),hn,gn])}const fn=g(w,[["render",kn],["__file","breaking-it-down-how-to-migrate-your-modular-monolith-to-microservices.html.vue"]]),wn=JSON.parse('{"path":"/milanjovanovic.tech/breaking-it-down-how-to-migrate-your-modular-monolith-to-microservices.html","title":"Breaking It Down: How to Migrate Your Modular Monolith to Microservices","lang":"en-US","frontmatter":{"lang":"en-US","title":"Breaking It Down: How to Migrate Your Modular Monolith to Microservices","description":"Article(s) > Breaking It Down: How to Migrate Your Modular Monolith to Microservices","icon":"iconfont icon-csharp","category":["Article(s)","C#","DotNet"],"tag":["blog","freecodecamp.org","cs","c#","csharp","dotnet"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > Breaking It Down: How to Migrate Your Modular Monolith to Microservices"},{"property":"og:description","content":"Breaking It Down: How to Migrate Your Modular Monolith to Microservices"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/breaking-it-down-how-to-migrate-your-modular-monolith-to-microservices.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/breaking-it-down-how-to-migrate-your-modular-monolith-to-microservices.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Breaking It Down: How to Migrate Your Modular Monolith to Microservices"}],["meta",{"property":"og:description","content":"Article(s) > Breaking It Down: How to Migrate Your Modular Monolith to Microservices"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_109.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_109.png"}],["meta",{"name":"twitter:image:alt","content":"Breaking It Down: How to Migrate Your Modular Monolith to Microservices"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"freecodecamp.org"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:published_time","content":"2024-09-28T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Breaking It Down: How to Migrate Your Modular Monolith to Microservices\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_109/modular_monolith_vs_microservices.png?imwidth=3840\\",\\"https://milanjovanovic.tech/blogs/mnw_109/modular_monolith_extraction.png?imwidth=3840\\",\\"https://milanjovanovic.tech/blogs/mnw_109/modular_monolith_extraction_api_gateway.png?imwidth=3840\\"],\\"datePublished\\":\\"2024-09-28T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"]],"prev":"/programming/cs/articles/README.md","date":"2024-09-28T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_109.png"},"headers":[{"level":2,"title":"Why Consider Microservices?","slug":"why-consider-microservices","link":"#why-consider-microservices","children":[]},{"level":2,"title":"Preparing for Migration","slug":"preparing-for-migration","link":"#preparing-for-migration","children":[]},{"level":2,"title":"Choosing and Extracting the First Module","slug":"choosing-and-extracting-the-first-module","link":"#choosing-and-extracting-the-first-module","children":[]},{"level":2,"title":"Implementing Inter-Service Communication","slug":"implementing-inter-service-communication","link":"#implementing-inter-service-communication","children":[]},{"level":2,"title":"Implementing an API Gateway","slug":"implementing-an-api-gateway","link":"#implementing-an-api-gateway","children":[]},{"level":2,"title":"Data Migration Strategy","slug":"data-migration-strategy","link":"#data-migration-strategy","children":[{"level":3,"title":"1. The \\"One and Done\\" Approach","slug":"_1-the-one-and-done-approach","link":"#_1-the-one-and-done-approach","children":[]},{"level":3,"title":"2. The Synchronization Approach","slug":"_2-the-synchronization-approach","link":"#_2-the-synchronization-approach","children":[]}]},{"level":2,"title":"Summary","slug":"summary","link":"#summary","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":7.14,"words":2142},"filePathRelative":"milanjovanovic.tech/breaking-it-down-how-to-migrate-your-modular-monolith-to-microservices.md","localizedDate":"September 28, 2024","excerpt":"\\n","copyright":{"author":"Milan JovanoviÄ‡"}}');export{fn as comp,wn as data};
