import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as d,b as n,t as m,e as a,n as g,g as v,w as e,d as t,f as p,r as o,o as y}from"./app-BgNevrm5.js";const f={},k={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},b={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},w={class:"table-of-contents"},_=n("hr",null,null,-1),A=n("p",null,"API gateways provide clients with a single point of entry. This streamlines their interactions with your system and ensures the security of your microservices or distributed system.",-1),P=n("p",null,"One critical aspect of API gateways is authentication - ensuring only authorized users and applications can access your valuable data and resources.",-1),q={href:"https://microsoft.github.io/reverse-proxy/index.html",target:"_blank",rel:"noopener noreferrer"},I=n("p",null,"Here's what we will cover:",-1),R=n("ul",null,[n("li",null,"The role of API gateways"),n("li",null,"Configuring authentication with YARP"),n("li",null,"Creating custom authorization policies")],-1),x=n("p",null,"Let's dive in.",-1),j=n("hr",null,null,-1),z=n("h2",{id:"the-role-of-api-gateways",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#the-role-of-api-gateways"},[n("span",null,"The Role of API Gateways")])],-1),T=n("strong",null,"API gateway",-1),Y=n("p",null,"The key benefits of API gateways are:",-1),C=n("li",null,[n("strong",null,"Centralized access"),t(": All incoming requests must first pass through the gateway. This simplifies management and monitoring.")],-1),W=n("li",null,[n("strong",null,"Service abstraction"),t(": Clients interact only with the gateway. We can hide the complexity of the backend architecture from clients.")],-1),G=n("strong",null,"Performance enhancement",-1),M=n("strong",null,"load balancing",-1),S=n("li",null,[n("strong",null,"Authentication and Authorization"),t(": API gateways verify user and application identities, enforcing whether a request is allowed or not.")],-1),E=n("img",{src:"https://milanjovanovic.tech/blogs/mnw_088/api_gateway.png?imwidth=3840",alt:"API Gateway diagram.<br/>Source: Modular Monolith Architecture",tabindex:"0",loading:"lazy"},null,-1),N=n("br",null,null,-1),B=n("hr",null,null,-1),V=n("h2",{id:"configuring-authentication-with-yarp",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#configuring-authentication-with-yarp"},[n("span",null,"Configuring Authentication With YARP")])],-1),D=n("p",null,"We can use the API gateway to authenticate and authorize requests before they are proxied to the destination servers. This can reduce the load on the destination servers, and introduce a layer of security. Implementing authentication on the API gateway ensures consistent policies are implemented across your applications.",-1),H=n("strong",null,"how to implement an API gateway with YARP",-1),J=n("p",null,"By default, YARP won't authenticate or authorize requests unless enabled in the route or application configuration.",-1),K={href:"https://docs.microsoft.com/aspnet/core/security/authentication/",target:"_blank",rel:"noopener noreferrer"},L={href:"https://learn.microsoft.com/en-us/aspnet/core/security/authorization/introduction",target:"_blank",rel:"noopener noreferrer"},O=p(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line highlighted">app<span class="token punctuation">.</span><span class="token function">UseAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line highlighted">app<span class="token punctuation">.</span><span class="token function">UseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">MapReverseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This allows us to configure the authorization policy by providing the <code>AuthorizationPolicy</code> value in the route configuration.</p><p>There are two special values we can specify in a route&#39;s authorization parameter:</p><ul><li><code>default</code> - The route will require an authenticated user.</li><li><code>anonymous</code> - The route will not require authorization regardless of any other configuration.</li></ul><p>Here&#39;s how we can enforce that all incoming requests must be authenticated:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// This is how we define reverse proxy routes.</span></span>
<span class="line">  <span class="token property">&quot;Routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;api-route&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line highlighted">      <span class="token property">&quot;AuthorizationPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api/{**catch-all}&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We want to authorize any incoming request as soon as it hits the API gateway. However, the destination server may still need to know who the user is (authentication) and what they can do (authorization).</p><p>YARP will pass any credentials to the proxied request. By default, cookies, bearer tokens, and API keys will flow to the destination server.</p><hr><h2 id="creating-custom-authentication-policies" tabindex="-1"><a class="header-anchor" href="#creating-custom-authentication-policies"><span>Creating Custom Authentication Policies</span></a></h2>`,10),U={href:"https://learn.microsoft.com/en-us/aspnet/core/security/authorization/policies",target:"_blank",rel:"noopener noreferrer"},Z=p(`<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// This is how we define auth policies for reverse proxy routes.</span></span>
<span class="line">  <span class="token property">&quot;Routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;api-route1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line highlighted">      <span class="token property">&quot;AuthorizationPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;is-vip&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api/hello-vip&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;api-route2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line highlighted">      <span class="token property">&quot;AuthorizationPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api/{**catch-all}&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s how we can create a custom <code>is-vip</code> policy with two components. It requires an authenticated user and <code>vip</code> claim with one of the defined allowed values to be present . To use this policy, we can just specify it as the value for the <code>AuthorizationPolicy</code> in the route configuration.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line">services<span class="token punctuation">.</span><span class="token function">AddAuthorization</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    options<span class="token punctuation">.</span><span class="token function">AddPolicy</span><span class="token punctuation">(</span><span class="token string">&quot;is-vip&quot;</span><span class="token punctuation">,</span> policy <span class="token operator">=&gt;</span></span>
<span class="line">        policy</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">RequireAuthenticatedUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">RequireClaim</span><span class="token punctuation">(</span><span class="token string">&quot;vip&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">allowedValues</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>API gateways provide a unified access point, streamlining client interactions and securing your backend services. Authentication is an essential element of API gateway security, controlling who can access your resources.</p><p>YARP offers a versatile solution for building .NET API gateways. By integrating with ASP.NET Core&#39;s authentication and authorization frameworks, YARP enables robust security mechanisms.</p>`,7),F=n("strong",null,"granular access control",-1),$=n("p",null,"Thanks for reading, and I'll see you next week.",-1),Q={class:"hint-container note"},X=n("p",{class:"hint-container-title"},"P.S.",-1),nn={href:"https://github.com/m-jovanovic/yarp-authentication",target:"_blank",rel:"noopener noreferrer"},tn=n("code",null,"m-jovanovic/yarp-authentication",-1);function an(r,en){const u=o("VPCard"),l=o("router-link"),c=o("SiteInfo"),s=o("FontIcon"),i=o("RouteLink");return y(),d("div",null,[n("h1",k,[n("a",b,[n("span",null,m(r.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),a(u,g(v({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",w,[n("ul",null,[n("li",null,[a(l,{to:"#the-role-of-api-gateways"},{default:e(()=>[t("The Role of API Gateways")]),_:1})]),n("li",null,[a(l,{to:"#configuring-authentication-with-yarp"},{default:e(()=>[t("Configuring Authentication With YARP")]),_:1})]),n("li",null,[a(l,{to:"#creating-custom-authentication-policies"},{default:e(()=>[t("Creating Custom Authentication Policies")]),_:1})]),n("li",null,[a(l,{to:"#summary"},{default:e(()=>[t("Summary")]),_:1})])])]),_,a(c,{name:"Implementing API Gateway Authentication With YARP",desc:"In this newsletter, we'll explore how you can implement API gateway authentication using YARP (Yet Another Reverse Proxy), a powerful and flexible reverse proxy library for .NET applications.",url:"https://milanjovanovic.tech/blog/implementing-api-gateway-authentication-with-yarp/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_087.png"}),A,P,n("p",null,[t("In this newsletter, we'll explore how you can implement API gateway authentication using "),n("a",q,[a(s,{icon:"fa-brands fa-microsoft"}),t("YARP")]),t(" (Yet Another Reverse Proxy), a powerful and flexible reverse proxy library for .NET applications.")]),I,R,x,j,z,n("p",null,[t("An "),a(i,{to:"/milanjovanovic.tech/implementing-an-api-gateway-for-microservices-with-yarp.html"},{default:e(()=>[T]),_:1}),t(' is the "front door" to your backend services and APIs. It acts as an intermediary layer, handling client requests and routing them to the appropriate destinations.')]),Y,n("ul",null,[C,W,n("li",null,[G,t(": Implement techniques like caching and "),a(i,{to:"/milanjovanovic.tech/horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing.html"},{default:e(()=>[M]),_:1}),t(" to optimize API performance.")]),S]),n("figure",null,[E,n("figcaption",null,[t("API Gateway diagram."),N,t("Source: "),a(i,{to:"/milanjovanovic.tech/modular-monolith-architecture/"},{default:e(()=>[t("Modular Monolith Architecture")]),_:1})])]),B,V,D,n("p",null,[t("If you're new to YARP, I recommend first reading about "),a(i,{to:"/milanjovanovic.tech/implementing-an-api-gateway-for-microservices-with-yarp.html"},{default:e(()=>[H]),_:1}),t(".")]),J,n("p",null,[t("We can start by introducing "),n("a",K,[a(s,{icon:"fa-brands fa-microsoft"}),t("authentication")]),t(" and "),n("a",L,[a(s,{icon:"fa-brands fa-microsoft"}),t("authorization")]),t(" middleware:")]),O,n("p",null,[t("YARP can utilize the powerful "),n("a",U,[a(s,{icon:"fa-brands fa-microsoft"}),t("authorization policies")]),t(" feature in ASP.NET Core. We can specify a policy per route in the proxy configuration, and the rest is handled by existing ASP.NET Core authentication and authorization components.")]),Z,n("p",null,[t("This flexibility really shines with support for custom authorization policies. This allows you to define "),a(i,{to:"/milanjovanovic.tech/master-claims-transformation-for-flexible-aspnetcore-authorization.html"},{default:e(()=>[F]),_:1}),t(" based on user roles, claims, or other attributes.")]),$,n("div",Q,[X,n("p",null,[t("Here's the complete "),n("a",nn,[t("source code ("),a(s,{icon:"iconfont icon-github"}),tn,t(")")]),t(" for this article if you want to try it out.")]),a(c,{name:"m-jovanovic/yarp-authentication",desc:"An example project demonstrating how to implement an API Gateway with authentication using YARP.",url:"https://github.com/m-jovanovic/yarp-authentication",logo:"https://avatars.githubusercontent.com/u/34191235?s=96&v=4",preview:"https://opengraph.githubassets.com/8f88b7fbb4e56e9a3c4b643b30cb9332e0589f668c40767bf9f5be9c4c3eec70/m-jovanovic/yarp-authentication"})])])}const ln=h(f,[["render",an],["__file","implementing-api-gateway-authentication-with-yarp.html.vue"]]),cn=JSON.parse('{"path":"/milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.html","title":"Implementing API Gateway Authentication With YARP","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Implementing API Gateway Authentication With YARP","description":"Article(s) > Implementing API Gateway Authentication With YARP","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > Implementing API Gateway Authentication With YARP"},{"property":"og:description","content":"Implementing API Gateway Authentication With YARP"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"Implementing API Gateway Authentication With YARP"}],["meta",{"property":"og:description","content":"Article(s) > Implementing API Gateway Authentication With YARP"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_087.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_087.png"}],["meta",{"name":"twitter:image:alt","content":"Implementing API Gateway Authentication With YARP"}],["meta",{"property":"article:author","content":"Milan Jovanoviƒá"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:published_time","content":"2024-05-04T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Implementing API Gateway Authentication With YARP\\",\\"image\\":[\\"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/modular-monolith-architecture/README.md\\"],\\"datePublished\\":\\"2024-05-04T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanoviƒá\\"}]}"]],"prev":"/programming/cs/articles/README.md","date":"2024-05-04T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanoviƒá","cover":"https://milanjovanovic.tech/blog-covers/mnw_087.png"},"headers":[{"level":2,"title":"The Role of API Gateways","slug":"the-role-of-api-gateways","link":"#the-role-of-api-gateways","children":[]},{"level":2,"title":"Configuring Authentication With YARP","slug":"configuring-authentication-with-yarp","link":"#configuring-authentication-with-yarp","children":[]},{"level":2,"title":"Creating Custom Authentication Policies","slug":"creating-custom-authentication-policies","link":"#creating-custom-authentication-policies","children":[]},{"level":2,"title":"Summary","slug":"summary","link":"#summary","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":3.36,"words":1009},"filePathRelative":"milanjovanovic.tech/implementing-api-gateway-authentication-with-yarp.md","localizedDate":"2024ÎÖÑ 5Ïõî 4Ïùº","excerpt":"\\n","copyright":{"author":"Milan Jovanoviƒá"}}');export{ln as comp,cn as data};
