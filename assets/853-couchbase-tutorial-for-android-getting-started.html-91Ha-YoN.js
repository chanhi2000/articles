import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,b as n,t as h,e as a,n as m,g,w as o,d as s,f as p,r as i,o as v}from"./app-BgNevrm5.js";const b={},y={id:"frontmatter-title-관련",tabindex:"-1"},f={class:"header-anchor",href:"#frontmatter-title-관련"},w={class:"table-of-contents"},_=n("hr",null,null,-1),q=p('<p><a href="http://developer.couchbase.com/mobile" target="_blank" rel="noopener noreferrer">Couchbase Mobile</a> is a distributed database that runs on mobile devices and on app servers. Having a mobile database under your app results in speedy interactions with your application — even without network connectivity. When connectivity is restored, the full master-master replication automatically synchronizes the data.</p><p>Why would you choose Couchbase over the built-in SQLite support or a cloud-based data service?</p><ul><li><strong>Easy migration</strong>: Since Couchbase is built on NoSQL, you can seamlessly change data as your application grows — without requiring elaborate upgrade scripts.</li><li><strong>Simple data mapping</strong>: Couchbase lets you store data in a format that closely resembles how your app uses the data.</li><li><strong>Built-in synchronization</strong>: If you have ever needed to build your own syncing solution, you know how complicated it can be. Couchbase’s Sync Gateway does all of the hard work for you.</li><li><strong>Offline support</strong>: Couchbase lets you develop your app without thinking about a network connection. You simply write to the local database and let Couchbase handle the rest.</li></ul><p>In this Couchbase tutorial, you’ll develop a crowd-sourcing quiz application called <strong>QuizzDroid</strong>. Your answers will be shared (via Sync Gateway) with all other users. So there is no right or wrong answer — only what other users have answered.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/demo.gif" alt="couchbase tutorial demo" width="240" tabindex="0" loading="lazy"><figcaption>couchbase tutorial demo</figcaption></figure><p>When you’re done, you’ll have learned the following:</p><ul><li>How to use prebuilt Couchbase Lite databases.</li><li>How to model and query data including attachments.</li><li>How to craft data.</li><li>How to sync data and manage network availability.</li><li>How to deploy your app to multiple emulators.</li></ul><p>Are you excited? Let’s go!</p><div class="hint-container tip"><p class="hint-container-title">Note</p><p>You should have a working knowledge of Android development before working through this Couchbase tutorial. If you need a refresher, take a look at some of our <a href="http://www.raywenderlich.com/category/android" target="_blank" rel="noopener noreferrer">introductory Android tutorials</a>!</p></div><hr><h2 id="getting-started" tabindex="-1"><a class="header-anchor" href="#getting-started"><span>Getting Started</span></a></h2><p>Download the <a href="https://koenig-media.raywenderlich.com/uploads/2016/09/quizzdroid-starter.zip" target="_blank" rel="noopener noreferrer">QuizzDroid starter project</a> and open it in Android Studio. It already contains the Couchbase Lite Android SDK as a dependency and has two activities:</p><ul><li><strong>HomeActivity</strong> will display the list of questions.</li><li><strong>QuestionActivity</strong> will contain the image, possible choices to select from and all answers from other users.</li></ul><p>Build and run your app (some configurations of Android Studio may report build errors on the first attempt; in this case, simply build and run again, and you’ll be error-free). As you can see, the screen is empty:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image01.png" alt="couchbase tutorial image01" width="240" tabindex="0" loading="lazy"><figcaption>couchbase tutorial image01</figcaption></figure><p>You’re now ready to start bringing the activities to life.</p><p>Couchbase Mobile is divided into three components:</p><ul><li><strong>Couchbase Lite</strong>: An embedded NoSQL database that runs on the device, within your application.</li><li><strong>Sync Gateway</strong>: An Internet-facing synchronization server that securely syncs data between device and cloud.</li><li><strong>Couchbase Server</strong>: A highly scalable cloud-based NoSQL server used as a storage engine by Sync Gateway.</li></ul><p>You’ll use the Couchbase Lite database and the Sync Gateway in this tutorial in a simulated multi-user environment and briefly touch on the Couchbase server component.</p><hr><h2 id="using-the-prebuilt-database" tabindex="-1"><a class="header-anchor" href="#using-the-prebuilt-database"><span>Using the Prebuilt Database</span></a></h2><p>Since Couchbase Lite runs right on the device, you can bundle a prebuilt database in your application. This is optional; most apps start with an empty database and add data entered by the user or synchronized through Sync Gateway.</p>',22),x=n("a",{href:"https://koenig-media.raywenderlich.com/uploads/2016/07/quizzdroid.cblite2.zip",target:"_blank",rel:"noopener noreferrer"},"Download the database",-1),j=n("strong",null,"app/src/main/assets/",-1),A=n("figure",null,[n("img",{src:"https://koenig-media.raywenderlich.com/uploads/2016/07/drag-db-finder-1.png",alt:"couchbase tutorial drag-db-finder",tabindex:"0",loading:"lazy"}),n("figcaption",null,"couchbase tutorial drag-db-finder")],-1),C=n("strong",null,"assets",-1),S=n("code",null,"data/data/com.raywenderlich.quizzdroid/files",-1),Q=n("hr",null,null,-1),T=n("h2",{id:"initializing-the-database",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#initializing-the-database"},[n("span",null,"Initializing the Database")])],-1),z=n("code",null,"DataManager.java",-1),I=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Manager</span> manager <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AndroidContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Manager</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_OPTIONS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 2</span></span>
<span class="line">  database <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getExistingDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;quizzdroid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CouchbaseLiteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>database <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">ZipUtils</span><span class="token punctuation">.</span><span class="token function">unzip</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token string">&quot;quizzdroid.cblite2.zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> manager<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFilesDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 4</span></span>
<span class="line">    database <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;quizzdroid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CouchbaseLiteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what this code does:</p>`,2),L=n("li",null,[s("Instantiates the Couchbase Lite "),n("code",null,"Manager"),s(". A Manager is the top-level object managing a collection of Couchbase Lite Database instances. You must create a Manager instance before working with Couchbase Lite objects. The "),n("code",null,"Manager.DEFAULT_OPTIONS"),s(" parameter indicates default options, including read/write support.")],-1),D=n("li",null,[s("Checks for an existing "),n("code",null,"Database"),s(" named “quizzdroid”. This line returns "),n("code",null,"null"),s(" if the database doesn’t exist, as would be the case on first launch.")],-1),O=n("code",null,"ZipUtils.unzip",-1),G=n("strong",null,"files",-1),M=n("li",null,[s("The database is instantiated using the "),n("code",null,"getDatabase"),s(" method.")],-1),R=p('<hr><h2 id="database-listener" tabindex="-1"><a class="header-anchor" href="#database-listener"><span>Database Listener</span></a></h2><p>Now that the database is initialized, you should verify it is working properly. This is a perfect job for the <strong>Database Listener</strong>, which is a component that provides an HTTP entry point to the database. This component is optional and is often used for the following reasons:</p><ul><li><strong>Debugging</strong>: In development, it’s much faster to use the HTTP API to inspect the database than to set breakpoints and examine query results.</li><li><strong>Peer-to-peer</strong>: Other databases (often running on different devices) can persist data to the listener directly without the need for a server to act as the intermediary. This aspect of Couchbase Mobile isn’t covered in this Couchbase tutorial.</li><li><strong>Hybrid development</strong>: Used to access the database from JavaScript frameworks within a WebView. The image below illustrates the Couchbase system architecture. Notice that a database can communicate directly with another database with a listener, instead of having to use the server as a middle-man.</li></ul><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/diagrams.002.png" alt="diagrams.002" tabindex="0" loading="lazy"><figcaption>diagrams.002</figcaption></figure>',5),V=n("code",null,"DataManager.java",-1),E=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token function">setCompiler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JavaScriptViewCompiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">Database</span><span class="token punctuation">.</span><span class="token function">setFilterCompiler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JavaScriptReplicationFilterCompiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">Credentials</span> credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Credentials</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">LiteListener</span> liteListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LiteListener</span><span class="token punctuation">(</span>manager<span class="token punctuation">,</span> <span class="token number">5984</span><span class="token punctuation">,</span> credentials<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>liteListener<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Be sure to import the <code>Credentials</code> from the <code>com.couchbase.lite.listener</code> namespace.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image02.png" alt="couchbase tutorial image02" tabindex="0" loading="lazy"><figcaption>couchbase tutorial image02</figcaption></figure><p>This code creates a database listener on port 5984 and starts it on a background thread.</p><p>Build and run your app; you should see the same blank screen as before.</p><p>To access the database from a browser or a command-line utility such as <code>curl</code>, you must enable port forwarding for that port using ADB. From the command line, run the following:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">adb forward tcp:5984 tcp:5984</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Your database is now accessible on <strong>http://localhost:5984/quizzdroid</strong>.</p><p>You can also access the database using the following <code>curl</code> command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token string">&#39;http://localhost:5984/quizzdroid&#39;</span></span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># {</span></span>
<span class="line"><span class="token comment">#   &quot;disk_size&quot;:147960,</span></span>
<span class="line"><span class="token comment">#   &quot;db_uuid&quot;:&quot;53b66d23-8803-43f3-a4db-a49d51b09efe&quot;,</span></span>
<span class="line"><span class="token comment">#   &quot;db_name&quot;:&quot;quizzdroid&quot;,</span></span>
<span class="line"><span class="token comment">#   &quot;update_seq&quot;:6,</span></span>
<span class="line"><span class="token comment">#   &quot;instance_start_time&quot;:1468585759670000,</span></span>
<span class="line"><span class="token comment">#   &quot;doc_count&quot;:6</span></span>
<span class="line"><span class="token comment"># }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Notice the <code>doc_count</code> is <code>6</code>, which confirms the prebuilt database was successfully loaded.</p><p>Your next task is to display the six questions on the Home Screen.</p><hr><h2 id="the-home-screen" tabindex="-1"><a class="header-anchor" href="#the-home-screen"><span>The Home Screen</span></a></h2><p>Couchbase Mobile is a schemaless database, which means there are no restrictions on the database schema. This lets you be quite flexible during development because you don’t need to run database migrations every time the schema changes. Nonetheless, the application code must know about the data structures underneath.</p><h3 id="data-modeling" tabindex="-1"><a class="header-anchor" href="#data-modeling"><span>Data Modeling</span></a></h3><p>Below is the data model for this application:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/diagrams.003.png" alt="diagrams.003" tabindex="0" loading="lazy"><figcaption>diagrams.003</figcaption></figure><p>Data records are called documents, and there are two document types: <code>question</code> and <code>answer</code>. The underlying data format is JSON. You can think of a document as a set of key-value pairs. There is a one-to-many relationship between the question and answer documents.</p><h3 id="pojo-classes" tabindex="-1"><a class="header-anchor" href="#pojo-classes"><span>POJO Classes</span></a></h3><p>In order to manage the Couchbase documents, you will create POJO (Plain Old Java Object) classes to map the Couchbase documents to Java objects.</p>`,21),N=n("code",null,"model",-1),H=n("code",null,"Question.java",-1),U=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> _id<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> _rev<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> text<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> tag<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> type<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> options<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@JsonIgnore</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> _attachments<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Notice the instance variables are the same as the ones listed in the data model table. These variables represent the keys in the <code>question</code> document type. You will use the Jackson library to convert between POJOs and JSON.</p><p>All the properties reserved for Couchbase Lite are prepended with <code>_</code>, such as <code>_id</code>, <code>_rev</code>, and <code>_attachments</code>. The <code>_attachments</code> property is only present if the document contains attachments. You will load attachments through another API method, so it’s marked with the <code>@JsonIgnore</code> annotation, telling Jackson to ignore the variable.</p><p>Use the Android Studio <kbd>CTRL</kbd>+<kbd>Enter</kbd> shortcut to add getter and setter methods for each instance variable.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/getter-setters-1.gif" alt="getter-setters" tabindex="0" loading="lazy"><figcaption>getter-setters</figcaption></figure><p>With the <strong>Question</strong> model in the application, you can now write a view to index question documents.</p><h3 id="indexing-data" tabindex="-1"><a class="header-anchor" href="#indexing-data"><span>Indexing Data</span></a></h3><p>The way to query data in Couchbase Lite is by registering a View and then running a <strong>Query</strong> on it with <strong>QueryOptions</strong>. The first thing to know about Couchbase Views is that they have nothing to do with the user interface views.</p><p>A View in Couchbase is a persistent index of documents in a database, which can be queried to find data. The main component of a View is its <code>map</code> function. It takes a document’s JSON as input, and emits any number of key-value pairs to be indexed.</p><p>First, you will define the view to index the documents of type <strong>question</strong>. The diagram below shows the result of that map function.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/diagrams.005.png" alt="diagrams.005" tabindex="0" loading="lazy"><figcaption>diagrams.005</figcaption></figure><p>Remember that a view index is a list of key-value pairs, sorted by key. The view’s logic is written in the native language of the platform you’re developing on.</p>`,12),B=n("code",null,"model",-1),P=n("code",null,"Question.java",-1),F=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Query</span> <span class="token function">getQuestions</span><span class="token punctuation">(</span><span class="token class-name">Database</span> database<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 1</span></span>
<span class="line">  <span class="token class-name">View</span> view <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token string">&quot;app/questions&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">getMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 2</span></span>
<span class="line">    view<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Mapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token annotation punctuation">@Override</span></span>
<span class="line">      <span class="token comment">// 3</span></span>
<span class="line">      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> document<span class="token punctuation">,</span> <span class="token class-name">Emitter</span> emitter<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 4</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;question&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token class-name">Query</span> query <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> query<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This method returns a query from a database View. Walking through the code:</p><ol><li>Request a database view named questions. This will create the view if it doesn’t exist.</li><li>If the view does not already have a mapping, create one with a new <code>Mapper</code> object. The second parameter to <code>setMap</code> is a version number. If your code for the map changes in the future, the version number should be incremented as well.</li><li>The <code>Mapper</code> object calls <code>map</code> for each document in the database.</li><li>If the document type equals <code>question</code>, then emit the key-value pair for the view.</li></ol><h3 id="querying-and-displaying-data" tabindex="-1"><a class="header-anchor" href="#querying-and-displaying-data"><span>Querying and Displaying Data</span></a></h3><p>With the view now defined, you are ready to run a <code>Query</code> on it. The result of a query is an instance of <code>QueryEnumerator</code>, which provides a list of <code>QueryRow</code> objects, each one describing a single row from the view’s index.</p>`,5),Y=n("code",null,"onCreate",-1),W=n("code",null,"HomeActivity.java",-1),J=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 1</span></span>
<span class="line"><span class="token class-name">QueryEnumerator</span> questions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  questions <span class="token operator">=</span> <span class="token class-name">Question</span><span class="token punctuation">.</span><span class="token function">getQuestions</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>database<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CouchbaseLiteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2</span></span>
<span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Question</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">QueryRow</span> question <span class="token operator">:</span> questions<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token class-name">Document</span> document <span class="token operator">=</span> question<span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">Question</span> model <span class="token operator">=</span> <span class="token class-name">ModelHelper</span><span class="token punctuation">.</span><span class="token function">modelForDocument</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token class-name">Question</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3</span></span>
<span class="line"><span class="token keyword">final</span> <span class="token class-name">HomeAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HomeAdapter</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mRecyclerView<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code does the following:</p><ol><li>Runs the query and saves the result in a <code>questions</code> variable.</li><li>Loops over the query rows and deserializes the <code>Question</code> model objects.</li><li>Connects the questions to the RecyclerView</li></ol>`,3),K=n("code",null,"ModelHelper.modelForDocument",-1),Z=n("code",null,"ModelHelper.java",-1),X=n("code",null,"modelForDocument",-1),$=n("code",null,"QueryRow",-1),nn=n("code",null,"Question",-1),sn=n("code",null,"adapter",-1),an=n("code",null,"HomeAdapter.java",-1),en=n("code",null,"onBindViewHolder",-1),tn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 1</span></span>
<span class="line"><span class="token class-name">Question</span> question <span class="token operator">=</span> mQuestions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2</span></span>
<span class="line"><span class="token keyword">switch</span> <span class="token punctuation">(</span>question<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token string">&quot;science&quot;</span><span class="token operator">:</span></span>
<span class="line">    holder<span class="token punctuation">.</span>itemView<span class="token punctuation">.</span><span class="token function">setBackgroundColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">&quot;#EC5766&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token string">&quot;geography&quot;</span><span class="token operator">:</span></span>
<span class="line">    holder<span class="token punctuation">.</span>itemView<span class="token punctuation">.</span><span class="token function">setBackgroundColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">&quot;#FFC857&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token string">&quot;android&quot;</span><span class="token operator">:</span></span>
<span class="line">    holder<span class="token punctuation">.</span>itemView<span class="token punctuation">.</span><span class="token function">setBackgroundColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">&quot;#63ADF2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token string">&quot;logic&quot;</span><span class="token operator">:</span></span>
<span class="line">    holder<span class="token punctuation">.</span>itemView<span class="token punctuation">.</span><span class="token function">setBackgroundColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">&quot;#86CD82&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3</span></span>
<span class="line">holder<span class="token punctuation">.</span>mQuestion<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>question<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">holder<span class="token punctuation">.</span>mTag<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>question<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 4</span></span>
<span class="line">holder<span class="token punctuation">.</span>itemView<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token annotation punctuation">@Override</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>mOnItemClickListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token class-name"><span class="token namespace">mOnItemClickListener<span class="token punctuation">.</span></span>OnClick</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code does the following:</p><ol><li>Retrieves the <code>question</code> object for the requested row position.</li><li>Uses the category returned by <code>getTag</code> to set the background colors.</li><li>Sets the content to display in the TextViews for the question text and category.</li><li>Assigns an <code>onClick</code> listener to respond when the user taps a question.</li></ol><div class="hint-container tip"><p class="hint-container-title">Note</p><p>Check out the <a href="https://www.raywenderlich.com/126528/android-recyclerview-tutorial" target="_blank" rel="noopener noreferrer">Recycler View</a> tutorial if you need a refresher on using Recycler Views.</p></div><p>Build and run your app; you should now see six questions on the home screen.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image03.png" alt="image03" width="240" tabindex="0" loading="lazy"><figcaption>image03</figcaption></figure><p>Well done! In the next section, you’ll add a row click handler to open the Question activity.</p><div class="hint-container tip"><p class="hint-container-title">Note</p><p>Run the same query using the Listener. The result has the same questions you see in the app. This lets you examine the details of each question document. The query link is <strong>http://localhost:5984/quizzdroid/_design/app/_view/questions?include_docs=true</strong></p></div><hr><h2 id="home-activity-→-question-activity" tabindex="-1"><a class="header-anchor" href="#home-activity-→-question-activity"><span>Home Activity → Question Activity</span></a></h2>`,10),on=n("code",null,"HomeActivity.java",-1),pn=n("code",null,"onCreate",-1),cn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">adapter<span class="token punctuation">.</span><span class="token function">setOnItemClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HomeAdapter<span class="token punctuation">.</span>OnItemClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token annotation punctuation">@Override</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">OnClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">QuestionActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Question</span> selected <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token constant">EXTRA_INTENT_ID</span><span class="token punctuation">,</span> selected<span class="token punctuation">.</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code assigns an item click listener to the adapter. When you click an item, an Android intent is created containing the document ID of the selected question as an extra, which is then passed along to start the <code>QuestionActivity</code>.</p><p>Build and run. Click on any row to open the question activity. The Question activity is blank, but the next section will take care of that.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image04.gif" alt="image04" width="240" tabindex="0" loading="lazy"><figcaption>image04</figcaption></figure><hr><h2 id="the-question-screen" tabindex="-1"><a class="header-anchor" href="#the-question-screen"><span>The Question Screen</span></a></h2><p>Your first task is to load the full question document from the database and use it to populate the Question activity.</p><h3 id="loading-the-question-data" tabindex="-1"><a class="header-anchor" href="#loading-the-question-data"><span>Loading the Question Data</span></a></h3>`,8),ln=n("code",null,"QuestionActivity.java",-1),un=n("code",null,"onCreate",-1),rn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 1 </span></span>
<span class="line"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">String</span> questionId <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token class-name">HomeActivity</span><span class="token punctuation">.</span><span class="token constant">EXTRA_INTENT_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2</span></span>
<span class="line"><span class="token class-name">DataManager</span> manager <span class="token operator">=</span> <span class="token class-name">DataManager</span><span class="token punctuation">.</span><span class="token function">getSharedInstance</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">Document</span> document <span class="token operator">=</span> manager<span class="token punctuation">.</span>database<span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span>questionId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3</span></span>
<span class="line">mQuestion <span class="token operator">=</span> <span class="token class-name">ModelHelper</span><span class="token punctuation">.</span><span class="token function">modelForDocument</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token class-name">Question</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mTextView<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mQuestion<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what this code does:</p><ol><li>Retrieves the <code>questionId</code> of the selected question from the intent extra.</li><li>Uses the <code>manager</code> singleton database to load the document with the <code>questionId</code>.</li><li>Deserializes the document into <code>question</code> and sets the text property on the <code>textView</code></li></ol><p>Build and run your app, and click on a question to display each question detail:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image05.png" alt="image05" width="240" tabindex="0" loading="lazy"><figcaption>image05</figcaption></figure><h3 id="multiple-choice-in-a-gridview" tabindex="-1"><a class="header-anchor" href="#multiple-choice-in-a-gridview"><span>Multiple Choice in a GridView</span></a></h3><p>The data modeling diagram lists the <code>options</code> property as an array of strings. Those are the possible choices shown to the user.</p>`,7),dn=n("code",null,"QuestionActivity.java:",-1),kn=n("code",null,"QuestionActivity.java",-1),hn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">mQuestionOptions <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">GridView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>question_options<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mQuestionOptions<span class="token punctuation">.</span><span class="token function">setChoiceMode</span><span class="token punctuation">(</span><span class="token class-name">AbsListView</span><span class="token punctuation">.</span><span class="token constant">CHOICE_MODE_SINGLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mQuestionOptions<span class="token punctuation">.</span><span class="token function">setNumColumns</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mQuestionOptions<span class="token punctuation">.</span><span class="token function">setSelector</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>selector_button<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">mQuestionOptions<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QuestionOptionsAdapter</span><span class="token punctuation">(</span>mQuestion<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">mQuestionOptions<span class="token punctuation">.</span><span class="token function">setOnItemClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AdapterView<span class="token punctuation">.</span>OnItemClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token annotation punctuation">@Override</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onItemClick</span><span class="token punctuation">(</span><span class="token class-name">AdapterView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parent<span class="token punctuation">,</span> <span class="token class-name">View</span> view<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    mSelectedOption <span class="token operator">=</span> position<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here’s what’s happening in this code segment:</p><p>In the above code segment, you create a GridView, assign it an adapter populated with <code>mQuestionOptions</code> and then set up a click listener to store the user’s choice in <code>mSelectedOption</code>.</p><p>Build and run. Open any question and click on the possible options:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image06.png" alt="image06" width="240" tabindex="0" loading="lazy"><figcaption>image06</figcaption></figure><p>In the next section you’ll add a Submit button to save your answer to a new document.</p><h3 id="writing-data" tabindex="-1"><a class="header-anchor" href="#writing-data"><span>Writing Data</span></a></h3><p>User answers will be stored in the database as Answer documents. First, you’ll create an Answer model class.</p>`,8),mn=n("code",null,"model/",-1),gn=n("code",null,"Answer.java",-1),vn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> _id<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> _rev<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> question_id<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> type<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> user_answer<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>These property names match the ones on the data modeling diagram. Next, add a getter and setter for each instance variable using the <kbd>CTRL</kbd>+<kbd>Enter</kbd> shortcut in Android Studio.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image06-1.gif" alt="image06" tabindex="0" loading="lazy"><figcaption>image06</figcaption></figure>`,3),bn=n("code",null,"mode/",-1),yn=n("code",null,"Answer.java",-1),fn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token class-name">Answer</span><span class="token punctuation">(</span><span class="token class-name">String</span> question_id<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">,</span> <span class="token class-name">String</span> user_answer<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>question_id <span class="token operator">=</span> question_id<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>user_answer <span class="token operator">=</span> user_answer<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),wn=n("code",null,"activity_question.xml",-1),_n=p(`<div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span></span>
<span class="line">    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/submit_button<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token attr-name"><span class="token namespace">android:</span>onClick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onButtonClicked<span class="token punctuation">&quot;</span></span></span>
<span class="line">    <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Submit<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),qn=n("code",null,"activity_question.xml",-1),xn=n("kbd",null,"Alt",-1),jn=n("kbd",null,"Enter",-1),An=p(`<figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/onclick.gif" alt="onclick" tabindex="0" loading="lazy"><figcaption>onclick</figcaption></figure><p>Add the following to the body of <code>onButtonClicked</code>.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">  <span class="token class-name">Answer</span> answer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token punctuation">(</span>mQuestion<span class="token punctuation">.</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;answer&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">      mQuestion<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>mSelectedOption<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">ModelHelper</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">DataManager</span><span class="token punctuation">.</span><span class="token function">getSharedInstance</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>database<span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This instantiates a new answer object and saves it using <code>ModelHelper.save</code>.</p><p>Build and run, select an answer and tap Submit.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image07.png" alt="image07" width="240" tabindex="0" loading="lazy"><figcaption>image07</figcaption></figure><p>Well done! You can now save answers to the database.</p><div class="hint-container tip"><p class="hint-container-title">Note</p><p>There’s no visual cue to indicate the answer was saved, but you should see the <code>doc_count</code> value increase at http://localhost:5984/quizzdroid</p></div><p>One more feature to add before you dive into synchronization is to display the image. The generic term in Couchbase is Attachment.</p><h3 id="using-attachments" tabindex="-1"><a class="header-anchor" href="#using-attachments"><span>Using Attachments</span></a></h3>`,10),Cn=n("code",null,"onCreate",-1),Sn=n("code",null,"QuestionActivity.java",-1),Qn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Revision</span> revision <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getCurrentRevision</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">Attachment</span> attachment <span class="token operator">=</span> revision<span class="token punctuation">.</span><span class="token function">getAttachment</span><span class="token punctuation">(</span><span class="token string">&quot;image&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>attachment <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    is <span class="token operator">=</span> attachment<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CouchbaseLiteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token class-name">Drawable</span> drawable <span class="token operator">=</span> <span class="token class-name">Drawable</span><span class="token punctuation">.</span><span class="token function">createFromStream</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mImageQuestion<span class="token punctuation">.</span><span class="token function">setImageDrawable</span><span class="token punctuation">(</span>drawable<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This uses the current document revision to load the attachment named image as an <code>InputStream</code>. It then converts the stream into a Drawable and assigns it to the <code>mImageQuestion</code> ImageView shown above the question.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image08.png" alt="image08" tabindex="0" loading="lazy"><figcaption>image08</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">Note</p><p>Make sure to import <code>java.io.InputStream</code> for the InputStream class, not the <code>com.couchbase</code> version.</p></div><p>Build and run your app; select a question and the image will appear:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image09.png" alt="image09" width="240" tabindex="0" loading="lazy"><figcaption>image09</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">Note</p><p>This Couchbase tutorial only covers how to read attachments. <a href="http://developer.couchbase.com/documentation/mobile/1.2/develop/guides/couchbase-lite/native-api/attachment/index.html" target="_blank" rel="noopener noreferrer">Refer to the Couchbase documentation</a> to learn how to save attachments with a write operation.</p></div><hr><h2 id="adding-synchronization" tabindex="-1"><a class="header-anchor" href="#adding-synchronization"><span>Adding Synchronization</span></a></h2><p>You will use Sync Gateway in what’s known as <em>walrus</em> mode, which is an in-memory, development-only mode. In production, you would install both Couchbase Server and Sync Gateway.</p><h3 id="installing-sync-gateway" tabindex="-1"><a class="header-anchor" href="#installing-sync-gateway"><span>Installing Sync Gateway</span></a></h3>`,11),Tn=n("a",{href:"http://www.couchbase.com/nosql-databases/downloads#couchbase-mobile",target:"_blank",rel:"noopener noreferrer"},"Download Sync Gateway community edition",-1),zn=n("code",null,"bin",-1),In=p(`<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ ~/Downloads/couchbase-sync-gateway/bin/sync_gateway <span class="token parameter variable">-dbname</span><span class="token operator">=</span><span class="token string">&quot;quizzdroid&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You should see <code>Starting server on localhost:4984</code> ... in your terminal window.</p><p>You can now head to http://localhost:4984 to check that it’s up and running:</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/05/browser.png" alt="browser" tabindex="0" loading="lazy"><figcaption>browser</figcaption></figure><p>Now that the Sync Gateway is running, you’ll add some code to replicate the database to the server.</p><h3 id="synchronization" tabindex="-1"><a class="header-anchor" href="#synchronization"><span>Synchronization</span></a></h3>`,6),Ln=n("code",null,"DataManager.java",-1),Dn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 1</span></span>
<span class="line"><span class="token class-name">URL</span> syncGatewayURL <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token class-name">String</span> <span class="token constant">SYNC_GATEWAY_URL</span> <span class="token operator">=</span> <span class="token string">&quot;http://localhost:4984/quizzdroid&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  syncGatewayURL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token constant">SYNC_GATEWAY_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2</span></span>
<span class="line">mPush <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">createPushReplication</span><span class="token punctuation">(</span>syncGatewayURL<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mPush<span class="token punctuation">.</span><span class="token function">setContinuous</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mPush<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3</span></span>
<span class="line">mPull <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">createPullReplication</span><span class="token punctuation">(</span>syncGatewayURL<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mPull<span class="token punctuation">.</span><span class="token function">setContinuous</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">mPull<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code segment does the following:</p><ol><li>Instantiates a URL pointing to http://localhost:4984/quizzdroid, which is your local Sync Gateway instance.</li><li>Starts a <a href="https://github.com/couchbase/couchbase-lite-ios/wiki/Replication#replication" target="_blank" rel="noopener noreferrer">push replication</a> in continuous mode, which is the operation that will send data from the local database to the server.</li><li>Starts a <a href="https://github.com/couchbase/couchbase-lite-ios/wiki/Replication#replication" target="_blank" rel="noopener noreferrer">pull replication</a> in continuous mode, which is the operation that will retrieve data from the server and save it to the local database.</li></ol><p>Before you can build and run, you’ll need to use an ADB command to ensure that QuizzDroid, running on a plugged-in device or emulator, can reach the server over localhost.</p><p>With the emulator running, run the following from the command line:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">adb reverse tcp:4984 tcp:4984</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Note</p><p>This command only works on devices running Android 5.0+ (API 21). Instead of setting up the reverse proxy, you can replace localhost in the previous code block with 10.0.2.2 for Android stock emulators, 10.0.3.2 for Genymotion emulators or, if you’re deploying to a device, the local IP address of your development machine.</p></div><p>Build and run your app; you should see a new document appear on the Sync Gateway admin UI (http://localhost:4985/_admin/db/quizzdroid, note the different port number) every time you answer a question.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/Sync-Gateway-UI-480x230.png" alt="Sync Gateway UI" tabindex="0" loading="lazy"><figcaption>Sync Gateway UI</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">Note</p><p>Using Android Studio’s Instant Run sometimes doesn’t set up the sync correctly; if you don’t see the documents in the Sync Gateway admin, try quitting the app and then build and run again.</p></div><p>So far so good, but what about displaying answers from other users? You’ll do exactly that in the next section.</p><hr><h2 id="aggregating-data" tabindex="-1"><a class="header-anchor" href="#aggregating-data"><span>Aggregating Data</span></a></h2><p>Data aggregation is a problem across many applications. Couchbase Lite lets you run those data queries using the full capabilities of map and reduce. To run aggregation queries on the rows emitted by the map function, you can use a reduce function to take several rows and aggregate them together in a single object.</p><p>You’ll write a view to query the number of answers for each possible choice. You’ll define a map function which returns the number of answers for each question, group them by their value and count the number of rows in each group.</p><p>The requirements for this query are:</p><ul><li>Get all answers that belong to a given question</li><li>Count the number of answers for each possible choice</li></ul><p>With that in mind, you can emit the <code>question_id</code> and <code>user_answer</code> fields as a compound key with a null value, while using a reduce function to count the number of emitted rows.</p>`,18),On=n("code",null,"Answer.java",-1),Gn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Query</span> <span class="token function">getAnswersForQuestion</span><span class="token punctuation">(</span><span class="token class-name">Database</span> database<span class="token punctuation">,</span> <span class="token class-name">String</span> questionId<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token class-name">View</span> view <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token string">&quot;app/answers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">getMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    view<span class="token punctuation">.</span><span class="token function">setMapReduce</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Mapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token annotation punctuation">@Override</span></span>
<span class="line">      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> document<span class="token punctuation">,</span> <span class="token class-name">Emitter</span> emitter<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;answer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          keys<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> document<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;question_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          keys<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> document<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;user_answer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Reducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token annotation punctuation">@Override</span></span>
<span class="line">      <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> keys<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token keyword">boolean</span> rereduce<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token class-name">Query</span> query <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  query<span class="token punctuation">.</span><span class="token function">setGroupLevel</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  query<span class="token punctuation">.</span><span class="token function">setStartKey</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>questionId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  query<span class="token punctuation">.</span><span class="token function">setEndKey</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>questionId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> query<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Grouping is a powerful feature of Couchbase. It’s available on a Query using the numeric <code>groupLevel</code> property, which defaults to 0. It takes the entire range of rows from the query and coalesces together adjacent rows with the same key.</p><p>Notice that <code>groupingLevel = 2</code> coalesces the rows by key. Keys that are arrays are called <strong>compound keys</strong>; a group level of 2 means the query will coalesce rows with the same <code>question_id</code> and <code>user_answer</code>.</p><p>You can read more about <code>setStartKey()</code> and <code>setEndKey()</code> in the Couchbase <a href="http://developer.couchbase.com/documentation/mobile/current/develop/guides/couchbase-lite/native-api/query/index.html" target="_blank" rel="noopener noreferrer">documentation for configuring queries</a>.</p><hr><h2 id="run-the-query" tabindex="-1"><a class="header-anchor" href="#run-the-query"><span>Run the Query</span></a></h2>`,6),Mn=n("code",null,"QuestionActivity.java",-1),Rn=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAnswerCounts</span><span class="token punctuation">(</span><span class="token class-name">QueryEnumerator</span> answers<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> answerCounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> option<span class="token operator">:</span> mQuestion<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    answerCounts<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>option<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">QueryRow</span> row <span class="token operator">:</span> answers<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">LazyJsonArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LazyJsonArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> row<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> answer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    answerCounts<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>answer<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span>row<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> answerCounts<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The above method takes a <code>QueryEnumerator</code> returned from <code>getAnswersForQuestion()</code> and returns a <code>Map</code> that stores an answer count for each option. The map object makes it quick and easy to access answer counts for each option.</p><p>Add the following code to <code>onCreate()</code>, just before the line <code>mQuestionOptions = (GridView) findViewById(R.id.question_options)</code>:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Query</span> answers <span class="token operator">=</span> <span class="token class-name">Answer</span><span class="token punctuation">.</span><span class="token function">getAnswersForQuestion</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>database<span class="token punctuation">,</span> mQuestion<span class="token punctuation">.</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">QueryEnumerator</span> answersQuery <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  answersQuery <span class="token operator">=</span> answers<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CouchbaseLiteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code stores a <code>QueryEnumerator</code> to be used when calling <code>getAnswerCounts()</code> below.</p><p>Next, find the call to <code>mQuestionOptions.setAdapter(new QuestionOptionsAdapter(mQuestion.getOptions(), null));</code> and replace it with this line:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">mQuestionOptions<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QuestionOptionsAdapter</span><span class="token punctuation">(</span>mQuestion<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">getAnswerCounts</span><span class="token punctuation">(</span>answersQuery<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>This passes the <code>Map</code> returned from <code>getAnswerCounts()</code> into the GridView adapter, allowing it to display answer counts.</p><h3 id="add-a-livequery" tabindex="-1"><a class="header-anchor" href="#add-a-livequery"><span>Add a LiveQuery</span></a></h3><p>Next, you’ll add the method to set up a LiveQuery to keep the answer counts updated. A LiveQuery is a great way to keep your interface updated with database changes. It automatically refreshes any time Database changes affect your query.</p>`,10),Vn=n("code",null,"QuestionActivity.java",-1),En=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showAnswers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token class-name">DataManager</span> manager <span class="token operator">=</span> <span class="token class-name">DataManager</span><span class="token punctuation">.</span><span class="token function">getSharedInstance</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">Query</span> answersQuery <span class="token operator">=</span> <span class="token class-name">Answer</span><span class="token punctuation">.</span><span class="token function">getAnswersForQuestion</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>database<span class="token punctuation">,</span> mQuestion<span class="token punctuation">.</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token class-name">LiveQuery</span> liveQuery <span class="token operator">=</span> answersQuery<span class="token punctuation">.</span><span class="token function">toLiveQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  liveQuery<span class="token punctuation">.</span><span class="token function">addChangeListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LiveQuery<span class="token punctuation">.</span>ChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changed</span><span class="token punctuation">(</span><span class="token class-name">LiveQuery<span class="token punctuation">.</span>ChangeEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token class-name">QueryEnumerator</span> result <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> counts <span class="token operator">=</span> <span class="token function">getAnswerCounts</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">final</span> <span class="token class-name">QuestionOptionsAdapter</span> adapter <span class="token operator">=</span></span>
<span class="line">          <span class="token punctuation">(</span><span class="token class-name">QuestionOptionsAdapter</span><span class="token punctuation">)</span>mQuestionOptions<span class="token punctuation">.</span><span class="token function">getAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      adapter<span class="token punctuation">.</span><span class="token function">setAnswerCounts</span><span class="token punctuation">(</span>counts<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token annotation punctuation">@Override</span></span>
<span class="line">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          adapter<span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  liveQuery<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code starts by creating a <code>LiveQuery</code> from <code>Answer.getAnswersForQuestion</code>.</p><p>You then add a <code>ChangeListener</code> to the <code>liveQuery</code> object. The <code>liveQuery</code> object calls the <code>changed</code> method when required, and passes to it a <code>ChangeEvent</code> object.</p><p>Next, you use the previously created <code>getAnswerCounts</code> to return the map of answer counts, which is passed to the GridView adapter to refresh the counts in the UI.</p><p><code>Activity.runOnUiThread</code> updates the GridView on the UI thread.</p>`,5),Nn=n("code",null,"onCreate",-1),Hn=n("code",null,"QuestionActivity.java",-1),Un=p(`<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token function">showAnswers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Build and run your app; open a question and answer it (note that you can answer it more than once).</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image10.png" alt="image10" width="240" tabindex="0" loading="lazy"><figcaption>image10</figcaption></figure><p>Great job! You can now see your own answers, but what about those from other users?</p><p>By running two instances of the app at the same time, both accessing the same Sync Gateway, you will have real-time visibility into other user’s answers!</p><hr><h2 id="simulating-multiple-users" tabindex="-1"><a class="header-anchor" href="#simulating-multiple-users"><span>Simulating Multiple Users</span></a></h2><p>In order to simulate other users answering the questions, you can run the app on a second emulator.</p><p>From Android Studio, you can deploy the app on multiple devices simultaneously using the <code>[Run]</code> button and <kbd>Shift</kbd> key :</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/deploy-multiple-devices.png" alt="deploy-multiple-devices" tabindex="0" loading="lazy"><figcaption>deploy-multiple-devices</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">Note</p><p>The above won’t work in Debug mode, so if you’re having difficulty, be sure to use the <code>[Run]</code> command in Android Studio, not <code>[Debug]</code>.</p></div><p>If your using the reverse proxy method, you will need to make sure it is enabled for both devices. List the running emulators with the following:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">adb devices</span>
<span class="line"><span class="token comment"># </span></span>
<span class="line"><span class="token comment"># List of devices attached</span></span>
<span class="line"><span class="token comment"># emulator-5556	device</span></span>
<span class="line"><span class="token comment"># emulator-5554	device</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With more than one emulator device, you must specify the device in ADB commands. Enable the reverse proxy for access to Sync Gateway on both devices:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">adb <span class="token parameter variable">-s</span> emulator-5554 reverse tcp:4984 tcp:4984</span>
<span class="line">adb <span class="token parameter variable">-s</span> emulator-5556 reverse tcp:4984 tcp:4984</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Now you can start answering questions on both devices. Notice the answers are updated automatically across emulators due to the live query.</p><figure><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/image11-3.gif" alt="image11" tabindex="0" loading="lazy"><figcaption>image11</figcaption></figure><p>Well done! You’ve built a shareable quiz application that works equally well when it’s offline.</p><hr><h2 id="where-to-go-from-here" tabindex="-1"><a class="header-anchor" href="#where-to-go-from-here"><span>Where to Go From Here?</span></a></h2>`,20),Bn=n("a",{href:"https://koenig-media.raywenderlich.com/uploads/2016/09/quizzdroid-final.zip",target:"_blank",rel:"noopener noreferrer"},"downloadable zip",-1),Pn={href:"https://github.com/jamiltz/quizzdroid",target:"_blank",rel:"noopener noreferrer"},Fn=n("a",{href:"http://developer.couchbase.com/documentation/mobile/1.2/develop/guides/couchbase-lite/native-api/index.html",target:"_blank",rel:"noopener noreferrer"},"Couchbase Lite Guides",-1),Yn={href:"https://github.com/couchbaselabs/photo-drop",target:"_blank",rel:"noopener noreferrer"},Wn=n("code",null,"couchbaselabs/photo-drop",-1),Jn={href:"https://github.com/couchbaselabs/todolite-android",target:"_blank",rel:"noopener noreferrer"},Kn=n("code",null,"couchbaselabs/todolite-android",-1),Zn=n("p",null,[s("If you found this tutorial interesting, you might want to try adding peer-to-peer sync capabilities. Start by replacing the remote URL pointing to a Sync Gateway instance with one from another device on the same local network. The challenge in this case is discovering the IP addresses of peer devices. One solution that works well is to use "),n("a",{href:"https://developer.android.com/reference/android/net/nsd/NsdManager.html",target:"_blank",rel:"noopener noreferrer"},"NsdManager"),s(", the Android implementation of mDNS.")],-1),Xn=n("p",null,"Feel free to share your feedback, findings and ask any questions in the comments below or in the forums!",-1),$n=n("hr",null,null,-1);function ns(c,ss){const l=i("VPCard"),t=i("router-link"),u=i("SiteInfo"),e=i("FontIcon"),r=i("TagLinks");return v(),k("div",null,[n("h1",y,[n("a",f,[n("span",null,h(c.$frontmatter.title)+" 관련",1)])]),a(l,m(g({title:"Android > Article(s)",desc:"Article(s)",link:"/programming/java-android/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",w,[n("ul",null,[n("li",null,[a(t,{to:"#getting-started"},{default:o(()=>[s("Getting Started")]),_:1})]),n("li",null,[a(t,{to:"#using-the-prebuilt-database"},{default:o(()=>[s("Using the Prebuilt Database")]),_:1})]),n("li",null,[a(t,{to:"#initializing-the-database"},{default:o(()=>[s("Initializing the Database")]),_:1})]),n("li",null,[a(t,{to:"#database-listener"},{default:o(()=>[s("Database Listener")]),_:1})]),n("li",null,[a(t,{to:"#the-home-screen"},{default:o(()=>[s("The Home Screen")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#data-modeling"},{default:o(()=>[s("Data Modeling")]),_:1})]),n("li",null,[a(t,{to:"#pojo-classes"},{default:o(()=>[s("POJO Classes")]),_:1})]),n("li",null,[a(t,{to:"#indexing-data"},{default:o(()=>[s("Indexing Data")]),_:1})]),n("li",null,[a(t,{to:"#querying-and-displaying-data"},{default:o(()=>[s("Querying and Displaying Data")]),_:1})])])]),n("li",null,[a(t,{to:"#home-activity-→-question-activity"},{default:o(()=>[s("Home Activity → Question Activity")]),_:1})]),n("li",null,[a(t,{to:"#the-question-screen"},{default:o(()=>[s("The Question Screen")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#loading-the-question-data"},{default:o(()=>[s("Loading the Question Data")]),_:1})]),n("li",null,[a(t,{to:"#multiple-choice-in-a-gridview"},{default:o(()=>[s("Multiple Choice in a GridView")]),_:1})]),n("li",null,[a(t,{to:"#writing-data"},{default:o(()=>[s("Writing Data")]),_:1})]),n("li",null,[a(t,{to:"#using-attachments"},{default:o(()=>[s("Using Attachments")]),_:1})])])]),n("li",null,[a(t,{to:"#adding-synchronization"},{default:o(()=>[s("Adding Synchronization")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#installing-sync-gateway"},{default:o(()=>[s("Installing Sync Gateway")]),_:1})]),n("li",null,[a(t,{to:"#synchronization"},{default:o(()=>[s("Synchronization")]),_:1})])])]),n("li",null,[a(t,{to:"#aggregating-data"},{default:o(()=>[s("Aggregating Data")]),_:1})]),n("li",null,[a(t,{to:"#run-the-query"},{default:o(()=>[s("Run the Query")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#add-a-livequery"},{default:o(()=>[s("Add a LiveQuery")]),_:1})])])]),n("li",null,[a(t,{to:"#simulating-multiple-users"},{default:o(()=>[s("Simulating Multiple Users")]),_:1})]),n("li",null,[a(t,{to:"#where-to-go-from-here"},{default:o(()=>[s("Where to Go From Here?")]),_:1})])])]),_,a(u,{name:"Couchbase Tutorial for Android - Getting Started",desc:"In this couchbase tutorial, you will learn how to use prebuilt Couchbase Lite databases, model, query, upload and sync data including attachments.",url:"https://kodeco.com/853-couchbase-tutorial-for-android-getting-started",logo:"https://assets.carolus.kodeco.com/assets/murakami/category-icons/category-networking-android-56e153082b082a0e4dde87ceadfa482ce6812758e8d896a3f0b37732c718bd96.svg",preview:"https://koenig-media.raywenderlich.com/uploads/2016/08/CouchbaseAndroid-twitter.png"}),q,n("p",null,[s("In this Couchbase tutorial, you will use a database containing a list of questions. "),x,s(" and move the zip file to "),a(e,{icon:"fas fa-folder-open"}),s(),j,s(" in the starter project:")]),A,n("p",null,[s("The database starts in the "),a(e,{icon:"fas fa-folder-open"}),s(),C,s(" folder, but Couchbase Lite reads from and persists to the "),a(e,{icon:"fas fa-folder-open"}),s(),S,s(" folder. In the next section you’ll add code to move the database to its final location.")]),Q,T,n("p",null,[s("Open "),a(e,{icon:"fa-brands fa-java"}),z,s(". This is a singleton class providing access to the database instance throughout the application. Add the following to the constructor:")]),I,n("ol",null,[L,D,n("li",null,[s("If the database doesn’t exist, the "),O,s(" method unzips the zip database file into the "),a(e,{icon:"fas fa-folder-open"}),s(),G,s(" directory; otherwise, nothing further needs to be done.")]),M]),R,n("p",null,[s("Back in "),a(e,{icon:"fa-brands fa-java"}),V,s(", add the following below the existing code in the constructor method:")]),E,n("p",null,[s("Open "),a(e,{icon:"fas fa-folder-open"}),N,s("/"),a(e,{icon:"fa-brands fa-java"}),H,s(" and add the following instance variables:")]),U,n("p",null,[s("Add the following static method to "),a(e,{icon:"fas fa-folder-open"}),B,s("/"),a(e,{icon:"fa-brands fa-java"}),P,s(":")]),F,n("p",null,[s("Add the following code to the end of the "),Y,s(" method in "),a(e,{icon:"fa-brands fa-java"}),W,s(":")]),J,n("p",null,[s("Notice the call to "),K,s(". Open "),a(e,{icon:"fa-brands fa-java"}),Z,s(", and take a look at "),X,s(". It uses the Jackson library to convert the properties in the question "),$,s(" object to the "),nn,s(" object.")]),n("p",null,[s("If you run the app, the screen will still be blank because the Recycler View isn’t drawing the rows. In "),a(e,{icon:"fas fa-folder-open"}),sn,s("/"),a(e,{icon:"fa-brands fa-java"}),an,s(", add the following code to "),en,s(":")]),tn,n("p",null,[s("Head back to "),a(e,{icon:"fa-brands fa-java"}),on,s(" and add the following code to the end of "),pn,s(":")]),cn,n("p",null,[s("Open "),a(e,{icon:"fa-brands fa-java"}),ln,s(" and paste the following at the end of "),un,s(":")]),rn,n("p",null,[s("Add the following method to"),a(e,{icon:"fa-brands fa-java"}),dn]),n("p",null,[s("To display the choices, add the following to the end of onCreate in "),a(e,{icon:"fa-brands fa-java"}),kn,s(":")]),hn,n("p",null,[s("Create a new file "),a(e,{icon:"fas fa-folder-open"}),mn,a(e,{icon:"fa-brands fa-java"}),gn,s(" and add to it the following instance variables:")]),vn,n("p",null,[s("To create Answer instances, add the following constructor in "),a(e,{icon:"fas fa-folder-open"}),bn,a(e,{icon:"fa-brands fa-java"}),yn,s(":")]),fn,n("p",null,[s("To save an answer, you’ll add a button with a click handler. Open "),a(e,{icon:"iconfont icon-code"}),wn,s(" and add the following Button element below the GridView:")]),_n,n("p",null,[s("Within "),a(e,{icon:"iconfont icon-code"}),qn,s(", create a click handler with the "),xn,s("+"),jn,s(" shortcut:")]),An,n("p",null,[s("Add the following code to the end of "),Cn,s(" in "),a(e,{icon:"fa-brands fa-java"}),Sn,s(":")]),Qn,n("p",null,[Tn,s(" and unzip the file. The executable is located in the "),a(e,{icon:"fas fa-folder-open"}),s(),zn,s(" folder. If you unzipped the file to the Downloads folder, start it with this command:")]),In,n("p",null,[s("Set up the push and pull replications by adding the following code to the end of the constructor in "),a(e,{icon:"fa-brands fa-java"}),Ln,s(".")]),Dn,n("p",null,[s("Add the following class method to "),a(e,{icon:"fa-brands fa-java"}),On,s(":")]),Gn,n("p",null,[s("Time to run the query and use the results. Add the following method to "),a(e,{icon:"fa-brands fa-java"}),Mn,s(":")]),Rn,n("p",null,[s("In "),a(e,{icon:"fa-brands fa-java"}),Vn,s(", add the following method:")]),En,n("p",null,[s("Add the following line to the end of "),Nn,s(" in "),a(e,{icon:"fa-brands fa-java"}),Hn,s(".")]),Un,n("p",null,[s("You can get the full source code for this project as a "),Bn,s(" or as a "),n("a",Pn,[a(e,{icon:"iconfont icon-github"}),s(" repo")]),s(" on GitHub.")]),n("p",null,[s("The "),Fn,s(" have detailed explanation for every concept covered in this Couchbase tutorial. Also check out "),n("a",Yn,[a(e,{icon:"iconfont icon-github"}),s(),Wn]),s(", a peer-to-peer photo sharing application and "),n("a",Jn,[a(e,{icon:"iconfont icon-github"}),s(),Kn]),s(", a multi-user todo list application, both built on Couchbase.")]),Zn,Xn,$n,a(r)])}const ts=d(b,[["render",ns],["__file","853-couchbase-tutorial-for-android-getting-started.html.vue"]]),os=JSON.parse('{"path":"/kodeco.com/853-couchbase-tutorial-for-android-getting-started.html","title":"Couchbase Tutorial for Android - Getting Started","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Couchbase Tutorial for Android - Getting Started","description":"Article(s) > Couchbase Tutorial for Android - Getting Started","icon":"fa-brands fa-android","category":["Java","Android","Gradle","Article(s)"],"tag":["blog","kodeco.com","java","android","gradle","couchbase"],"head":[[{"meta":null},{"property":"og:title","content":"Couchbase Tutorial for Android - Getting Started"},{"property":"og:description","content":"Article(s) > Couchbase Tutorial for Android - Getting Started"},{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/kotlin-android-kodeco/853-couchbase-tutorial-for-android-getting-started.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/kodeco.com/853-couchbase-tutorial-for-android-getting-started.html"}],["meta",{"property":"og:site_name","content":"📚Bookshelf"}],["meta",{"property":"og:title","content":"Couchbase Tutorial for Android - Getting Started"}],["meta",{"property":"og:description","content":"Article(s) > Couchbase Tutorial for Android - Getting Started"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://koenig-media.raywenderlich.com/uploads/2016/08/CouchbaseAndroid-twitter.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://koenig-media.raywenderlich.com/uploads/2016/08/CouchbaseAndroid-twitter.png"}],["meta",{"name":"twitter:image:alt","content":"Couchbase Tutorial for Android - Getting Started"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"kodeco.com"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"android"}],["meta",{"property":"article:tag","content":"gradle"}],["meta",{"property":"article:tag","content":"couchbase"}],["meta",{"property":"article:published_time","content":"2017-11-16T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Couchbase Tutorial for Android - Getting Started\\",\\"image\\":[\\"https://koenig-media.raywenderlich.com/uploads/2016/07/demo.gif =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image01.png =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/drag-db-finder-1.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/diagrams.002.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image02.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/diagrams.003.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/getter-setters-1.gif\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/diagrams.005.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image03.png =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image04.gif =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image05.png =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image06.png =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image06-1.gif\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/onclick.gif\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image07.png =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image08.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image09.png =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/05/browser.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/Sync-Gateway-UI-480x230.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image10.png =240x\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/deploy-multiple-devices.png\\",\\"https://koenig-media.raywenderlich.com/uploads/2016/07/image11-3.gif\\"],\\"datePublished\\":\\"2017-11-16T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"]],"prev":"/programming/java-android/articles/README.md","date":"2017-11-16T00:00:00.000Z","isOriginal":false,"cover":"https://koenig-media.raywenderlich.com/uploads/2016/08/CouchbaseAndroid-twitter.png"},"headers":[{"level":2,"title":"Getting Started","slug":"getting-started","link":"#getting-started","children":[]},{"level":2,"title":"Using the Prebuilt Database","slug":"using-the-prebuilt-database","link":"#using-the-prebuilt-database","children":[]},{"level":2,"title":"Initializing the Database","slug":"initializing-the-database","link":"#initializing-the-database","children":[]},{"level":2,"title":"Database Listener","slug":"database-listener","link":"#database-listener","children":[]},{"level":2,"title":"The Home Screen","slug":"the-home-screen","link":"#the-home-screen","children":[{"level":3,"title":"Data Modeling","slug":"data-modeling","link":"#data-modeling","children":[]},{"level":3,"title":"POJO Classes","slug":"pojo-classes","link":"#pojo-classes","children":[]},{"level":3,"title":"Indexing Data","slug":"indexing-data","link":"#indexing-data","children":[]},{"level":3,"title":"Querying and Displaying Data","slug":"querying-and-displaying-data","link":"#querying-and-displaying-data","children":[]}]},{"level":2,"title":"Home Activity → Question Activity","slug":"home-activity-→-question-activity","link":"#home-activity-→-question-activity","children":[]},{"level":2,"title":"The Question Screen","slug":"the-question-screen","link":"#the-question-screen","children":[{"level":3,"title":"Loading the Question Data","slug":"loading-the-question-data","link":"#loading-the-question-data","children":[]},{"level":3,"title":"Multiple Choice in a GridView","slug":"multiple-choice-in-a-gridview","link":"#multiple-choice-in-a-gridview","children":[]},{"level":3,"title":"Writing Data","slug":"writing-data","link":"#writing-data","children":[]},{"level":3,"title":"Using Attachments","slug":"using-attachments","link":"#using-attachments","children":[]}]},{"level":2,"title":"Adding Synchronization","slug":"adding-synchronization","link":"#adding-synchronization","children":[{"level":3,"title":"Installing Sync Gateway","slug":"installing-sync-gateway","link":"#installing-sync-gateway","children":[]},{"level":3,"title":"Synchronization","slug":"synchronization","link":"#synchronization","children":[]}]},{"level":2,"title":"Aggregating Data","slug":"aggregating-data","link":"#aggregating-data","children":[]},{"level":2,"title":"Run the Query","slug":"run-the-query","link":"#run-the-query","children":[{"level":3,"title":"Add a LiveQuery","slug":"add-a-livequery","link":"#add-a-livequery","children":[]}]},{"level":2,"title":"Simulating Multiple Users","slug":"simulating-multiple-users","link":"#simulating-multiple-users","children":[]},{"level":2,"title":"Where to Go From Here?","slug":"where-to-go-from-here","link":"#where-to-go-from-here","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":1}]},"readingTime":{"minutes":16.84,"words":5053},"filePathRelative":"kodeco.com/853-couchbase-tutorial-for-android-getting-started.md","localizedDate":"2017년 11월 16일","excerpt":"\\n"}');export{ts as comp,os as data};
