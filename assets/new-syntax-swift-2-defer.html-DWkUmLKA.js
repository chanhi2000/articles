import{_ as r}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as u,b as n,t as d,e as s,n as i,g as p,w as e,f as k,r as l,o as f,d as t}from"./app-BgNevrm5.js";const h={},w={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},m={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},g={class:"table-of-contents"},y=n("hr",null,null,-1),v=k(`<p>Swift&#39;s <code>defer</code> keyword lets us set up some work to be performed when the current scope exits. For example, you might want to make sure that some temporary resources are cleaned up once a method exits, and <code>defer</code> will make sure that happens no matter how that exit happens.</p><hr><h2 id="how-it-used-to-be-messy-returns" tabindex="-1"><a class="header-anchor" href="#how-it-used-to-be-messy-returns"><span>How it used to be: messy returns</span></a></h2><p>Here&#39;s some dummy Swift code that opens a file, writes some data, then closes the file:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">writeLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token function">openFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> hardwareStatus <span class="token operator">=</span> <span class="token function">fetchHardwareStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">guard</span> hardwareStatus <span class="token operator">!=</span> <span class="token string-literal"><span class="token string">&quot;disaster&quot;</span></span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line">    file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>hardwareStatus<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> softwareStatus <span class="token operator">=</span> <span class="token function">fetchSoftwareStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">guard</span> softwareStatus <span class="token operator">!=</span> <span class="token string-literal"><span class="token string">&quot;disaster&quot;</span></span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line">    file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>softwareStatus<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> networkStatus <span class="token operator">=</span> <span class="token function">fetchNetworkStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">guard</span> neworkStatus <span class="token operator">!=</span> <span class="token string-literal"><span class="token string">&quot;disaster&quot;</span></span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line">    file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>networkStatus<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">closeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I&#39;m not going to try to fill in any code for the methods in there, they are hopefully self-explanatory. As you can see, a file is opened, then various types of data are written out, before finally the file is closed.</p><p>But what happens if any one of those status checks returns &quot;disaster&quot;? Answer: our guard condition will trap the error and exit the method ‚Äì <em>leaving the file open</em>.</p><p>There were two solutions to this, neither of which were nice. The first was to copy and paste the call to <code>closeFile()</code> so that it is called before any of those <code>returns</code>. The second was to create a pyramid of doom, with several stacked conditional statements to handle writing.</p><p>Swift 2 solves this problem, but does so in a simple and clear way: the <code>defer</code> keyword.</p><hr><h2 id="deferring-work-in-swift-2-defer" tabindex="-1"><a class="header-anchor" href="#deferring-work-in-swift-2-defer"><span>Deferring work in Swift 2: <code>defer</code></span></a></h2><p>Swift 2 introduces the <code>defer</code> keyword, which effectively means &quot;here&#39;s some what I want you to do later, no matter what.&quot; That work can be whatever you want: a single method call closing a file, or 50 lines of code doing some other important clean up work. The important thing is that Swift ensures that it will be run before the current scope is ended.</p><p>So, we could rewrite the above code like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">writeLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token function">openFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token punctuation">{</span> <span class="token function">closeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> hardwareStatus <span class="token operator">=</span> <span class="token function">fetchHardwareStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">guard</span> hardwareStatus <span class="token operator">!=</span> <span class="token string-literal"><span class="token string">&quot;disaster&quot;</span></span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line">    file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>hardwareStatus<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> softwareStatus <span class="token operator">=</span> <span class="token function">fetchSoftwareStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">guard</span> softwareStatus <span class="token operator">!=</span> <span class="token string-literal"><span class="token string">&quot;disaster&quot;</span></span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line">    file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>softwareStatus<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> networkStatus <span class="token operator">=</span> <span class="token function">fetchNetworkStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">guard</span> neworkStatus <span class="token operator">!=</span> <span class="token string-literal"><span class="token string">&quot;disaster&quot;</span></span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line">    file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>networkStatus<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With that <code>defer</code> call in place, <code>closeFile()</code> will be called no matter which of the <code>guards</code> are triggered, or even if none of them trigger and the method completes normally.</p><p>That&#39;s what I mean when I say that deferred work will always take place: if you return from a method at the end or part way through, or if you exit a method by throwing an error, your deferred work will take place.</p><p>This makes it perfect for ensuring code is cleaned up under all conditions, and is similar to <code>try/finally</code> in other languages.</p><hr><h2 id="defer-scope-in-swift-2" tabindex="-1"><a class="header-anchor" href="#defer-scope-in-swift-2"><span>Defer scope in Swift 2</span></a></h2><p>Using <code>defer</code> inside a method means that its work will be executed as the method is exiting. For example:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 1&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">myFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 5&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function-definition function">myFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 2&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 3&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 4&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That will print &quot;Step 1&quot;, &quot;Step 2&quot;, &quot;Step 4&quot;, &quot;Step 3&quot;, &quot;Step 5&quot; ‚Äì steps 3 and 4 are switched because 3 is deferred until the <code>myFunc()</code> method ends, i.e. when it goes out of scope programmatically.</p><p>This scope is effectively anything in braces, { and }, but realistically there are two main ways you may want to use it: inside a <code>do</code> block and inside a loop.</p><p><code>do</code> blocks are usually used with <code>catch</code> to handle errors smoothly, but you don&#39;t need that ‚Äì you can use <code>do</code> to create a temporary scope anywhere inside your method. Any variables created inside the <code>do</code> block exist only there, and any work you defer inside the block will execute as soon as the closing brace of the block is reached.</p><p>For example:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 1&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 2&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 3&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 4&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Step 5&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When that runs, you&#39;ll see 1, 3, 4, 2, 5 because 2 is deferred until the end of the <code>do</code> block.</p><p>As I said, loops are also natural places you might want to use <code>defer</code>, and it will execute at the end of each loop iteration. For example:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">10</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;In </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token punctuation">{</span> <span class="token function">print</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Deferred </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">print</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Out </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="you-can-defer-multiple-things" tabindex="-1"><a class="header-anchor" href="#you-can-defer-multiple-things"><span>You can <code>defer</code> multiple things</span></a></h2><p>One of the most powerful features of <code>defer</code> is that you can stack up multiple deferred pieces of work, and Swift will ensure they all get executed. What&#39;s more, it executes them in reverse order, meaning that the most recently deferred thing gets run first ‚Äì effectively unwinding a stack.</p><p>Not only does this mean you can defer work without having to worry about what if anything was already deferred, but also that Swift safely unwinds its <code>defer</code> stack based on the order you chose.</p><p>There is one catch, albeit a minor one: your <code>defer</code> calls shouldn&#39;t try to exit the current scope using something like a <code>return</code> call or throwing an error. Other than that, you&#39;re good to go!</p>`,34);function b(c,S){const o=l("VPCard"),a=l("router-link");return f(),u("div",null,[n("h1",w,[n("a",m,[n("span",null,d(c.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),s(o,i(p({title:"Swift > Article(s)",desc:"Article(s)",link:"/programming/swift/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",g,[n("ul",null,[n("li",null,[s(a,{to:"#how-it-used-to-be-messy-returns"},{default:e(()=>[t("How it used to be: messy returns")]),_:1})]),n("li",null,[s(a,{to:"#deferring-work-in-swift-2-defer"},{default:e(()=>[t("Deferring work in Swift 2: defer")]),_:1})]),n("li",null,[s(a,{to:"#defer-scope-in-swift-2"},{default:e(()=>[t("Defer scope in Swift 2")]),_:1})]),n("li",null,[s(a,{to:"#you-can-defer-multiple-things"},{default:e(()=>[t("You can defer multiple things")]),_:1})])])]),y,s(o,i(p({title:"The defer keyword in Swift: try/finally done right ‚Äì Hacking with Swift",desc:"The defer keyword in Swift: try/finally done right",link:"https://hackingwithswift.com/new-syntax-swift-2-defer",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),v])}const _=r(h,[["render",b],["__file","new-syntax-swift-2-defer.html.vue"]]),T=JSON.parse('{"path":"/hackingwithswift.com/new-syntax-swift-2-defer.html","title":"The defer keyword in Swift: try/finally done right","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"The defer keyword in Swift: try/finally done right","description":"The defer keyword in Swift: try/finally done right","icon":"fa-brands fa-swift","category":["Swift","Article(s)"],"tag":["blog","hackingwithswift.com","crashcourse","swift","swift-2.0","xcode"],"head":[[{"meta":null},{"property":"og:title","content":"The defer keyword in Swift: try/finally done right"},{"property":"og:description","content":"The defer keyword in Swift: try/finally done right"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/new-syntax-swift-2-defer.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/new-syntax-swift-2-defer.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"The defer keyword in Swift: try/finally done right"}],["meta",{"property":"og:description","content":"The defer keyword in Swift: try/finally done right"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"hackingwithswift.com"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"swift-2.0"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:published_time","content":"2019-09-23T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"The defer keyword in Swift: try/finally done right\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2019-09-23T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"]],"prev":"/programming/swift/articles/README.md","date":"2019-09-23T00:00:00.000Z","isOriginal":false},"headers":[{"level":2,"title":"How it used to be: messy returns","slug":"how-it-used-to-be-messy-returns","link":"#how-it-used-to-be-messy-returns","children":[]},{"level":2,"title":"Deferring work in Swift 2: defer","slug":"deferring-work-in-swift-2-defer","link":"#deferring-work-in-swift-2-defer","children":[]},{"level":2,"title":"Defer scope in Swift 2","slug":"defer-scope-in-swift-2","link":"#defer-scope-in-swift-2","children":[]},{"level":2,"title":"You can defer multiple things","slug":"you-can-defer-multiple-things","link":"#you-can-defer-multiple-things","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":3.31,"words":994},"filePathRelative":"hackingwithswift.com/new-syntax-swift-2-defer.md","localizedDate":"2019ÎÖÑ 9Ïõî 23Ïùº","excerpt":"\\n"}');export{_ as comp,T as data};
