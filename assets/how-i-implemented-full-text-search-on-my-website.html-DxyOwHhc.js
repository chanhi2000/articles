import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,b as n,t as h,e as a,n as m,g,w as e,d as s,f as c,r as o,o as v}from"./app-BgNevrm5.js";const f={},b={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},y={class:"table-of-contents"},x=n("hr",null,null,-1),_=c(`<p>So, I&#39;ve got this blog I&#39;ve been running for a couple of years now. It&#39;s a Next.js and TypeScript static site, all optimized for SEO. Sounds pretty standard, right? Well, it was, until I ran into a problem.</p><p>As my content grew, finding specific articles became a real pain. It wasn&#39;t just me - readers were struggling too. What&#39;s the point of writing all this stuff if no one can find it when they need it?</p><p>That&#39;s when I decided to look into full-text search. Now, implementing full-text search on a static site isn&#39;t exactly straightforward. It&#39;s not like you can just slap a database on there and call it a day. You&#39;ve got to get creative.</p><p>In this article, I&#39;ll walk you through how I turned my site&#39;s search from useless to actually functional.</p><hr><h2 id="the-old-search-approach" tabindex="-1"><a class="header-anchor" href="#the-old-search-approach"><span>The Old Search Approach</span></a></h2><p>Here&#39;s how the search function worked before:</p><ol><li>I would generate a JSON document at build time containing each blog post&#39;s metadata. This document contains the data needed to perform the search and render the results.</li><li>When searching the articles, I would fetch the JSON document on the client and perform the search. Since this document changes only once a week, I can cache it on the client to improve performance.</li></ol><p>Here&#39;s the code that would generate the search data JSON document:</p><div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx" data-title="jsx"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">generateSearchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> searchData <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">slug</span><span class="token operator">:</span> post<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>slug<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">title</span><span class="token operator">:</span> post<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">excerpt</span><span class="token operator">:</span> post<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>excerpt<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">coverImage</span><span class="token operator">:</span> post<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>coverImage<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">date</span><span class="token operator">:</span> post<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>date<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">searchableContent</span><span class="token operator">:</span></span>
<span class="line">      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>post<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>post<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>excerpt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>post<span class="token punctuation">.</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token string">&#39;./search&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span></span>
<span class="line">    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;search&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;search-data.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>searchData<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And then the search function is pretty simple (but not very smart):</p><div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx" data-title="jsx"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function">search</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/search/search-data.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> searchData <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> searchData<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    p<span class="token punctuation">.</span>searchableContent<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>keyword<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This approach has a few issues:</p><ul><li>The search data JSON document is large (861KB) and will continue to grow</li><li>It&#39;s slow on large datasets and won&#39;t scale well</li><li>It uses an exact match to find results</li><li>It doesn&#39;t rank results by relevance</li></ul><p>I wasn&#39;t happy with this, so here&#39;s how I implemented a much better solution.</p><hr><h2 id="introducing-full-text-search" tabindex="-1"><a class="header-anchor" href="#introducing-full-text-search"><span>Introducing Full-Text Search</span></a></h2>`,17),I=n("strong",null,"full-text search",-1),S={href:"https://lunrjs.com/",target:"_blank",rel:"noopener noreferrer"},T=n("p",null,"Full-text search is a technique that allows fast and efficient searching of large volumes of text by creating an index of all words in a document collection and returning ranked results based on relevance to the search query.",-1),j=n("p",null,"Full-text search works by:",-1),F=n("ol",null,[n("li",null,[n("strong",null,"Indexing"),s(": Breaking down text into individual words (tokens)")]),n("li",null,[n("strong",null,"Stemming"),s(': Reducing words to their base form (e.g., "running" to "run")')]),n("li",null,[n("strong",null,"Ranking"),s(": Scoring results based on relevance")])],-1),q=n("p",null,`Another common operation is stop word removal. Common words that don't add much meaning (like "the", "and", "is") are often removed to save space and improve relevance.`,-1),O={href:"https://en.wikipedia.org/wiki/Inverted_index",target:"_blank",rel:"noopener noreferrer"},B={href:"https://en.wikipedia.org/wiki/Tf-idf",target:"_blank",rel:"noopener noreferrer"},W=c(`<p>That&#39;s the rundown on full-text search. Let&#39;s see how to implement it.</p><hr><h2 id="implementing-full-text-search" tabindex="-1"><a class="header-anchor" href="#implementing-full-text-search"><span>Implementing Full-Text Search</span></a></h2><p>I chose Lunr.js because it&#39;s lightweight and works great for static websites. No server required.</p><p>I updated the <code>generateSearchData</code> function to create and store a full-text search index. This function runs once at build time, so it&#39;s not expensive.</p><div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx" data-title="jsx"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">generateSearchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Generate search data as before.</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token function">lunr</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;slug&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">boost</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&#39;content&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">boost</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    searchData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Store search data as before.</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// And store the search index.</span></span>
<span class="line">  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span></span>
<span class="line">    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;search&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;search-index.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I&#39;m <strong>boosting</strong> the title with a factor of 10 and the content with a factor of 5. If the search term matches the title, it will have a higher relevance score.</p><p>The downside (for now) is that the index file is big, 2.5MB. If I were to download this on the client every time, the costs would quickly add up. I have 100,000 unique visitors per month, which would equate to <code>250GB</code> of network egress.</p><p>Now, I have to update the search function to use the full-text index:</p><div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx" data-title="jsx"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function">search</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/search/search-data.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> searchData <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/search/search-index.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> searchIndex <span class="token operator">=</span> lunr<span class="token punctuation">.</span>Index<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>indexJson<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> searchIndex</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> post <span class="token operator">=</span> searchData<span class="token operator">?.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> post<span class="token punctuation">.</span>slug <span class="token operator">===</span> result<span class="token punctuation">.</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> post <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>post<span class="token punctuation">,</span> <span class="token literal-property property">score</span><span class="token operator">:</span> result<span class="token punctuation">.</span>score <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> result <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>score <span class="token operator">-</span> a<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>What&#39;s happening here:</p><ul><li>We&#39;re loading the search index from a JSON document using <code>lunr.Index.load</code></li><li>The index has a <code>search</code> function allowing us to perform full-text search</li><li>We&#39;re expanding the result to also include the relevance score</li></ul><p>This allows me to sort the search results based on relevance instead of chronologically.</p><p>Here&#39;s what the old search implementation returns when searching for &quot;resilience&quot;:</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_108/old_search.png?imwidth=1920" alt="The web page showing search results for the keyword &#39;resilience&#39; with the most relevant result highlighted." tabindex="0" loading="lazy"><figcaption>The web page showing search results for the keyword &#39;resilience&#39; with the most relevant result highlighted.</figcaption></figure><p>The most relevant article is at the fourth spot, sorted chronologically. You can see how this isn&#39;t a good user experience.</p><p>But with full-text search, when you search for a keyword like &quot;resilience&quot;, you get nicer results:</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_108/full_text_search.png?imwidth=1920" alt="The web page showing full-text search results for the keyword &#39;resilience&#39; with the most relevant result highlighted." tabindex="0" loading="lazy"><figcaption>The web page showing full-text search results for the keyword &#39;resilience&#39; with the most relevant result highlighted.</figcaption></figure><p>I also added a relevance score next to each article because it looks cool.</p><hr><h2 id="optimizing-the-search" tabindex="-1"><a class="header-anchor" href="#optimizing-the-search"><span>Optimizing The Search</span></a></h2><p>Now, I have a powerful search, but the index was huge (a whopping 2.5MB) and will continue to grow. The search data file is also 861KB.</p>`,22),N={href:"https://en.wikipedia.org/wiki/Brotli",target:"_blank",rel:"noopener noreferrer"},A=c(`<ul><li>I compressed the search index and data using Brotli on the server side</li><li>In the browser, I decompress the files before using them to perform the search</li></ul><div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx" data-title="jsx"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> compress <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;brotli&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">generateSearchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// Create the search data and index</span></span>
<span class="line"></span>
<span class="line">  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span></span>
<span class="line">    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;search&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;search-index.br&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">compress</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span></span>
<span class="line">    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;search&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;search-data.br&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">compress</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>searchData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The results:</p><ul><li>2.5MB â†’ 193KB <strong>(-92%)</strong></li><li>861KB â†’ 180KB <strong>(-79%)</strong></li></ul>`,4),M=n("strong",null,"article about response compression",-1),D=n("p",null,"After fetching the compressed search data and full-text index on the client, I cache them for subsequent searches.",-1),E=n("p",null,"The searches are lightning-fast now, and the results are more relevant.",-1),H=n("hr",null,null,-1),J=n("h2",{id:"server-side-options-for-full-text-search",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#server-side-options-for-full-text-search"},[n("span",null,"Server-Side Options for Full-Text Search")])],-1),L=n("p",null,"While Lunr.js works great for my static site, larger apps with more data need a robust full-text search solution. So, here are some some server-side options you could explore.",-1),z={href:"https://lucene.apache.org/",target:"_blank",rel:"noopener noreferrer"},P={href:"https://solr.apache.org/",target:"_blank",rel:"noopener noreferrer"},C={href:"https://postgresql.org/",target:"_blank",rel:"noopener noreferrer"},R={href:"https://postgresql.org/docs/current/textsearch.html",target:"_blank",rel:"noopener noreferrer"},V={href:"https://npgsql.org/efcore/mapping/full-text-search.html",target:"_blank",rel:"noopener noreferrer"},U=c(`<div class="language-jsx line-numbers-mode" data-highlighter="prismjs" data-ext="jsx" data-title="jsx"><pre><code><span class="line"><span class="token keyword">var</span> blogs <span class="token operator">=</span> context</span>
<span class="line">    <span class="token punctuation">.</span>BlogPosts</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span></span>
<span class="line">        <span class="token constant">EF</span><span class="token punctuation">.</span>Functions<span class="token punctuation">.</span><span class="token function">ToTsVector</span><span class="token punctuation">(</span><span class="token string">&quot;english&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>Excerpt <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>Content<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">Matches</span><span class="token punctuation">(</span><span class="token constant">EF</span><span class="token punctuation">.</span>Functions<span class="token punctuation">.</span><span class="token function">PhraseToTsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;english&quot;</span><span class="token punctuation">,</span> searchTerm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        b<span class="token punctuation">.</span>Slug<span class="token punctuation">,</span></span>
<span class="line">        b<span class="token punctuation">.</span>Title<span class="token punctuation">,</span></span>
<span class="line">        b<span class="token punctuation">.</span>Excerpt<span class="token punctuation">,</span></span>
<span class="line">        b<span class="token punctuation">.</span>Date<span class="token punctuation">,</span></span>
<span class="line">        Rank <span class="token operator">=</span> <span class="token constant">EF</span><span class="token punctuation">.</span>Functions<span class="token punctuation">.</span><span class="token function">ToTsVector</span><span class="token punctuation">(</span><span class="token string">&quot;english&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>Excerpt <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>Content<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">Rank</span><span class="token punctuation">(</span><span class="token constant">EF</span><span class="token punctuation">.</span>Functions<span class="token punctuation">.</span><span class="token function">PhraseToTsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;english&quot;</span><span class="token punctuation">,</span> searchTerm<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>Rank<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>But I&#39;ll have to write a dedicated article to cover this, so let&#39;s wrap it up.</p><hr><h2 id="wrapping-up" tabindex="-1"><a class="header-anchor" href="#wrapping-up"><span>Wrapping Up</span></a></h2><p>The old search functionality was, frankly, embarrassing.</p><p>It was slow, dumb as a rock, and about as useful as a chocolate teapot.</p><p>Now? It&#39;s actually not half bad.</p><ul><li>Searches are lightning-fast</li><li>Results are more relevant</li><li>The user experience is much smoother</li></ul><p>I&#39;m not gonna lie, there was a moment of frustration when I thought about giving up. But I&#39;m glad I stuck with it. There&#39;s something satisfying about building it yourself, you know?</p><p>It might not be pretty, but it works. And sometimes, that&#39;s all that matters.</p><p>The Brotli compression bit was a pleasant surprise. I thought I&#39;d end up with a massive index file that would make mobile users cry. But nope, it all works smoothly. Go figure.</p><p>Have you tried implementing search on your site? How&#39;d it go?</p><p>That&#39;s all for today.</p><p>See you next week.</p>`,14);function K(l,Q){const i=o("VPCard"),p=o("router-link"),r=o("SiteInfo"),t=o("FontIcon"),u=o("RouteLink");return v(),k("div",null,[n("h1",b,[n("a",w,[n("span",null,h(l.$frontmatter.title)+" ê´€ë ¨",1)])]),a(i,m(g({title:"Node.js > Article(s)",desc:"Article(s)",link:"/programming/js-node/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",y,[n("ul",null,[n("li",null,[a(p,{to:"#the-old-search-approach"},{default:e(()=>[s("The Old Search Approach")]),_:1})]),n("li",null,[a(p,{to:"#introducing-full-text-search"},{default:e(()=>[s("Introducing Full-Text Search")]),_:1})]),n("li",null,[a(p,{to:"#implementing-full-text-search"},{default:e(()=>[s("Implementing Full-Text Search")]),_:1})]),n("li",null,[a(p,{to:"#optimizing-the-search"},{default:e(()=>[s("Optimizing The Search")]),_:1})]),n("li",null,[a(p,{to:"#server-side-options-for-full-text-search"},{default:e(()=>[s("Server-Side Options for Full-Text Search")]),_:1})]),n("li",null,[a(p,{to:"#wrapping-up"},{default:e(()=>[s("Wrapping Up")]),_:1})])])]),x,a(r,{name:"How I Implemented Full-Text Search On My Website",desc:"This article walks you through how I used Lunr.js to add powerful search capabilities to a Next.js static site, dealing with challenges like client-side processing and optimizing for performance along the way.",url:"https://milanjovanovic.tech/blog/how-i-implemented-full-text-search-on-my-website",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_108.png"}),_,n("p",null,[s("To fix these problems, I turned to "),I,s(" using "),n("a",S,[a(t,{icon:"fas fa-globe"}),s("Lunr.js")]),s(". But what exactly is full-text search?")]),T,j,F,q,n("p",null,[s("At the heart of full-text search is an "),n("a",O,[a(t,{icon:"fa-brands fa-wikipedia-w"}),s("inverted index")]),s(`. It's a data structure that maps each unique term to the documents containing it. It's "inverted" because it goes from terms to documents, rather than documents to terms.`)]),n("p",null,[s("When searching, results are often ranked using "),n("a",B,[a(t,{icon:"fa-brands fa-wikipedia-w"}),s("TF-IDF")]),s(" (Term Frequency-Inverse Document Frequency). This gives higher scores to terms that are frequent in a document but rare across all documents.")]),W,n("p",null,[s("Enter "),n("a",N,[a(t,{icon:"fa-brands fa-wikipedia-w"}),s("Brotli")]),s(" compression:")]),A,n("p",null,[s("If you want to learn more about compression algorithms, check out this "),a(u,{to:"/milanjovanovic.tech/response-compression-in-aspnetcore.html"},{default:e(()=>[M]),_:1}),s(".")]),D,E,H,J,L,n("p",null,[n("a",z,[a(t,{icon:"fas fa-globe"}),s("Lucene")]),s(" is the foundation of many search engines. It's written in Java but has ports to other languages. Lucene provides robust full-text indexing and search capabilities. It is also highly efficient and customizable, making it a popular choice for developers who need fine-grained control over their search functionality.")]),n("p",null,[n("a",P,[a(t,{icon:"fas fa-globe"}),s("Apache Solr")]),s(" builds on top of Lucene, offering additional features like distributed indexing, replication, and load-balanced querying. Solr includes powerful capabilities such as faceting and highlighting, which can greatly enhance the search experience.")]),n("p",null,[s("If you're already using "),n("a",C,[a(t,{icon:"iconfont icon-postgresql"}),s("PostgreSQL")]),s(", the built-in "),n("a",R,[a(t,{icon:"iconfont icon-postgresql"}),s("full-text search")]),s(" is worth considering. PostgreSQL uses its own text search engine, which supports multiple languages and custom dictionaries. While not as feature-rich as dedicated search engines, it can be a convenient option for applications that want to keep their stack simple.")]),n("p",null,[s("I've been tinkering with PostgreSQL "),n("a",V,[a(t,{icon:"fas fa-globe"}),s("full-text search using EF Core")]),s(". Here's what a full-text search query looks like:")]),U])}const Z=d(f,[["render",K],["__file","how-i-implemented-full-text-search-on-my-website.html.vue"]]),Y=JSON.parse('{"path":"/milanjovanovic.tech/how-i-implemented-full-text-search-on-my-website.html","title":"How I Implemented Full-Text Search On My Website","lang":"en-US","frontmatter":{"lang":"en-US","title":"How I Implemented Full-Text Search On My Website","description":"Article(s) > How I Implemented Full-Text Search On My Website","icon":"iconfont icon-nextjs","category":["Article(s)","Node.js"],"tag":["blog","freecodecamp.org","node","nodejs","node-js"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > How I Implemented Full-Text Search On My Website"},{"property":"og:description","content":"How I Implemented Full-Text Search On My Website"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-i-implemented-full-text-search-on-my-website.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/how-i-implemented-full-text-search-on-my-website.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"How I Implemented Full-Text Search On My Website"}],["meta",{"property":"og:description","content":"Article(s) > How I Implemented Full-Text Search On My Website"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_108.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_108.png"}],["meta",{"name":"twitter:image:alt","content":"How I Implemented Full-Text Search On My Website"}],["meta",{"property":"article:author","content":"Milan JovanoviÄ‡"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"freecodecamp.org"}],["meta",{"property":"article:tag","content":"node"}],["meta",{"property":"article:tag","content":"nodejs"}],["meta",{"property":"article:tag","content":"node-js"}],["meta",{"property":"article:published_time","content":"2024-09-21T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How I Implemented Full-Text Search On My Website\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_108/old_search.png?imwidth=1920\\",\\"https://milanjovanovic.tech/blogs/mnw_108/full_text_search.png?imwidth=1920\\"],\\"datePublished\\":\\"2024-09-21T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan JovanoviÄ‡\\"}]}"]],"prev":"/programming/js-node/articles/README.md","date":"2024-09-21T00:00:00.000Z","isOriginal":false,"author":"Milan JovanoviÄ‡","cover":"https://milanjovanovic.tech/blog-covers/mnw_108.png"},"headers":[{"level":2,"title":"The Old Search Approach","slug":"the-old-search-approach","link":"#the-old-search-approach","children":[]},{"level":2,"title":"Introducing Full-Text Search","slug":"introducing-full-text-search","link":"#introducing-full-text-search","children":[]},{"level":2,"title":"Implementing Full-Text Search","slug":"implementing-full-text-search","link":"#implementing-full-text-search","children":[]},{"level":2,"title":"Optimizing The Search","slug":"optimizing-the-search","link":"#optimizing-the-search","children":[]},{"level":2,"title":"Server-Side Options for Full-Text Search","slug":"server-side-options-for-full-text-search","link":"#server-side-options-for-full-text-search","children":[]},{"level":2,"title":"Wrapping Up","slug":"wrapping-up","link":"#wrapping-up","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":6.03,"words":1808},"filePathRelative":"milanjovanovic.tech/how-i-implemented-full-text-search-on-my-website.md","localizedDate":"September 21, 2024","excerpt":"\\n","copyright":{"author":"Milan JovanoviÄ‡"}}');export{Z as comp,Y as data};
