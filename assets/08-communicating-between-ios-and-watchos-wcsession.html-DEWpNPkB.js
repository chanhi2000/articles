import{_ as r}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as u,b as n,t as d,e as a,n as o,g as i,d as s,f as p,r as c,o as m}from"./app-BgNevrm5.js";const h={},k={id:"frontmatter-title-á„€á…ªá†«á„…á…§á†«",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-á„€á…ªá†«á„…á…§á†«"},v=n("nav",{class:"table-of-contents"},[n("ul")],-1),g=n("hr",null,null,-1),b=n("p",null,"It's time for something new, and something I've held back from covering in Hacking with Swift because only a small proportion of people have an Apple Watch. So, I'm covering it here only briefly, and only at the very end of the project so that if you don't have an Apple Watch you can just skip on past.",-1),f=n("p",null,"Still here? OK: we're going to upgrade our project so that when your finger moves over the correct card your Apple Watch will gently tap your wrist. The haptic vibration of Apple Watches is so marvelously subtle that no one will have any idea what's happening â€“ the effect is very impressive!",-1),y=n("p",null,"I have good news and bad news. First the good news: for our purposes, communicating between Apple Watch and iOS could not be any easier â€“ it take us maybe five minutes in total to complete the code. Now the bad news: even when the settings are adjusted, your Watch will go to sleep after 70 seconds of inactivity, so it's down you to make sure the app stays awake.",-1),S=n("code",null,"ViewController.swift",-1),C=p(`<div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token class-name">WatchConnectivity</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>As you might imagine, the WatchConnectivity framework is responsible for connectivity between iOS apps and watchOS apps, and we&#39;ll be using it to send messages between our phone and a Watch. The messages are dictionaries of any data you want, so you can send strings, numbers, arrays and more â€“ it&#39;s up to you.</p>`,2),_=n("code",null,"viewDidLoad()",-1),W=n("code",null,"ViewController.swift",-1),O=p(`<div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WCSession</span><span class="token punctuation">.</span><span class="token function">isSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> session <span class="token operator">=</span> <span class="token class-name">WCSession</span><span class="token punctuation">.</span><span class="token keyword">default</span></span>
<span class="line">    session<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span></span>
<span class="line">    session<span class="token punctuation">.</span><span class="token function">activate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You&#39;ll get an error because the <code>ViewController</code> class doesn&#39;t conform to the <code>WCSessionDelegate</code> protocol, but that&#39;s easily fixed:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token class-name">UIViewController</span><span class="token punctuation">,</span> <span class="token class-name">WCSessionDelegate</span> <span class="token punctuation">{</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You need to add a few methods to <code>ViewController</code> in order to satisfy this new protocol, but all of them can be empty because we donâ€™t actually care about them. Add these three at the end of the class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">session</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> session<span class="token punctuation">:</span> <span class="token class-name">WCSession</span><span class="token punctuation">,</span> activationDidCompleteWith activationState<span class="token punctuation">:</span> <span class="token class-name">WCSessionActivationState</span><span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token class-name">Error</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function-definition function">sessionDidBecomeInactive</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> session<span class="token punctuation">:</span> <span class="token class-name">WCSession</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function-definition function">sessionDidDeactivate</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> session<span class="token punctuation">:</span> <span class="token class-name">WCSession</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(Note: if you were wondering, you canâ€™t call <code>activate()</code> on a session without a delegate. We donâ€™t actually use any of the delegate methods, but we still need to assign a delegate!)</p><p>Sending a message from a phone to a watch is trivial, like I said, but there is one small piece of complexity: if we want the watch to buzz every time it receives a message (spoiler: that&#39;s exactly what we want), we need a way to rate limit those messages. That is, we don&#39;t want to send 100 messages a second when the user is touching the right card, because it would make your watch go nuts.</p><p>To solve this problem, we&#39;re going to add a new property that tracks when the last watch message was sent. This way, we can avoid sending a message to the watch if there was one sent very recently â€“ i.e., less than about half a second ago.</p><p>Add this property to the class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">var</span> lastMessage<span class="token punctuation">:</span> <span class="token class-name">CFAbsoluteTime</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If you were wondering, <code>CFAbsoluteTime</code> is actually just a <code>Double</code> behind the scenes. We can get the current time using a function called <code>CFAbsoluteTimeGetCurrent()</code>, which returns the number of seconds that have passed since midnight on January 1st 2001. Yes, that&#39;s a rather random date, but it doesn&#39;t matter: all we care about is the time since our previous call.</p><p>Sending a message from the app to the watch is done in two parts. First, we need to check whether the watch is reachable, which in practice means &quot;is our Apple Watch app running and in the foreground?&quot; Second, we need to use the <code>sendMessage()</code> method of <code>WCSession</code> to send a dictionary of data. It doesn&#39;t matter what data we send, because in our app <em>any</em> data will be interpreted as &quot;please buzz.&quot;</p><p>Keeping in mind the need to rate limit these calls, here&#39;s a new method for the <code>ViewController</code> class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">sendWatchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> currentTime <span class="token operator">=</span> <span class="token class-name">CFAbsoluteTimeGetCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// if less than half a second has passed, bail out</span></span>
<span class="line">    <span class="token keyword">if</span> lastMessage <span class="token operator">+</span> <span class="token number">0.5</span> <span class="token operator">&gt;</span> currentTime <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// send a message to the watch if it&#39;s reachable</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WCSession</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>isReachable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// this is a meaningless message, but it&#39;s enough for our purposes</span></span>
<span class="line">        <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;Message&quot;</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Hello&quot;</span></span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token class-name">WCSession</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> replyHandler<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// update our rate limiting property</span></span>
<span class="line">    lastMessage <span class="token operator">=</span> <span class="token class-name">CFAbsoluteTimeGetCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With that new method in place we can call it inside <code>touchesMoved()</code> by adding this code at the end of the <code>contains()</code> condition:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">if</span> card<span class="token punctuation">.</span>isCorrect <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">sendWatchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Just in case you&#39;re not sure where I mean, here&#39;s how the complete <code>touchesMoved()</code> method should look:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">touchesMoved</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> touches<span class="token punctuation">:</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">UITouch</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> with event<span class="token punctuation">:</span> <span class="token class-name">UIEvent</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">touchesMoved</span><span class="token punctuation">(</span>touches<span class="token punctuation">,</span> with<span class="token punctuation">:</span> event<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> touch <span class="token operator">=</span> touches<span class="token punctuation">.</span>first <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> location <span class="token operator">=</span> touch<span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> cardContainer<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">for</span> card <span class="token keyword">in</span> allCards <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> card<span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> view<span class="token punctuation">.</span>traitCollection<span class="token punctuation">.</span>forceTouchCapability <span class="token operator">==</span> <span class="token punctuation">.</span>available <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> touch<span class="token punctuation">.</span>force <span class="token operator">==</span> touch<span class="token punctuation">.</span>maximumPossibleForce <span class="token punctuation">{</span></span>
<span class="line">                    card<span class="token punctuation">.</span>front<span class="token punctuation">.</span>image <span class="token operator">=</span> <span class="token class-name">UIImage</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;cardStar&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">                    card<span class="token punctuation">.</span>isCorrect <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// here&#39;s the new code!</span></span>
<span class="line">            <span class="token keyword">if</span> card<span class="token punctuation">.</span>isCorrect <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">sendWatchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And that&#39;s it. Yes, that&#39;s all the code it takes to send data from our iOS app to an Apple Watch. Of course, the app won&#39;t do anything yet because sending data isn&#39;t enough: we need to write code to <em>receive</em> it and do something interesting.</p>`,19);function A(l,x){const e=c("VPCard"),t=c("FontIcon");return m(),u("div",null,[n("h1",k,[n("a",w,[n("span",null,d(l.$frontmatter.title)+" ê´€ë ¨",1)])]),a(e,o(i({title:"Hacking with iOS â€“ learn to code iPhone and iPad apps with free Swift tutorials",desc:"Learn Swift coding for iOS with these free tutorials â€“ learn Swift, iOS, and Xcode",link:"/hackingwithswift.com/read/README.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(174,10,10,0.2)"})),null,16),v,g,a(e,o(i({title:"Communicating between iOS and watchOS: WCSession | Hacking with iOS",desc:"Communicating between iOS and watchOS: WCSession",link:"https://hackingwithswift.com/read/37/8/communicating-between-ios-and-watchos-wcsession",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(174,10,10,0.2)"})),null,16),b,f,y,n("p",null,[s("That bad news will make more sense once you're using the finished product, so without further ado let's crack on with development. In "),a(t,{icon:"fa-brands fa-swift"}),S,s(" add this new import:")]),C,n("p",null,[s("In order to work with a session, we need to check whether it's supported on our current phone, then activate it. Put this code into the "),_,s(" method of "),a(t,{icon:"fa-brands fa-swift"}),W,s(":")]),O])}const M=r(h,[["render",A],["__file","08-communicating-between-ios-and-watchos-wcsession.html.vue"]]),j=JSON.parse('{"path":"/hackingwithswift.com/read/37/08-communicating-between-ios-and-watchos-wcsession.html","title":"Communicating between iOS and watchOS: WCSession","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Communicating between iOS and watchOS: WCSession","description":"Article(s) > Communicating between iOS and watchOS: WCSession","category":["Swift","iOS","Article(s)"],"tag":["blog","hackingwithswift.com","crashcourse","swift","xcode","appstore","ios"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > Communicating between iOS and watchOS: WCSession"},{"property":"og:description","content":"Communicating between iOS and watchOS: WCSession"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/read/37/08-communicating-between-ios-and-watchos-wcsession.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/read/37/08-communicating-between-ios-and-watchos-wcsession.html"}],["meta",{"property":"og:site_name","content":"ðŸ“šBookshelf"}],["meta",{"property":"og:title","content":"Communicating between iOS and watchOS: WCSession"}],["meta",{"property":"og:description","content":"Article(s) > Communicating between iOS and watchOS: WCSession"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"hackingwithswift.com"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:tag","content":"ios"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Communicating between iOS and watchOS: WCSession\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]],"isOriginal":false},"headers":[],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":3.68,"words":1105},"filePathRelative":"hackingwithswift.com/read/37/08-communicating-between-ios-and-watchos-wcsession.md","excerpt":"\\n"}');export{M as comp,j as data};
