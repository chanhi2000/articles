import{_ as u}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as m,b as e,t as h,e as n,n as g,g as b,w as a,d as t,f as r,r as s,o as v}from"./app-BgNevrm5.js";const y={},f={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},_={class:"table-of-contents"},k=e("hr",null,null,-1),T=e("p",null,"If you're building or maintaining distributed .NET applications, understanding how they behave is key to ensuring reliability and performance.",-1),x=e("p",null,"Distributed systems offer flexibility but introduce complexity, making troubleshooting a headache. Understanding how requests flow through your system is crucial for debugging and performance optimization.",-1),I=e("p",null,"OpenTelemetry is an open-source observability framework that makes this possible.",-1),O=e("p",null,"In this article, we'll dive into what OpenTelemetry is, how to use it in your .NET projects, and the powerful insights it provides.",-1),E=e("hr",null,null,-1),A=e("h2",{id:"opentelemetry-introduction",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#opentelemetry-introduction"},[e("span",null,"OpenTelemetry Introduction")])],-1),N={href:"https://opentelemetry.io/",target:"_blank",rel:"noopener noreferrer"},j=e("p",null,"Telemetry data includes:",-1),D=e("ul",null,[e("li",null,[e("strong",null,"Traces"),t(": Represent the flow of requests through distributed systems, showing timings and relationships between services.")]),e("li",null,[e("strong",null,"Metrics"),t(": Numerical measurements of system behavior over time (e.g., request counts, error rates, memory usage).")]),e("li",null,[e("strong",null,"Logs"),t(": Textual records of events with rich contextual information. Structured logs.")])],-1),P=e("img",{src:"https://milanjovanovic.tech/blogs/mnw_086/otel.png?imwidth=3840",alt:'OpenTelemetry Reference Architecture.<br/>Source: <FontIcon icon="fas fa-globe"/>https://opentelemetry.io/docs/',tabindex:"0",loading:"lazy"},null,-1),R=e("br",null,null,-1),S={href:"https://opentelemetry.io/docs/",target:"_blank",rel:"noopener noreferrer"},W=e("p",null,"OpenTelemetry provides a unified way to collect this data, making it easier to understand the behavior and health of complex distributed applications.",-1),C=e("p",null,"We can export the telemetry data we are collecting to a service capable of processing it and providing us with an interface to analyze it.",-1),q={href:"https://jaegertracing.io/",target:"_blank",rel:"noopener noreferrer"},J=r(`<hr><h2 id="adding-opentelemetry-to-net-applications" tabindex="-1"><a class="header-anchor" href="#adding-opentelemetry-to-net-applications"><span>Adding OpenTelemetry to .NET Applications</span></a></h2><p>OpenTelemetry provides libraries and SDKs to add code (instrumentation) into your .NET applications. These instrumentations automatically capture the traces, metrics, and logs we are interested in.</p><p>We&#39;re going to install the following NuGet packages:</p><div class="language-pwsh line-numbers-mode" data-highlighter="prismjs" data-ext="pwsh" data-title="pwsh"><pre><code><span class="line"># Automatic tracing, metrics</span>
<span class="line">Install-Package OpenTelemetry.Extensions.Hosting</span>
<span class="line"></span>
<span class="line"># Telemetry data exporter</span>
<span class="line">Install-Package OpenTelemetry.Exporter.OpenTelemetryProtocol</span>
<span class="line"></span>
<span class="line"># Instrumentation packages</span>
<span class="line">Install-Package OpenTelemetry.Instrumentation.Http</span>
<span class="line">Install-Package OpenTelemetry.Instrumentation.AspNetCore</span>
<span class="line">Install-Package OpenTelemetry.Instrumentation.EntityFrameworkCore</span>
<span class="line">Install-Package OpenTelemetry.Instrumentation.StackExchangeRedis</span>
<span class="line">Install-Package Npgsql.OpenTelemetry</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Once we have these NuGet packages installed, it&#39;s time to configure some services.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line">services</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">AddOpenTelemetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ConfigureResource</span><span class="token punctuation">(</span>resource <span class="token operator">=&gt;</span> resource<span class="token punctuation">.</span><span class="token function">AddService</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">WithTracing</span><span class="token punctuation">(</span>tracing <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        tracing</span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">AddAspNetCoreInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">AddHttpClientInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">AddEntityFrameworkCoreInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">AddRedisInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">AddNpgsql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        tracing<span class="token punctuation">.</span><span class="token function">AddOtlpExporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>AddAspNetCoreInstrumentation</code> - This enables ASP.NET Core instrumentation.</li><li><code>AddHttpClientInstrumentation</code> - This enables <code>HttpClient</code> instrumentation for outgoing requests.</li><li><code>AddEntityFrameworkCoreInstrumentation</code> - This enables EF Core instrumentation.</li><li><code>AddRedisInstrumentation</code> - This enables Redis instrumentation.</li><li><code>AddNpgsql</code> - This enables PostgreSQL instrumentation.</li></ul><p>With all of these instrumentations configured, our application will start collecting a lot of valuable traces at runtime.</p><p>We also need to configure an environment variable for the exporter added with <code>AddOtlpExporter</code> to work correctly. We can set <code>OTEL_EXPORTER_OTLP_ENDPOINT</code> through application settings. The address specified here will point to a local Jaeger instance.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="running-jaeger-locally" tabindex="-1"><a class="header-anchor" href="#running-jaeger-locally"><span>Running Jaeger Locally</span></a></h2>`,13),L={href:"https://jaegertracing.io/",target:"_blank",rel:"noopener noreferrer"},M=r(`<p>Here&#39;s how to run Jaeger inside a Docker container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">4317</span>:4317 <span class="token parameter variable">-p</span> <span class="token number">16686</span>:16686 jaegertracing/all-in-one:latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>We&#39;re using the <code>jaegertracing/all-in-one:latest</code> image, and exposing the <code>4317</code> to accept telemetry data. The Jaeger user interface will be exposed on the <code>16686</code> port.</p><hr><h2 id="distributed-tracing" tabindex="-1"><a class="header-anchor" href="#distributed-tracing"><span>Distributed Tracing</span></a></h2><p>After installing the OpenTelemetry libraries and configuring tracing in our applications, we can send some requests to generate telemetry data. We can then access Jaeger to start analyzing our distributed traces.</p><h3 id="registering-a-new-user" tabindex="-1"><a class="header-anchor" href="#registering-a-new-user"><span>Registering a new user</span></a></h3><p>Here&#39;s an example of registering a new user with the system. We&#39;re accessing the API gateway (<code>Evently.Gateway</code>) service, which proxies the request to the <code>Evently.Api</code> service. And you can see that the <code>Evently.Api</code> service makes a few HTTP requests before persisting a new record in the database.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_086/trace_1.png?imwidth=3840" alt="Distributed trace." tabindex="0" loading="lazy"><figcaption>Distributed trace.</figcaption></figure><h3 id="publishing-a-message-with-masstransit" tabindex="-1"><a class="header-anchor" href="#publishing-a-message-with-masstransit"><span>Publishing a message with MassTransit</span></a></h3><p>Here&#39;s another distributed trace where we publish the <code>UserRegisteredIntegrationEvent</code> over a message bus. You can see that it&#39;s being consumed by two different services that write some data to the database.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_086/trace_2.png?imwidth=3840" alt="Distributed trace." tabindex="0" loading="lazy"><figcaption>Distributed trace.</figcaption></figure><h3 id="examining-additional-trace-information" tabindex="-1"><a class="header-anchor" href="#examining-additional-trace-information"><span>Examining additional trace information</span></a></h3><p>Distributed traces can include some useful contextual information. Here&#39;s an example trace representing a database command. This comes from the PostgreSQL instrumentation, and we can see the SQL query that we are executing.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_086/trace_3.png?imwidth=3840" alt="Distributed trace." tabindex="0" loading="lazy"><figcaption>Distributed trace.</figcaption></figure><h3 id="complex-distributed-traces" tabindex="-1"><a class="header-anchor" href="#complex-distributed-traces"><span>Complex distributed traces</span></a></h3><p>Here&#39;s a more complex distributed trace, which includes:</p><ul><li>Three .NET applications</li><li>PostgreSQL database</li><li>Redis distributed cache</li></ul><p>We&#39;re sending a request to get the customer&#39;s cart. The request will first hit the API gateway, which proxies it to the <code>Evently.Ticketing.Api</code> service that owns the data. However, the <code>Evently.Ticketing.Api</code> service needs to reach out to the <code>Evently.Api</code> service to get the authorization information. And all of this leads to the distributed trace you can see below.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_086/trace_4.png?imwidth=3840" alt="Distributed trace." tabindex="0" loading="lazy"><figcaption>Distributed trace.</figcaption></figure><hr><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>Understanding modern applications, especially distributed ones, can be a real mind-bender. OpenTelemetry is like having X-ray vision into your system.</p><p>While adding OpenTelemetry takes some upfront work, consider it an investment. That investment pays off big time when problems pop up. Instead of frantic guesswork, you have precise data to zero in on issues fast.</p><p>Is OpenTelemetry a magic bullet for all your problems? Nope.</p><p>But it&#39;s an excellent tool to add to your troubleshooting arsenal, especially as your .NET applications grow and get more complex.</p>`,26),z=e("strong",null,"Modular Monolith course",-1),H=e("p",null,"That's all for today. Stay awesome, and I'll see you next week.",-1);function F(l,V){const c=s("VPCard"),i=s("router-link"),p=s("SiteInfo"),o=s("FontIcon"),d=s("RouteLink");return v(),m("div",null,[e("h1",f,[e("a",w,[e("span",null,h(l.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),n(c,g(b({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),e("nav",_,[e("ul",null,[e("li",null,[n(i,{to:"#opentelemetry-introduction"},{default:a(()=>[t("OpenTelemetry Introduction")]),_:1})]),e("li",null,[n(i,{to:"#adding-opentelemetry-to-net-applications"},{default:a(()=>[t("Adding OpenTelemetry to .NET Applications")]),_:1})]),e("li",null,[n(i,{to:"#running-jaeger-locally"},{default:a(()=>[t("Running Jaeger Locally")]),_:1})]),e("li",null,[n(i,{to:"#distributed-tracing"},{default:a(()=>[t("Distributed Tracing")]),_:1}),e("ul",null,[e("li",null,[n(i,{to:"#registering-a-new-user"},{default:a(()=>[t("Registering a new user")]),_:1})]),e("li",null,[n(i,{to:"#publishing-a-message-with-masstransit"},{default:a(()=>[t("Publishing a message with MassTransit")]),_:1})]),e("li",null,[n(i,{to:"#examining-additional-trace-information"},{default:a(()=>[t("Examining additional trace information")]),_:1})]),e("li",null,[n(i,{to:"#complex-distributed-traces"},{default:a(()=>[t("Complex distributed traces")]),_:1})])])]),e("li",null,[n(i,{to:"#summary"},{default:a(()=>[t("Summary")]),_:1})])])]),k,n(p,{name:"Introduction to Distributed Tracing With OpenTelemetry in .NET",desc:"Sometimes, especially in high-traffic scenarios, you absolutely need to ensure that only one process can modify a piece of data at a time. Entity Framework Core is a fantastic tool, but it doesn't have a direct mechanism for pessimistic locking. In this article, I'll show you how we can solve that problem with raw SQL queries.",url:"https://milanjovanovic.tech/blog/introduction-to-distributed-tracing-with-opentelemetry-in-dotnet/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_086.png"}),T,x,I,O,E,A,e("p",null,[e("a",N,[n(o,{icon:"fas fa-globe"}),t("OpenTelemetry")]),t(" (OTel) is a vendor-neutral, open-source standard for instrumenting applications to generate telemetry data. OpenTelemetry contains APIs, SDKs, tools, and integrations for creating and managing this telemetry data (traces, metrics, and logs).")]),j,D,e("figure",null,[P,e("figcaption",null,[t("OpenTelemetry Reference Architecture."),R,t("Source: "),e("a",S,[n(o,{icon:"fas fa-globe"}),t("https://opentelemetry.io/docs/")])])]),W,C,e("p",null,[t("We're going to configure OpenTelemetry to export traces directly to "),e("a",q,[n(o,{icon:"fas fa-globe"}),t("Jaeger")]),t(".")]),J,e("p",null,[e("a",L,[n(o,{icon:"fas fa-globe"}),t("Jaeger")]),t(" is an open source, distributed tracing platform. Jaeger maps the flow of requests and data as they travel through a distributed system. These requests could be calling out to multiple services, and Jaeger knows how to piece all of this information together.")]),M,e("p",null,[t("If you're curious where the distributed traces come from, it's from the application we're building in my "),n(d,{to:"/milanjovanovic.tech/modular-monolith-architecture/"},{default:a(()=>[z]),_:1}),t(".")]),H])}const Q=u(y,[["render",F],["__file","introduction-to-distributed-tracing-with-opentelemetry-in-dotnet.html.vue"]]),G=JSON.parse('{"path":"/milanjovanovic.tech/introduction-to-distributed-tracing-with-opentelemetry-in-dotnet.html","title":"Introduction to Distributed Tracing With OpenTelemetry in .NET","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Introduction to Distributed Tracing With OpenTelemetry in .NET","description":"Article(s) > Introduction to Distributed Tracing With OpenTelemetry in .NET","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > Introduction to Distributed Tracing With OpenTelemetry in .NET"},{"property":"og:description","content":"Introduction to Distributed Tracing With OpenTelemetry in .NET"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/introduction-to-distributed-tracing-with-opentelemetry-in-dotnet.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/introduction-to-distributed-tracing-with-opentelemetry-in-dotnet.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"Introduction to Distributed Tracing With OpenTelemetry in .NET"}],["meta",{"property":"og:description","content":"Article(s) > Introduction to Distributed Tracing With OpenTelemetry in .NET"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_086.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_086.png"}],["meta",{"name":"twitter:image:alt","content":"Introduction to Distributed Tracing With OpenTelemetry in .NET"}],["meta",{"property":"article:author","content":"Milan Jovanoviƒá"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:published_time","content":"2024-04-20T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Introduction to Distributed Tracing With OpenTelemetry in .NET\\",\\"image\\":[\\"https://opentelemetry.io/docs/\\",\\"https://milanjovanovic.tech/blogs/mnw_086/trace_1.png?imwidth=3840\\",\\"https://milanjovanovic.tech/blogs/mnw_086/trace_2.png?imwidth=3840\\",\\"https://milanjovanovic.tech/blogs/mnw_086/trace_3.png?imwidth=3840\\",\\"https://milanjovanovic.tech/blogs/mnw_086/trace_4.png?imwidth=3840\\"],\\"datePublished\\":\\"2024-04-20T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanoviƒá\\"}]}"]],"prev":"/programming/cs/articles/README.md","date":"2024-04-20T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanoviƒá","cover":"https://milanjovanovic.tech/blog-covers/mnw_086.png"},"headers":[{"level":2,"title":"OpenTelemetry Introduction","slug":"opentelemetry-introduction","link":"#opentelemetry-introduction","children":[]},{"level":2,"title":"Adding OpenTelemetry to .NET Applications","slug":"adding-opentelemetry-to-net-applications","link":"#adding-opentelemetry-to-net-applications","children":[]},{"level":2,"title":"Running Jaeger Locally","slug":"running-jaeger-locally","link":"#running-jaeger-locally","children":[]},{"level":2,"title":"Distributed Tracing","slug":"distributed-tracing","link":"#distributed-tracing","children":[{"level":3,"title":"Registering a new user","slug":"registering-a-new-user","link":"#registering-a-new-user","children":[]},{"level":3,"title":"Publishing a message with MassTransit","slug":"publishing-a-message-with-masstransit","link":"#publishing-a-message-with-masstransit","children":[]},{"level":3,"title":"Examining additional trace information","slug":"examining-additional-trace-information","link":"#examining-additional-trace-information","children":[]},{"level":3,"title":"Complex distributed traces","slug":"complex-distributed-traces","link":"#complex-distributed-traces","children":[]}]},{"level":2,"title":"Summary","slug":"summary","link":"#summary","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":3.84,"words":1152},"filePathRelative":"milanjovanovic.tech/introduction-to-distributed-tracing-with-opentelemetry-in-dotnet.md","localizedDate":"2024ÎÖÑ 4Ïõî 20Ïùº","excerpt":"\\n","copyright":{"author":"Milan Jovanoviƒá"}}');export{Q as comp,G as data};
