import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c,b as n,t as i,e as a,n as t,g as e,f as l,r,o as u}from"./app-BgNevrm5.js";const d={},k={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},m={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},h=n("nav",{class:"table-of-contents"},[n("ul")],-1),v=n("hr",null,null,-1),b=l(`<blockquote><p>Updated for Xcode 15</p></blockquote><p>All instances of your model objects are automatically bound to the actor where they are created, which means you can&#39;t bounce objects between your main context and a context running on a separate actor. Instead, you should pass your object&#39;s persistent identifier between your actors, then load them locally.</p><div class="hint-container important"><p class="hint-container-title">Important</p><p>Although we&#39;re now more than two years into Swift concurrency, Xcode still ships with its concurrency checking option set to Minimal. At the time of writing this means you <em>can</em> send model objects between actors despite this potentially causing data races, and it will cause a hard error once Xcode starts to enforce its concurrency checks. If you&#39;d like to save yourself some headaches, I&#39;d suggest you go to your target&#39;s build settings and set Strict Concurrency Checking to Complete, then follow the instructions below in order to get concurrency right.</p></div><p>As an example, let&#39;s say you&#39;re building an app that is able to scour various sources for information on a particular topic, and bring them all together in a local SwiftData store so you could perform various analysis work on it ‚Äì perhaps you&#39;re running through some machine learning algorithms, you&#39;re performing semantic analysis, or whatever.</p><p>We would start with a SwiftData model able to hold a topic name, plus a <code>content</code> string containing all the relevant text you found from various sources, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@Model</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Topic</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">var</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line">        <span class="token keyword">self</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Next, you&#39;d build a dedicated actor that&#39;s able to research a particular topic on a background task. We&#39;re not actually going to do the machine learning part because that isn&#39;t the point, but I do want to point out the right and wrong way of receiving data.</p><p>First, the wrong way: <strong>Do not write an actor that accepts a model object directly.</strong> So, this code can introduce all sorts of problems in your code:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">actor</span> <span class="token class-name">TopicResearcher</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">func</span> <span class="token function-definition function">research</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> topic<span class="token punctuation">:</span> <span class="token class-name">Topic</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Researching </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">topic<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">‚Ä¶&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment">// Lots of work here‚Ä¶</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Again: do <em>not</em> send model objects across actors.</strong></p><p>There are only two things that are safe to send between actors: a <code>ModelContainer</code> and a <code>PersistentIdentifier</code>. This means the safe way to pass data between actors is to:</p><ol><li>Pass a model container instance from your main actor to another actor.</li><li>Use that to create a model context on the other actor.</li><li>Pass the persistent identifier of your model object from your main actor to the other actor.</li><li>Use that to load the object on the other actor.</li></ol><p>You can then perform as much extra work as you want on the other actor without interfering with your main actor.</p><p>All the work of fetching and analyzing data should be done off your main actor to avoid locking up the user interface</p><p>So, the correct code to handle an object on a separate actor is like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">actor</span> <span class="token class-name">TopicResearcher</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> context<span class="token punctuation">:</span> <span class="token class-name">ModelContext</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Create a model context on this actor</span></span>
<span class="line">    <span class="token keyword">init</span><span class="token punctuation">(</span>container<span class="token punctuation">:</span> <span class="token class-name">ModelContainer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        context <span class="token operator">=</span> <span class="token class-name">ModelContext</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Convert an identifier to a topic using the local context</span></span>
<span class="line">    <span class="token keyword">func</span> <span class="token function-definition function">research</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> identifier<span class="token punctuation">:</span> <span class="token class-name">PersistentIdentifier</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">guard</span> <span class="token keyword">let</span> topic <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> identifier<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">Topic</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Researching </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">topic<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">‚Ä¶&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Lots of work here‚Ä¶&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Remember, your object&#39;s persistent identifier is only temporary until it is saved for the first time. If you intend to make an actor do extensive work with its model context, it&#39;s much more efficient to create the context inside a method rather than accessing the actor&#39;s property.</p></div><p>With this in place, you can write a regular SwiftUI view that is able to display your topics somehow, and let the user select one to research. As an example to get you started, we might write code like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute atrule">@Query</span><span class="token punctuation">(</span>sort<span class="token punctuation">:</span> <span class="token punctuation">\\</span><span class="token class-name">Topic</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">var</span> topics<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Topic</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\\</span><span class="token punctuation">.</span>modelContext<span class="token punctuation">)</span> <span class="token keyword">var</span> modelContext</span>
<span class="line"></span>
<span class="line">    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> researcher<span class="token punctuation">:</span> <span class="token class-name">TopicResearcher</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">NavigationStack</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">List</span><span class="token punctuation">(</span>topics<span class="token punctuation">)</span> <span class="token punctuation">{</span> topic <span class="token keyword">in</span></span>
<span class="line">                <span class="token class-name">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">Text</span><span class="token punctuation">(</span>topic<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">.</span>swipeActions <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Research&quot;</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;magnifyingglass&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token function">research</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;AutoResearcher&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span>toolbar <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Add Sample&quot;</span></span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> addSample<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">init</span><span class="token punctuation">(</span>container<span class="token punctuation">:</span> <span class="token class-name">ModelContainer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> researcher <span class="token operator">=</span> <span class="token class-name">TopicResearcher</span><span class="token punctuation">(</span>container<span class="token punctuation">:</span> container<span class="token punctuation">)</span></span>
<span class="line">        _researcher <span class="token operator">=</span> <span class="token class-name">State</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">:</span> researcher<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">func</span> <span class="token function-definition function">addSample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> topic1 <span class="token operator">=</span> <span class="token class-name">Topic</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;The Roman Empire&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">let</span> topic2 <span class="token operator">=</span> <span class="token class-name">Topic</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Travis Kelce&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        modelContext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>topic1<span class="token punctuation">)</span></span>
<span class="line">        modelContext<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>topic2<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">func</span> <span class="token function-definition function">research</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> topic<span class="token punctuation">:</span> <span class="token class-name">Topic</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> id <span class="token operator">=</span> topic<span class="token punctuation">.</span>id</span>
<span class="line"></span>
<span class="line">        <span class="token class-name">Task</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>researcher<span class="token punctuation">]</span> <span class="token keyword">in</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token keyword">await</span> researcher<span class="token punctuation">.</span><span class="token function">research</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code compiles and runs cleanly even with complete concurrency checking enabled, avoiding the potential for data races.</p>`,20);function w(o,g){const s=r("VPCard");return u(),c("div",null,[n("h1",k,[n("a",m,[n("span",null,i(o.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),a(s,t(e({title:"SwiftData by Example",desc:"Back to Home",link:"/hackingwithswift.com/swiftdata/README.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(174,10,10,0.2)"})),null,16),h,v,a(s,t(e({title:"How to transfer an object between a background context and the main context | SwiftData by Example",desc:"How to transfer an object between a background context and the main context",link:"https://hackingwithswift.com/quick-start/swiftdata/how-to-transfer-an-object-between-a-background-context-and-the-main-context",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),b])}const x=p(d,[["render",w],["__file","how-to-transfer-an-object-between-a-background-context-and-the-main-context.html.vue"]]),j=JSON.parse('{"path":"/hackingwithswift.com/swiftdata/how-to-transfer-an-object-between-a-background-context-and-the-main-context.html","title":"How to transfer an object between a background context and the main context","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"How to transfer an object between a background context and the main context","description":"Article(s) > How to transfer an object between a background context and the main context","category":["Swift","Article(s)"],"tag":["blog","hackingwithswift.com","crashcourse","swift","swiftdata","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > How to transfer an object between a background context and the main context"},{"property":"og:description","content":"How to transfer an object between a background context and the main context"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/swiftdata/how-to-transfer-an-object-between-a-background-context-and-the-main-context.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/swiftdata/how-to-transfer-an-object-between-a-background-context-and-the-main-context.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"How to transfer an object between a background context and the main context"}],["meta",{"property":"og:description","content":"Article(s) > How to transfer an object between a background context and the main context"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"hackingwithswift.com"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"swiftdata"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:published_time","content":"2023-09-30T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How to transfer an object between a background context and the main context\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-09-30T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"]],"date":"2023-09-30T00:00:00.000Z","isOriginal":false},"headers":[],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":3.17,"words":950},"filePathRelative":"hackingwithswift.com/swiftdata/how-to-transfer-an-object-between-a-background-context-and-the-main-context.md","localizedDate":"2023ÎÖÑ 9Ïõî 30Ïùº","excerpt":"\\n"}');export{x as comp,j as data};
