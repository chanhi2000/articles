import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,b as t,t as p,e as s,n,g as e,f as c,r,o as u}from"./app-BgNevrm5.js";const d={},h={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},m={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},f=t("nav",{class:"table-of-contents"},[t("ul")],-1),k=t("hr",null,null,-1),w=c(`<blockquote><p>Updated for Xcode 15</p></blockquote><p>SwiftData‚Äôs model context has a dedicated <code>enumerate()</code> method that is designed to traverse large amounts of data efficiently. Whether it‚Äôs <em>effective</em> or not is down to you to judge, but I can at least show you how it works.</p><p>I‚Äôll explain the drawbacks more in a moment, but first let‚Äôs look at some examples. If you worked at a large university with thousands of students and wanted to process them somehow ‚Äì for example if you wanted to loop over everyone to calculate the total number of test scores by all students, as well as how many results were regular passes and how many were passes with distinction ‚Äì then you might write code like this:1</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> descriptor <span class="token operator">=</span> <span class="token class-name">FetchDescriptor</span><span class="token operator">&lt;</span><span class="token class-name">Student</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> totalResults <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"><span class="token keyword">var</span> totalDistinctions <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"><span class="token keyword">var</span> totalPasses <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> modelContext<span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span> student <span class="token keyword">in</span></span>
<span class="line">        totalResults <span class="token operator">+=</span> student<span class="token punctuation">.</span>scores<span class="token punctuation">.</span>count</span>
<span class="line">        totalDistinctions <span class="token operator">+=</span> student<span class="token punctuation">.</span>scores<span class="token punctuation">.</span>filter <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">&gt;=</span> <span class="token number">85</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>count</span>
<span class="line">        totalPasses <span class="token operator">+=</span> student<span class="token punctuation">.</span>scores<span class="token punctuation">.</span>filter <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">&gt;=</span> <span class="token number">70</span> <span class="token operator">&amp;&amp;</span> <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token number">85</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>count</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Unable to calculate student results.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Total test results: </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">totalResults</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Distinctions: </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">totalDistinctions</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Passes: </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">totalPasses</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That loops over batches of students, adding however many tests they have taken to the total, then filtering their results and adding to either <code>totalDistinctions</code> or <code>totalPasses</code>.</p><p>The default batch size is 5000 objects, so SwiftData will load the first 5000 students, process them in the batch, then load the next 5000, and so on.</p><p>You can adjust the batch size using the <code>batchSize</code> parameter. For example, if I knew that each of my <code>Student</code> objects was quite large, for example if they had image data stored, it would be smart to reduce the batch size to 1000 or less so that fewer objects are loaded at a time:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">try</span> modelContext<span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> batchSize<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> student <span class="token keyword">in</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This is a trade-off: using a lower batch size ought to save memory, but will increase the amount of disk I/O. Similarly, using a larger batch size will reduce disk I/O but <em>increase</em> memory.</p><p>All that probably sounds very welcome, but in practice things aren‚Äôt so straightforward. Yes, adjusting the batch size <em>ought to</em> let us trade memory for I/O to get performance that fits our app, but at the time of writing SwiftData seems to keep all the objects in memory even after they have been processed, so you get huge memory bloat even with a reduced batch size.</p><p>Apple bills <code>enumerate()</code> as a method that ‚Äúencapsulates platform best practices for traversing lots of data,‚Äù but please double check it to make sure it actually works well in your project.</p>`,11);function g(o,b){const a=r("VPCard");return u(),l("div",null,[t("h1",h,[t("a",m,[t("span",null,p(o.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),s(a,n(e({title:"SwiftData by Example",desc:"Back to Home",link:"/hackingwithswift.com/swiftdata/README.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(174,10,10,0.2)"})),null,16),f,k,s(a,n(e({title:"How to enumerate a fetch request to handle lots of data efficiently | SwiftData by Example",desc:"How to enumerate a fetch request to handle lots of data efficiently",link:"https://hackingwithswift.com/quick-start/swiftdata/how-to-enumerate-a-fetch-request-to-handle-lots-of-data-efficiently",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),w])}const q=i(d,[["render",g],["__file","how-to-enumerate-a-fetch-request-to-handle-lots-of-data-efficiently.html.vue"]]),_=JSON.parse('{"path":"/hackingwithswift.com/swiftdata/how-to-enumerate-a-fetch-request-to-handle-lots-of-data-efficiently.html","title":"How to enumerate a fetch request to handle lots of data efficiently","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"How to enumerate a fetch request to handle lots of data efficiently","description":"Article(s) > How to enumerate a fetch request to handle lots of data efficiently","category":["Swift","Article(s)"],"tag":["blog","hackingwithswift.com","crashcourse","swift","swiftdata","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > How to enumerate a fetch request to handle lots of data efficiently"},{"property":"og:description","content":"How to enumerate a fetch request to handle lots of data efficiently"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/swiftdata/how-to-enumerate-a-fetch-request-to-handle-lots-of-data-efficiently.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/swiftdata/how-to-enumerate-a-fetch-request-to-handle-lots-of-data-efficiently.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"How to enumerate a fetch request to handle lots of data efficiently"}],["meta",{"property":"og:description","content":"Article(s) > How to enumerate a fetch request to handle lots of data efficiently"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"hackingwithswift.com"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"swiftdata"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:published_time","content":"2023-09-30T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How to enumerate a fetch request to handle lots of data efficiently\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-09-30T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[]}"]],"date":"2023-09-30T00:00:00.000Z","isOriginal":false},"headers":[],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":2.02,"words":606},"filePathRelative":"hackingwithswift.com/swiftdata/how-to-enumerate-a-fetch-request-to-handle-lots-of-data-efficiently.md","localizedDate":"2023ÎÖÑ 9Ïõî 30Ïùº","excerpt":"\\n"}');export{q as comp,_ as data};
