import{_ as m}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,b as n,t as g,e as a,n as c,g as r,w as t,d as s,f as o,r as p,o as v}from"./app-BgNevrm5.js";const b={},y={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},f={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},w={class:"table-of-contents"},_=n("hr",null,null,-1),q=n("p",null,"Modern web applications need to serve increasing numbers of users and handle surges in traffic. When a single server reaches its limits, performance degrades, leading to slow response times, errors, or complete downtime.",-1),P=n("p",null,"Load balancing is a key technique to address these challenges and improve the scalability of your application.",-1),A=n("p",null,"In this article, we will explore:",-1),R=n("li",null,"How to leverage horizontal scaling for performance gains",-1),x=n("li",null,"How to utilize K6 as a load testing tool",-1),S=o('<p>We&#39;ll dive into load balancing, why it matters, and how YARP simplifies the process for .NET applications.</p><hr><h2 id="types-of-software-scalability" tabindex="-1"><a class="header-anchor" href="#types-of-software-scalability"><span>Types of Software Scalability</span></a></h2><p>Before exploring YARP and load balancing further, let&#39;s cover the fundamentals of scaling.</p><p>There are two main approaches:</p><ul><li><strong>Vertical Scaling</strong>: Involves upgrading individual servers with more powerful hardware - more CPU cores, RAM, and faster storage. However, this has a few limitations: costs escalate quickly, and you&#39;ll still hit a performance ceiling.</li><li><strong>Horizontal Scaling</strong>: Involves adding more servers to your infrastructure and distributing the load intelligently among them. This approach offers greater scalability potential, as you can continue adding servers to handle more traffic.</li></ul><p>Horizontal scaling is where load balancing comes in, and YARP shines bright in this approach.</p><hr><h2 id="adding-a-reverse-proxy" tabindex="-1"><a class="header-anchor" href="#adding-a-reverse-proxy"><span>Adding a Reverse Proxy</span></a></h2>',9),j={href:"https://microsoft.github.io/reverse-proxy/index.html",target:"_blank",rel:"noopener noreferrer"},T=o(`<p>Setting up YARP is quite straightforward. You&#39;ll install the YARP NuGet package, create a basic configuration to define your backend destinations, and then activate the YARP middleware. YARP allows you to perform routing and transformation tasks on incoming requests before they reach your backend servers.</p><p>First, let&#39;s install the <code>Yarp.ReverseProxy</code> NuGet package:</p><div class="language-pwsh line-numbers-mode" data-highlighter="prismjs" data-ext="pwsh" data-title="pwsh"><pre><code><span class="line">Install-Package Yarp.ReverseProxy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Then, we&#39;re going to configure the required application services and introduce the YARP middleware to the request pipeline:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line"><span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line highlighted">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddReverseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line highlighted">    <span class="token punctuation">.</span><span class="token function">LoadFromConfig</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;ReverseProxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line highlighted">app<span class="token punctuation">.</span><span class="token function">MapReverseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),Y=n("code",null,"appsettings.json",-1),z=n("code",null,"Routes",-1),C=n("code",null,"Clusters",-1),I=n("code",null,"{**catch-all}",-1),E=o(`<div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;ReverseProxy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;Routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;api-route&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{**catch-all}&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Transforms&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;PathPattern&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{**catch-all}&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Clusters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;api-cluster&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;Destinations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;destination1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://api:8080&quot;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This configures YARP as a pass-through proxy, but let&#39;s update it to support horizontal scaling.</p><hr><h2 id="scaling-out-with-yarp-load-balancing" tabindex="-1"><a class="header-anchor" href="#scaling-out-with-yarp-load-balancing"><span>Scaling Out With YARP Load Balancing</span></a></h2>`,4),H={href:"https://microsoft.github.io/reverse-proxy/articles/load-balancing.html",target:"_blank",rel:"noopener noreferrer"},N=o(`<ul><li><code>PowerOfTwoChoices</code>: Selects two random destinations and selects the one with the least assigned requests.</li><li><code>FirstAlphabetical</code>: Selects the alphabetically first available destination server.</li><li><code>LeastRequests</code>: Sends requests to servers with the least assigned requests.</li><li><code>RoundRobin</code>: Distributes requests evenly across backend servers.</li><li><code>Random</code>: Randomly selects a backend server for each request.</li></ul><p>You configure these strategies within YARP&#39;s configuration file. The load balancing strategy can be configured using the <code>LoadBalancingPolicy</code> property on the cluster.</p><p>Here&#39;s what the updated YARP configuration looks like with <code>RoundRobin</code> load balancing:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;ReverseProxy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;Routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;api-route&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;ClusterId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api-cluster&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{**catch-all}&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Transforms&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;PathPattern&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{**catch-all}&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Clusters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;api-cluster&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">        <span class="token property">&quot;LoadBalancingPolicy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;RoundRobin&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;Destinations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">          <span class="token property">&quot;destination1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://api-1:8080&quot;</span></span>
<span class="line highlighted">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line highlighted">          <span class="token property">&quot;destination2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://api-2:8080&quot;</span></span>
<span class="line highlighted">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line highlighted">          <span class="token property">&quot;destination3&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">            <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://api-3:8080&quot;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s a diagram of what our system could look like with a YARP load balancer and horizontally scaled application servers.</p><p>The incoming API requests will first hit YARP, distributing the traffic to the application servers based on the load balancing strategy. In this example, there&#39;s one database serving multiple application instances.</p><figure><img src="https://milanjovanovic.tech/blogs/mnw_083/horizontal_scaling.png?imwidth=3840" alt="Horizontal scaling with a YARP load balancer." tabindex="0" loading="lazy"><figcaption>Horizontal scaling with a YARP load balancer.</figcaption></figure><p>And now, let&#39;s do some performance testing.</p><hr><h2 id="performance-testing-with-k6" tabindex="-1"><a class="header-anchor" href="#performance-testing-with-k6"><span>Performance Testing with K6</span></a></h2>`,10),B={href:"https://k6.io/",target:"_blank",rel:"noopener noreferrer"},L=n("code",null,"POST /users",-1),W={href:"https://postgresql.org/",target:"_blank",rel:"noopener noreferrer"},M=n("code",null,"GET /users/id",-1),D=o(`<p>Here&#39;s a k6 performance test that will:</p><ul><li>Ramp up to <strong>20 virtual users</strong></li><li>Send a <code>POST</code> request to the <code>/users</code> endpoint</li><li>Check that the response is <code>201 Created</code></li><li>Send a <code>GET</code> request to the <code>/users/{id}</code> endpoint</li><li>Check that the response is <code>200 OK</code></li></ul><p>Note that all API requests go through the YARP load balancer.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> check <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;k6&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">&#39;k6/http&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">stages</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;10s&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;1m40s&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;10s&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> proxyUrl <span class="token operator">=</span> <span class="token string">&#39;http://localhost:3000&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> response <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>proxyUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/users</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">check</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&#39;response code was 201&#39;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">201</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> userResponse <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>proxyUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>response<span class="token punctuation">.</span>body<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">check</span><span class="token punctuation">(</span>userResponse<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&#39;response code was 200&#39;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),K={href:"https://docker.com",target:"_blank",rel:"noopener noreferrer"},G=n("code",null,"1 CPU",-1),O=n("code",null,"0.5G",-1),V=o(`<div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">api</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>DOCKER_REGISTRY<span class="token punctuation">-</span><span class="token punctuation">}</span>loadbalancingapi</span>
<span class="line highlighted">    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line highlighted">    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> <span class="token string">&#39;0.5G&#39;</span></span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> 5000<span class="token punctuation">:</span><span class="token number">8080</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> proxybackend</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, here are the k6 performance testing results:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">|    API Instances   |     Request Duration     |    Requests Per Second    |</span>
<span class="line">|------------------- |------------------------- |---------------------------:</span>
<span class="line">|         1          |         9.68 ms          |          2260/s           |</span>
<span class="line">|--------------------|------------------------- |---------------------------|</span>
<span class="line">|         2          |         6.57 ms          |          2764/s           |</span>
<span class="line">|--------------------|------------------------- |---------------------------|</span>
<span class="line">|         3          |         5.62 ms          |          3227/s           |</span>
<span class="line">|--------------------|------------------------- |---------------------------|</span>
<span class="line">|         5          |         4.65 ms          |          3881/s           </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>Horizontal scaling, coupled with effective load balancing, can significantly enhance the performance and scalability of your web applications. The benefits of horizontal scaling become especially apparent in high-traffic scenarios where a single server can no longer cope with the demand.</p><p>YARP is a powerful and user-friendly reverse proxy server for .NET applications. However, highly complex, large-scale distributed systems might benefit from specialized, standalone load-balancing solutions. These dedicated solutions can offer more granular control and sophisticated features.</p>`,7),F={href:"https://github.com/m-jovanovic/yarp-load-balancing",target:"_blank",rel:"noopener noreferrer"},J=n("code",null,"m-jovanovic/yarp-load-balancing",-1),U=n("p",null,"That's all for today. I'll see you next week.",-1);function $(h,Z){const l=p("VPCard"),i=p("router-link"),u=p("SiteInfo"),d=p("RouteLink"),e=p("FontIcon");return v(),k("div",null,[n("h1",y,[n("a",f,[n("span",null,g(h.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),a(l,c(r({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),a(l,c(r({title:"Node.js > Article(s)",desc:"Article(s)",link:"/programming/js-node/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),a(l,c(r({title:"Docker > Article(s)",desc:"Article(s)",link:"/devops/docker/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",w,[n("ul",null,[n("li",null,[a(i,{to:"#types-of-software-scalability"},{default:t(()=>[s("Types of Software Scalability")]),_:1})]),n("li",null,[a(i,{to:"#adding-a-reverse-proxy"},{default:t(()=>[s("Adding a Reverse Proxy")]),_:1})]),n("li",null,[a(i,{to:"#scaling-out-with-yarp-load-balancing"},{default:t(()=>[s("Scaling Out With YARP Load Balancing")]),_:1})]),n("li",null,[a(i,{to:"#performance-testing-with-k6"},{default:t(()=>[s("Performance Testing with K6")]),_:1})]),n("li",null,[a(i,{to:"#summary"},{default:t(()=>[s("Summary")]),_:1})])])]),_,a(u,{name:"Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing",desc:"When a single server reaches its limits, performance degrades, leading to slow response times, errors, or complete downtime. We'll dive into load balancing, why it matters, and how YARP simplifies the process for .NET applications.",url:"https://milanjovanovic.tech/blog/horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_083.png"}),q,P,A,n("ul",null,[n("li",null,[s("How to use "),a(d,{to:"/milanjovanovic.tech/implementing-an-api-gateway-for-microservices-with-yarp.html"},{default:t(()=>[s("YARP (Yet Another Reverse Proxy)")]),_:1}),s(" to implement load balancing")]),R,x]),S,n("p",null,[n("a",j,[a(e,{icon:"fa-brands fa-microsoft"}),s("YARP")]),s(" is a high-performance reverse proxy library from Microsoft. It's designed with modern microservice architectures in mind. A reverse proxy sits in front of your backend servers, acting as a traffic director.")]),T,n("p",null,[s("All that's left is adding the YARP configuration to our "),a(e,{icon:"iconfont icon-json"}),Y,s(" file. YARP uses "),z,s(" to represent incoming requests to the reverse proxy and "),C,s(" to define the downstream services. The "),I,s(" pattern allows us to easily route all incoming requests.")]),E,n("p",null,[s("The core of horizontal scaling with YARP lies in its various "),n("a",H,[a(e,{icon:"fa-brands fa-microsoft"}),s("load balancing strategies")]),s(":")]),N,n("p",null,[s("To see the impact of our horizontal scaling efforts, we need to do some load testing. "),n("a",B,[a(e,{icon:"fas fa-globe"}),s("K6")]),s(" is a modern, developer-friendly load testing tool. We'll write K6 scripts to simulate user traffic on our application and compare metrics like average response time and the number of successful requests per second.")]),n("p",null,[s("The application we're going to scale horizontally has two API endpoints. The "),L,s(" endpoint creates a new user, saves the user to a "),n("a",W,[a(e,{icon:"iconfont icon-postgresql"}),s("PostgreSQL")]),s(" database, and returns the user's identifier. The "),M,s(" endpoint returns a user with the given identifer if it exists.")]),D,n("p",null,[s("To make the performance testing results more consistent, we can limit the available resources on the "),n("a",K,[a(e,{icon:"fa-brands fa-docker"}),s("Docker")]),s(" containers to "),G,s(" and "),O,s(" of RAM.")]),V,n("p",null,[s("If you want to learn more, here's how to "),a(d,{to:"/milanjovanovic.tech/implementing-an-api-gateway-for-microservices-with-yarp.html"},{default:t(()=>[s("build an API Gateway using YARP")]),_:1}),s(".")]),n("p",null,[s("You can find the "),n("a",F,[s("source code ("),a(e,{icon:"iconfont icon-github"}),J,s(")")]),s(" for this example on GitHub.")]),a(u,{name:"m-jovanovic/yarp-load-balancing",desc:"An example project demonstrating how to horizontally scale an application using YARP, and run performance tests with k6.",url:"https://github.com/m-jovanovic/yarp-load-balancing",logo:"https://avatars.githubusercontent.com/u/34191235?s=48&v=4",preview:"https://opengraph.githubassets.com/61a2e8dffbd0b24de86ab40acff6d0fc6a930667094bc6b22a1bfafec55af365/m-jovanovic/yarp-load-balancing"}),U])}const nn=m(b,[["render",$],["__file","horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing.html.vue"]]),sn=JSON.parse('{"path":"/milanjovanovic.tech/horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing.html","title":"Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing","description":"Article(s) > Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing","icon":"iconfont icon-csharp","category":["C#","DotNet","Node.js","Docker","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet","node","nodejs","node-js","docker","container"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing"},{"property":"og:description","content":"Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing"}],["meta",{"property":"og:description","content":"Article(s) > Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_083.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_083.png"}],["meta",{"name":"twitter:image:alt","content":"Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing"}],["meta",{"property":"article:author","content":"Milan Jovanoviƒá"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:tag","content":"node"}],["meta",{"property":"article:tag","content":"nodejs"}],["meta",{"property":"article:tag","content":"node-js"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:tag","content":"container"}],["meta",{"property":"article:published_time","content":"2024-03-30T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Horizontally Scaling ASP.NET Core APIs With YARP Load Balancing\\",\\"image\\":[\\"https://milanjovanovic.tech/blogs/mnw_083/horizontal_scaling.png?imwidth=3840\\"],\\"datePublished\\":\\"2024-03-30T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanoviƒá\\"}]}"]],"prev":"/programming/cs/articles/README.md","date":"2024-03-30T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanoviƒá","cover":"https://milanjovanovic.tech/blog-covers/mnw_083.png"},"headers":[{"level":2,"title":"Types of Software Scalability","slug":"types-of-software-scalability","link":"#types-of-software-scalability","children":[]},{"level":2,"title":"Adding a Reverse Proxy","slug":"adding-a-reverse-proxy","link":"#adding-a-reverse-proxy","children":[]},{"level":2,"title":"Scaling Out With YARP Load Balancing","slug":"scaling-out-with-yarp-load-balancing","link":"#scaling-out-with-yarp-load-balancing","children":[]},{"level":2,"title":"Performance Testing with K6","slug":"performance-testing-with-k6","link":"#performance-testing-with-k6","children":[]},{"level":2,"title":"Summary","slug":"summary","link":"#summary","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":4.74,"words":1421},"filePathRelative":"milanjovanovic.tech/horizontally-scaling-aspnetcore-apis-with-yarp-load-balancing.md","localizedDate":"2024ÎÖÑ 3Ïõî 30Ïùº","excerpt":"\\n","copyright":{"author":"Milan Jovanoviƒá"}}');export{nn as comp,sn as data};
