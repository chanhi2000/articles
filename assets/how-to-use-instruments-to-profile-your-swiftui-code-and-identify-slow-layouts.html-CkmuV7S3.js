import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,b as e,t as w,e as t,n as s,g as a,w as i,f as r,r as p,o as m,d as l}from"./app-BgNevrm5.js";const f={},g={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},y={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},k={class:"table-of-contents"},b=e("hr",null,null,-1),v=r(`<blockquote><p>Updated for Xcode 15</p></blockquote><p>Xcode‚Äôs Instruments tool comes with a fantastic set of analytics for SwiftUI, allowing us to identify how often views were redrawn, how many times calculating the body of a view was slow, and even how our state has changed over time.</p><p>First, we need something that is able to provide interesting results we can look at in Instruments. So, this code creates a timer that triggers every 0.01 seconds, and has a body view that shows a random <code>UUID</code> and a button that increases the value it shows every time it‚Äôs tapped:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">FrequentUpdater</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> timer<span class="token punctuation">:</span> <span class="token class-name">Timer</span><span class="token operator">?</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        timer <span class="token operator">=</span> <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">scheduledTimer</span><span class="token punctuation">(</span></span>
<span class="line">            withTimeInterval<span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span></span>
<span class="line">            repeats<span class="token punctuation">:</span> <span class="token boolean">true</span></span>
<span class="line">        <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span></span>
<span class="line">            <span class="token keyword">self</span><span class="token punctuation">.</span>objectWillChange<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute atrule">@StateObject</span> <span class="token keyword">private</span> <span class="token keyword">var</span> updater <span class="token operator">=</span> <span class="token class-name">FrequentUpdater</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> tapCount <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">VStack</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation"><span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>uuidString</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Tap count: </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">tapCount</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                tapCount <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),I=r('<p>If you run that code in the simulator you‚Äôll see it‚Äôs redrawing constantly because it has values that are always changing.</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>This is a stress test specifically designed to make SwiftUI do a lot of work in order that Instruments shows us interesting data ‚Äì you do <em>not</em> want to use the above code in an actual app.</p></div><hr><h2 id="instrumenting-our-code" tabindex="-1"><a class="header-anchor" href="#instrumenting-our-code"><span>Instrumenting our code</span></a></h2><p>Now press <kbd>Cmd</kbd>+<kbd>I</kbd> to run the code through Instruments, and choose the SwiftUI instrument. When it appears, press the record button to make it launch the app and start watching it. Now let it run for a few seconds while you click the button ten or so times, then press stop in Instruments ‚Äì we have enough data to work with.</p>',5),S=r('<p>By default the SwiftUI instrument tells us a variety of things:</p><ol><li>How many views were created during that time and how long it took to create them (‚ÄúView Body‚Äù)</li><li>What the properties of the views were and how they changed over time (‚ÄúView Properties‚Äù)</li><li>How many Core Animation commits took place (‚ÄúCore Animation Commits‚Äù)</li><li>Exactly how much time each function call took (‚ÄúTime Profiler‚Äù)</li></ol><p>Each of these instruments can help you diagnose and solve performance problems in your SwiftUI applications, so it‚Äôs worth taking the time to try them out.</p><p>For our little stress test sandbox you will see solid walls of color for View Body, View Properties, and Core Animation Commits, which is an immediate red flag. It tells us that not only is SwiftUI having to recreate our views constantly, but that our properties are changing constantly and as a result Core Animation is having to work overtime to keep up.</p><hr><h2 id="monitoring-body-invocations" tabindex="-1"><a class="header-anchor" href="#monitoring-body-invocations"><span>Monitoring body invocations</span></a></h2><p>If you select the View Body track ‚Äì that‚Äôs the first row in the list of instruments ‚Äì you should be able to see that Instruments breaks down the results into SwiftUI and your project, with the former being primitive types like text views and buttons, and the latter containing your custom view types. In our case, that will mean ‚ÄúContentView‚Äù should appear for the custom views, because that‚Äôs the name of our view.</p><p>Now, what you <em>won‚Äôt</em> see here is a perfect one-to-one mapping of your code to SwiftUI views, because SwiftUI aggressively collapses its view hierarchy to do as little work as possible. So, don‚Äôt expect to see any <code>VStack</code> creation in the code ‚Äì that is effectively free for this app.</p><p>On this screen, the numbers that matter are Count and Avg Duration ‚Äì how many times each thing was created, and how long it took. Because this is a stress test you should see very high numbers for Count, but our layout is trivial so the Avg Duration is likely to be a few dozen microseconds.</p><figure><img src="https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-3~dark@2x.png" alt="&quot;A table showing that ContentView was drawn 800 times, taking about 35 microseconds for each draw." tabindex="0" loading="lazy"><figcaption>&quot;A table showing that ContentView was drawn 800 times, taking about 35 microseconds for each draw.</figcaption></figure><hr><h2 id="tracking-state-changes" tabindex="-1"><a class="header-anchor" href="#tracking-state-changes"><span>Tracking state changes</span></a></h2><p>Next, select the View Properties track, which is the second row in the list of instruments. This shows all the properties for all views, including both their current value and all previous values.</p><p>Our example app had a button that changed its label when tapped by adding one to a number, and that‚Äôs visible right there in this instrument ‚Äì look for the view type ContentView and the Property Type <code>State&lt;Int&gt;</code>.</p><p>Sadly, Instruments isn‚Äôt (yet?) able to show us the exact property name there, which might be more confusing if you had several pieces of integer state being tracked. However, it does have a different trick up its sleeve: at the top of the recording window is an arrow marking the current view position, and if you drag that around you‚Äôll see exactly how the application state evolved over time ‚Äì every time you tapped the button you‚Äôll see that state integer went up by one, and you can wind forward and backward to see it happen.</p>',15),x=r('<p>This unlocks a <em>huge</em> amount of power, because it lets us directly see when state changes caused slow redraws or other work ‚Äì it‚Äôs almost like being in a time machine where you can inspect the exact state of your app at every point during its run.</p><hr><h2 id="identifying-slow-draws" tabindex="-1"><a class="header-anchor" href="#identifying-slow-draws"><span>Identifying slow draws</span></a></h2><p>Although SwiftUI is able to drop down straight to Metal for increased performance, most of the time it prefers to use Core Animation for its rendering. This means we automatically get the built-in Core Animation profiling tools from Instruments, including the ability to detect expensive commits.</p><p>Core Animation works best when multiple changes are placed together into a single group, known as a <em>transaction</em>. We effectively stack up a selection of work in one transaction, then ask CA to proceed with rendering the work ‚Äì known as <em>committing</em> the transaction.</p><p>So, when Instruments shows us expensive Core Animation commits, what it‚Äôs really showing us is how many times SwiftUI was forced to redraw the pixels on our screen because of updates. In theory this should only happen when the actual state of our app resulted in a different view hierarchy, because SwiftUI should be able to compare the new output of our <code>body</code> property with the previous output.</p><figure><img src="https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-5~dark@2x.png" alt="The Core Animation Commits Instrument." tabindex="0" loading="lazy"><figcaption>The Core Animation Commits Instrument.</figcaption></figure><hr><h2 id="looking-for-slow-function-calls" tabindex="-1"><a class="header-anchor" href="#looking-for-slow-function-calls"><span>Looking for slow function calls</span></a></h2><p>The final important track is the last one, Time Profiler, which shows us exactly how much time was spent in each part of our code. This works identically to the regular time profiler in Instruments, but if you haven‚Äôt tried that before here‚Äôs the least you need to know:</p><ol><li>The extended detail window on the right shows you the heaviest stack trace by default, which is the piece of code that took longest to run. Bright code (white or black, depending on your macOS color scheme) is code you wrote; dim code (gray) is system library code.</li><li>On the left you can see all the threads that were created, along with disclosure indicators letting you drill down into the functions they called and the functions <em>those</em> functions called, etc. Most of the work will happen inside ‚Äústart‚Äù.</li><li>To avoid clutter you might want to click the Call Tree button at the bottom, then choose Hide System Libraries. This will only show code that you wrote, however if your problem is that you were using the system libraries badly this might not help.</li><li>To get straight to specific details, you can also click Call Tree and choose Invert Call Tree to flip things around so that leaf functions ‚Äì those at the end of the tree ‚Äì are shown at the top, and the disclosure indicators now let you drill down (drill up?) to the functions that called them.</li></ol><p>Although the time profiler is extremely useful for identifying performance problems, often just looking at the the heaviest stack trace will highlight the biggest problem.</p><figure><img src="https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-6~dark@2x.png" alt="The Time Profiler Instrument with ‚ÄúInvert Call Tree‚Äù and ‚ÄúHide System Libraries‚Äù enabled." tabindex="0" loading="lazy"><figcaption>The Time Profiler Instrument with ‚ÄúInvert Call Tree‚Äù and ‚ÄúHide System Libraries‚Äù enabled.</figcaption></figure><hr><h2 id="last-tips" tabindex="-1"><a class="header-anchor" href="#last-tips"><span>Last tips</span></a></h2><p>Before you charge off to profile your own code, there are a handful of things to be aware of:</p><ol><li>When examining a small part of your app‚Äôs performance, you should click and drag over the range in question so that you see only statistics for that part of the app. This lets you focus on performance for specific actions, such as responding to a button press.</li><li>Even though you see solid color bars in Instruments, they only look that way from afar ‚Äì you can zoom by holding down Cmd and pressing - and + to see more detail</li><li>For the most accurate figures, always profile on a real device.</li><li>If you want to make changes as a result of profiling your code, always make one change at a time. If you make two changes it‚Äôs possible one will increase your performance by 20% and the other will decrease it by 10%, but doing them together means you probably think as a whole they increased performance by 10%.</li><li>Instruments runs your code in release mode, which enables all of Swift‚Äôs optimizations. This will also affect any debugging flags you‚Äôve added to your code, so be careful.</li></ol>',17),_={class:"hint-container details"},U=e("summary",null,"Similar solutions‚Ä¶",-1);function T(u,C){const n=p("VPCard"),o=p("router-link"),c=p("VidStack");return m(),h("div",null,[e("h1",g,[e("a",y,[e("span",null,w(u.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),t(n,s(a({title:"SwiftUI by Example",desc:"Back to Home",link:"/hackingwithswift.com/swiftui/README.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(174,10,10,0.2)"})),null,16),e("nav",k,[e("ul",null,[e("li",null,[t(o,{to:"#instrumenting-our-code"},{default:i(()=>[l("Instrumenting our code")]),_:1})]),e("li",null,[t(o,{to:"#monitoring-body-invocations"},{default:i(()=>[l("Monitoring body invocations")]),_:1})]),e("li",null,[t(o,{to:"#tracking-state-changes"},{default:i(()=>[l("Tracking state changes")]),_:1})]),e("li",null,[t(o,{to:"#identifying-slow-draws"},{default:i(()=>[l("Identifying slow draws")]),_:1})]),e("li",null,[t(o,{to:"#looking-for-slow-function-calls"},{default:i(()=>[l("Looking for slow function calls")]),_:1})]),e("li",null,[t(o,{to:"#last-tips"},{default:i(()=>[l("Last tips")]),_:1})])])]),b,t(n,s(a({title:"How to use Instruments to profile your SwiftUI code and identify slow layouts | SwiftUI by Example",desc:"How to use Instruments to profile your SwiftUI code and identify slow layouts",link:"https://hackingwithswift.com/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layouts",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),v,t(c,{src:"https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-1~dark.mp4"}),I,t(c,{src:"https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-2~dark.mp4"}),S,t(c,{src:"https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-4~dark.mp4"}),x,e("details",_,[U,t(n,s(a({title:"SwiftUI tips and tricks | SwiftUI by Example",desc:"SwiftUI tips and tricks",link:"/hackingwithswift.com/swiftui/swiftui-tips-and-tricks.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),t(n,s(a({title:"All SwiftUI property wrappers explained and compared | SwiftUI by Example",desc:"All SwiftUI property wrappers explained and compared",link:"/hackingwithswift.com/swiftui/all-swiftui-property-wrappers-explained-and-compared.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),t(n,s(a({title:"How to customize stack layouts with alignment and spacing | SwiftUI by Example",desc:"How to customize stack layouts with alignment and spacing",link:"/hackingwithswift.com/swiftui/how-to-customize-stack-layouts-with-alignment-and-spacing.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),t(n,s(a({title:"Building a menu using List | SwiftUI by Example",desc:"Building a menu using List",link:"/hackingwithswift.com/swiftui/building-a-menu-using-list.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),t(n,s(a({title:"Frequently asked questions about SwiftUI | SwiftUI by Example",desc:"Frequently asked questions about SwiftUI",link:"/hackingwithswift.com/swiftui/frequently-asked-questions-about-swiftui.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16)])])}const V=d(f,[["render",T],["__file","how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layouts.html.vue"]]),H=JSON.parse('{"path":"/hackingwithswift.com/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layouts.html","title":"How to use Instruments to profile your SwiftUI code and identify slow layouts","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"How to use Instruments to profile your SwiftUI code and identify slow layouts","description":"Article(s) > How to use Instruments to profile your SwiftUI code and identify slow layouts","category":["Swift","SwiftUI","Article(s)"],"tag":["blog","hackingwithswift.com","crashcourse","swift","swiftui","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > How to use Instruments to profile your SwiftUI code and identify slow layouts"},{"property":"og:description","content":"How to use Instruments to profile your SwiftUI code and identify slow layouts"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layouts.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layouts.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"How to use Instruments to profile your SwiftUI code and identify slow layouts"}],["meta",{"property":"og:description","content":"Article(s) > How to use Instruments to profile your SwiftUI code and identify slow layouts"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-3~dark@2x.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"hackingwithswift.com"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"swiftui"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How to use Instruments to profile your SwiftUI code and identify slow layouts\\",\\"image\\":[\\"https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-3~dark@2x.png\\",\\"https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-5~dark@2x.png\\",\\"https://hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layout-6~dark@2x.png\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Instrumenting our code","slug":"instrumenting-our-code","link":"#instrumenting-our-code","children":[]},{"level":2,"title":"Monitoring body invocations","slug":"monitoring-body-invocations","link":"#monitoring-body-invocations","children":[]},{"level":2,"title":"Tracking state changes","slug":"tracking-state-changes","link":"#tracking-state-changes","children":[]},{"level":2,"title":"Identifying slow draws","slug":"identifying-slow-draws","link":"#identifying-slow-draws","children":[]},{"level":2,"title":"Looking for slow function calls","slug":"looking-for-slow-function-calls","link":"#looking-for-slow-function-calls","children":[]},{"level":2,"title":"Last tips","slug":"last-tips","link":"#last-tips","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":6.61,"words":1983},"filePathRelative":"hackingwithswift.com/swiftui/how-to-use-instruments-to-profile-your-swiftui-code-and-identify-slow-layouts.md","excerpt":"\\n"}');export{V as comp,H as data};
