import{_ as u}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,b as n,t as m,e,n as h,g as v,w as a,d as s,f as l,r as o,o as f}from"./app-BgNevrm5.js";const g={},b={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},y={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},w={class:"table-of-contents"},D=n("hr",null,null,-1),_=l(`<p>To delete or not to delete, that is the question (pun intended).</p><p>The traditional way to remove information in a database is through a &quot;hard delete.&quot; A hard delete permanently erases a record from the database table. While this seems straightforward, it presents a significant risk: once that data is gone, it&#39;s gone for good.</p><p>Instead of physically removing a record, a soft delete marks it as deleted, usually by setting a flag like <code>IsDeleted</code> to <code>true</code>. The record remains in the database, but it&#39;s effectively hidden from regular application queries.</p><p>Today, we&#39;ll dive into the details of how to implement soft deletes using EF Core. We&#39;ll discuss global query filters, explore efficient ways to handle soft-deleted data, and weigh the trade-offs.</p><hr><h2 id="what-is-a-soft-delete" tabindex="-1"><a class="header-anchor" href="#what-is-a-soft-delete"><span>What Is a Soft Delete?</span></a></h2><p>A soft delete is a data persistence strategy that prevents the permanent deletion of records from your database. Instead of removing data from the database, a flag is set on the record, indicating it as &quot;deleted.&quot;</p><p>This approach allows the application to ignore these records during normal queries. However, you can restore these records if necessary. Soft delete is also practical if you want to keep foreign key constraints in place. Soft delete is a &quot;non-destructive&quot; operation in contrast with hard delete, where data is completely removed from the database.</p><p>A hard delete uses the SQL <code>DELETE</code> statement:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> bookings<span class="token punctuation">.</span>Reviews</span>
<span class="line"><span class="token keyword">WHERE</span> Id <span class="token operator">=</span> <span class="token variable">@BookingId</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>A soft delete, on the other hand, uses an <code>UPDATE</code> statement:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">UPDATE</span> bookings<span class="token punctuation">.</span>Reviews</span>
<span class="line"><span class="token keyword">SET</span> IsDeleted <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> DeletedOnUtc <span class="token operator">=</span> <span class="token variable">@UtcNow</span></span>
<span class="line"><span class="token keyword">WHERE</span> Id <span class="token operator">=</span> <span class="token variable">@BookingId</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The data is still present in the database, and the operation can be undone.</p><p>But you need to remember to filter out soft-deleted data when querying the database:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span></span>
<span class="line"><span class="token keyword">FROM</span> bookings<span class="token punctuation">.</span>Reviews</span>
<span class="line"><span class="token keyword">WHERE</span> IsDeleted <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,15),x={href:"https://learn.microsoft.com/en-us/ef/core/",target:"_blank",rel:"noopener noreferrer"},I=n("hr",null,null,-1),E=n("h2",{id:"soft-deletes-using-ef-core-interceptors",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#soft-deletes-using-ef-core-interceptors"},[n("span",null,"Soft Deletes Using EF Core Interceptors")])],-1),S={href:"https://learn.microsoft.com/en-us/ef/core/logging-events-diagnostics/interceptors",target:"_blank",rel:"noopener noreferrer"},C=l(`<p>Let&#39;s create an <code>ISoftDeletable</code> marker interface to represent soft-deletable entities:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISoftDeletable</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDeleted <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> DeletedOnUtc <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The entities that should support soft delete will implement this interface. You will need to apply the respective database migration to create these columns.</p><p>The next component we need is a <code>SaveChangesInterceptor</code>, which allows us to hook into the <code>SavingChangesAsync</code> (or <code>SavingChanges</code>) method. We can access the <code>ChangeTracker</code> and look for entries that implement <code>ISoftDeletable</code> and are flagged for deletion. We can figure this out by checking if the entity state is <code>EntityState.Deleted</code>.</p><p>When we find the entities flagged for deletion, we loop through them and update their state to <code>EntityState.Modified</code>. You should also set the respective values for the <code>IsDeleted</code> and <code>DeletedOnUtc</code> properties. This will cause EF to generate an <code>UPDATE</code> operation instead of a <code>DELETE</code> operation.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">SoftDeleteInterceptor</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SaveChangesInterceptor</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">ValueTask<span class="token punctuation">&lt;</span>InterceptionResult<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">SavingChangesAsync</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">DbContextEventData</span> eventData<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">InterceptionResult<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> result<span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name">CancellationToken</span> cancellationToken <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventData<span class="token punctuation">.</span>Context <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">SavingChangesAsync</span><span class="token punctuation">(</span></span>
<span class="line">                eventData<span class="token punctuation">,</span> result<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>EntityEntry<span class="token punctuation">&lt;</span>ISoftDeletable<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entries <span class="token operator">=</span></span>
<span class="line">            eventData</span>
<span class="line">                <span class="token punctuation">.</span>Context</span>
<span class="line">                <span class="token punctuation">.</span>ChangeTracker</span>
<span class="line">                <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entries</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ISoftDeletable<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>State <span class="token operator">==</span> EntityState<span class="token punctuation">.</span>Deleted<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">EntityEntry<span class="token punctuation">&lt;</span>ISoftDeletable<span class="token punctuation">&gt;</span></span> softDeletable <span class="token keyword">in</span> entries<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            softDeletable<span class="token punctuation">.</span>State <span class="token operator">=</span> EntityState<span class="token punctuation">.</span>Modified<span class="token punctuation">;</span></span>
<span class="line">            softDeletable<span class="token punctuation">.</span>Entity<span class="token punctuation">.</span>IsDeleted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">            softDeletable<span class="token punctuation">.</span>Entity<span class="token punctuation">.</span>DeletedOnUtc <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">SavingChangesAsync</span><span class="token punctuation">(</span>eventData<span class="token punctuation">,</span> result<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This approach ensures that all delete operations across the application respect the soft delete policy.</p><p>You&#39;ll need to register the <code>SoftDeleteInterceptor</code> with dependency injection and configure it with the <code>ApplicationDbContext</code>.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SoftDeleteInterceptor<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ApplicationDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">(</span>sp<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> options</span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">AddInterceptors</span><span class="token punctuation">(</span></span>
<span class="line">            sp<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SoftDeleteInterceptor<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),q=n("hr",null,null,-1),T=n("h2",{id:"automatically-filtering-soft-deleted-data",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#automatically-filtering-soft-deleted-data"},[n("span",null,"Automatically Filtering Soft-Deleted Data")])],-1),F=n("code",null,"OnModelCreating",-1),A=l(`<p>Here&#39;s how to configure the soft delete query filter:</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationDbContext</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>UsersDbContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">DbContext</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Review<span class="token punctuation">&gt;</span></span> Reviews <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">ModelBuilder</span> modelBuilder<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line highlighted">        modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Review<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">HasQueryFilter</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token operator">!</span>r<span class="token punctuation">.</span>IsDeleted<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A limitation is you can&#39;t have more than one query filter configured per entity.</p><p>However, it&#39;s sometimes useful to explicitly include soft-deleted records. You can achieve this using the <code>IgnoreQueryFilters</code> method.</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line">dbContex<span class="token punctuation">.</span>Reviews</span>
<span class="line highlighted">    <span class="token punctuation">.</span><span class="token function">IgnoreQueryFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>ApartmentId <span class="token operator">==</span> apartmentId<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="faster-queries-using-filtered-index" tabindex="-1"><a class="header-anchor" href="#faster-queries-using-filtered-index"><span>Faster Queries Using Filtered Index</span></a></h2><p>To enhance query performance, especially in tables with a significant number of soft-deleted records, you can use <strong>filtered indexes</strong>. A filtered index only includes records that meet the specified criteria. This reduces the index size and improves query execution times for operations that exclude filtered records. Most popular databases support filtered indexes.</p>`,8),R={href:"https://learn.microsoft.com/en-us/ef/core/modeling/indexes?tabs=data-annotations#index-filter",target:"_blank",rel:"noopener noreferrer"},j=l(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs" data-title="cs"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationDbContext</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>UsersDbContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">DbContext</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Review<span class="token punctuation">&gt;</span></span> Reviews <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">ModelBuilder</span> modelBuilder<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Review<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">HasQueryFilter</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token operator">!</span>r<span class="token punctuation">.</span>IsDeleted<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line highlighted">        modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Review<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line highlighted">            <span class="token punctuation">.</span><span class="token function">HasIndex</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>IsDeleted<span class="token punctuation">)</span></span>
<span class="line highlighted">            <span class="token punctuation">.</span><span class="token function">HasFilter</span><span class="token punctuation">(</span><span class="token string">&quot;IsDeleted = 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>HasFilter</code> method accepts the SQL filter for records that will be included in the index.</p><p>You can also create a filtered index using SQL:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> IX_Reviews_IsDeleted</span>
<span class="line"><span class="token keyword">ON</span> bookings<span class="token punctuation">.</span>Reviews <span class="token punctuation">(</span>IsDeleted<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">WHERE</span> IsDeleted <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can learn more about filtered indexes from the documentation:</p>`,5),W=l('<hr><h2 id="do-you-really-need-soft-deletes" tabindex="-1"><a class="header-anchor" href="#do-you-really-need-soft-deletes"><span>Do You Really Need Soft Deletes?</span></a></h2><p>It&#39;s worthwhile to think through if you even need to soft delete records.</p><p>In enterprise systems, you&#39;re typically not thinking about &quot;deleting&quot; data. There are business concepts that don&#39;t involve deleting data. A few examples are canceling an order, refunding a payment, or voiding an invoice. These &quot;destructive&quot; operations return the system to a previous state. But from a business perspective, you aren&#39;t really deleting data.</p><p>Soft deletes are helpful if there is a risk of accidental deletion. They allow you to easily restore soft-deleted records.</p><p>In any case, consider if soft deletes make sense from a business perspective.</p><hr><h2 id="takeaway" tabindex="-1"><a class="header-anchor" href="#takeaway"><span>Takeaway</span></a></h2><p>Soft deletes offer a valuable safety net for data recovery and can enhance historical data tracking. However, it&#39;s crucial to assess whether they truly align with your application&#39;s specific requirements. Consider factors like the importance of deleted data recovery, any auditing needs, and your industry&#39;s regulations. Creating a filtered index can improve query performance on tables with soft-deleted records.</p><p>If you decide that soft deletes are a good fit, EF Core provides the tools necessary for a streamlined implementation.</p><p>Thanks for reading, and I&#39;ll see you next week!</p>',11);function M(r,U){const d=o("VPCard"),t=o("router-link"),i=o("SiteInfo"),p=o("FontIcon"),c=o("RouteLink");return f(),k("div",null,[n("h1",b,[n("a",y,[n("span",null,m(r.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),e(d,h(v({title:"C# > Article(s)",desc:"Article(s)",link:"/programming/cs/articles/README.md",logo:"/images/ico-wind.svg",background:"rgba(10,10,10,0.2)"})),null,16),n("nav",w,[n("ul",null,[n("li",null,[e(t,{to:"#what-is-a-soft-delete"},{default:a(()=>[s("What Is a Soft Delete?")]),_:1})]),n("li",null,[e(t,{to:"#soft-deletes-using-ef-core-interceptors"},{default:a(()=>[s("Soft Deletes Using EF Core Interceptors")]),_:1})]),n("li",null,[e(t,{to:"#automatically-filtering-soft-deleted-data"},{default:a(()=>[s("Automatically Filtering Soft-Deleted Data")]),_:1})]),n("li",null,[e(t,{to:"#faster-queries-using-filtered-index"},{default:a(()=>[s("Faster Queries Using Filtered Index")]),_:1})]),n("li",null,[e(t,{to:"#do-you-really-need-soft-deletes"},{default:a(()=>[s("Do You Really Need Soft Deletes?")]),_:1})]),n("li",null,[e(t,{to:"#takeaway"},{default:a(()=>[s("Takeaway")]),_:1})])])]),D,e(i,{name:"Implementing Soft Delete With EF Core",desc:"A soft delete is a data persistence strategy that prevents the permanent deletion of records from your database. Today, we'll dive into the details of how to implement soft deletes using EF Core.",url:"https://milanjovanovic.tech/blog/implementing-soft-delete-with-ef-core/",logo:"https://milanjovanovic.tech/profile_favicon.png",preview:"https://milanjovanovic.tech/blog-covers/mnw_081.png"}),_,n("p",null,[s("Let's see how we can implement soft delete with "),n("a",x,[e(p,{icon:"fa-brands fa-microsoft"}),s("EF Core")]),s(".")]),I,E,n("p",null,[n("a",S,[e(p,{icon:"fa-brands fa-microsoft"}),s("EF Core interceptors")]),s(" provide a powerful mechanism for intercepting and modifying database operations. For example, you can intercept the saving changes operation to implement soft delete functionality.")]),C,n("p",null,[s("If you want to learn more, here's an article with a few practical use cases for "),e(c,{to:"/milanjovanovic.tech/how-to-use-ef-core-interceptors.html"},{default:a(()=>[s("EF Core interceptors")]),_:1}),s(".")]),q,T,n("p",null,[s("To ensure that soft-deleted records are automatically excluded from queries, we can use "),e(c,{to:"/milanjovanovic.tech/how-to-use-global-query-filters-in-ef-core.html"},{default:a(()=>[s("EF Core global query filters")]),_:1}),s(". We can apply query filters to entities using the "),F,s(" method to automatically exclude records marked as deleted. This feature dramatically simplifies writing queries.")]),A,n("p",null,[s("Here's how you can configure a "),n("a",R,[e(p,{icon:"fa-brands fa-microsoft"}),s("filtered index with EF Core")]),s(":")]),j,e(i,{name:"Create filtered indexes - SQL Server | Microsoft Learn",desc:"A filtered index is an optimized disk-based rowstore nonclustered index especially suited to cover queries that select from a well-defined subset of data.",url:"https://learn.microsoft.com/en-us/sql/relational-databases/indexes/create-filtered-indexes?view=sql-server-ver16",logo:"/assets/image/learn.microsoft.com/favicon.ico",preview:"/imagea/content/learn.microsoft.com/open-graph-image.png"}),e(i,{name:"PostgreSQL: Documentation: 16: 11.8. Partial Indexes",desc:"11.8. Partial Indexes # A partial index is an index built over a subset of a table; the subset is defined ‚Ä¶",url:"https://postgresql.org/docs/16/indexes-partial.html",logo:"https://postgresql.org/favicon.ico",preview:"https://postgresql.org/media/img/about/press/elephant.png"}),W])}const H=u(g,[["render",M],["__file","implementing-soft-delete-with-ef-core.html.vue"]]),O=JSON.parse('{"path":"/milanjovanovic.tech/implementing-soft-delete-with-ef-core.html","title":"Implementing Soft Delete With EF Core","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Implementing Soft Delete With EF Core","description":"Article(s) > Implementing Soft Delete With EF Core","icon":"iconfont icon-csharp","category":["C#","DotNet","Article(s)"],"tag":["blog","milanjovanovic.tech","cs","c#","csharp","dotnet"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > Implementing Soft Delete With EF Core"},{"property":"og:description","content":"Implementing Soft Delete With EF Core"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/implementing-soft-delete-with-ef-core.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/milanjovanovic.tech/implementing-soft-delete-with-ef-core.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"Implementing Soft Delete With EF Core"}],["meta",{"property":"og:description","content":"Article(s) > Implementing Soft Delete With EF Core"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://milanjovanovic.tech/blog-covers/mnw_081.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://milanjovanovic.tech/blog-covers/mnw_081.png"}],["meta",{"name":"twitter:image:alt","content":"Implementing Soft Delete With EF Core"}],["meta",{"property":"article:author","content":"Milan Jovanoviƒá"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"milanjovanovic.tech"}],["meta",{"property":"article:tag","content":"cs"}],["meta",{"property":"article:tag","content":"c#"}],["meta",{"property":"article:tag","content":"csharp"}],["meta",{"property":"article:tag","content":"dotnet"}],["meta",{"property":"article:published_time","content":"2024-03-16T00:00:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Implementing Soft Delete With EF Core\\",\\"image\\":[\\"https://milanjovanovic.tech/blog-covers/mnw_081.png\\"],\\"datePublished\\":\\"2024-03-16T00:00:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Milan Jovanoviƒá\\"}]}"]],"prev":"/programming/cs/articles/README.md","date":"2024-03-16T00:00:00.000Z","isOriginal":false,"author":"Milan Jovanoviƒá","cover":"https://milanjovanovic.tech/blog-covers/mnw_081.png"},"headers":[{"level":2,"title":"What Is a Soft Delete?","slug":"what-is-a-soft-delete","link":"#what-is-a-soft-delete","children":[]},{"level":2,"title":"Soft Deletes Using EF Core Interceptors","slug":"soft-deletes-using-ef-core-interceptors","link":"#soft-deletes-using-ef-core-interceptors","children":[]},{"level":2,"title":"Automatically Filtering Soft-Deleted Data","slug":"automatically-filtering-soft-deleted-data","link":"#automatically-filtering-soft-deleted-data","children":[]},{"level":2,"title":"Faster Queries Using Filtered Index","slug":"faster-queries-using-filtered-index","link":"#faster-queries-using-filtered-index","children":[]},{"level":2,"title":"Do You Really Need Soft Deletes?","slug":"do-you-really-need-soft-deletes","link":"#do-you-really-need-soft-deletes","children":[]},{"level":2,"title":"Takeaway","slug":"takeaway","link":"#takeaway","children":[]}],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":4.71,"words":1412},"filePathRelative":"milanjovanovic.tech/implementing-soft-delete-with-ef-core.md","localizedDate":"2024ÎÖÑ 3Ïõî 16Ïùº","excerpt":"\\n","copyright":{"author":"Milan Jovanoviƒá"}}');export{H as comp,O as data};
