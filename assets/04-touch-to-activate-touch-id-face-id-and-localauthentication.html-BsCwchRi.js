import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,b as n,t as r,e as a,n as e,g as s,f as u,r as o,o as d}from"./app-BgNevrm5.js";const h={},k={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},m={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},f=n("nav",{class:"table-of-contents"},[n("ul")],-1),w=n("hr",null,null,-1),g=u(`<p>Touch ID and Face ID are part of the Local Authentication framework, and our code needs to do three things:</p><ol><li>Check whether the device is capable of supporting biometric authentication ‚Äì that the hardware is available and is configured by the user.</li><li>If so, request that the biometry system begin a check now, giving it a string containing the reason why we&#39;re asking. For Touch ID the string is written in code; for Face ID the string is written into our Info.plist file.</li><li>If we get success back from the authentication request it means this is the device&#39;s owner so we can unlock the app, otherwise we show a failure message.</li></ol><p>One caveat that you must be careful of: when we&#39;re told whether Touch ID/Face ID was successful or not, it might not be on the main thread. This means we need to use <code>async()</code> to make sure we execute any user interface code on the main thread.</p><p>The job of task 1 is done by the <code>canEvaluatePolicy()</code> method of the <code>LAContext</code> class, requesting the security policy type <code>.deviceOwnerAuthenticationWithBiometrics</code>. The job of task 2 is done by the <code>evaluatePolicy()</code> of that same class, using the same policy type, but it accepts a trailing closure telling us the result of the policy evaluation: was it successful, and if not what was the reason?</p><p>Like I said, all this is provided by the Local Authentication framework, so the first thing we need to do is import that framework. Add this above <code>import UIKit</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token class-name">LocalAuthentication</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And now here&#39;s the new code for the <code>authenticateTapped()</code> method. We already walked through what it does, so this shouldn&#39;t be too surprising:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@IBAction</span> <span class="token keyword">func</span> <span class="token function-definition function">authenticateTapped</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> sender<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token class-name">LAContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">var</span> error<span class="token punctuation">:</span> <span class="token class-name">NSError</span><span class="token operator">?</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> context<span class="token punctuation">.</span><span class="token function">canEvaluatePolicy</span><span class="token punctuation">(</span><span class="token punctuation">.</span>deviceOwnerAuthenticationWithBiometrics<span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token operator">&amp;</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> reason <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Identify yourself!&quot;</span></span></span>
<span class="line"></span>
<span class="line">        context<span class="token punctuation">.</span><span class="token function">evaluatePolicy</span><span class="token punctuation">(</span><span class="token punctuation">.</span>deviceOwnerAuthenticationWithBiometrics<span class="token punctuation">,</span> localizedReason<span class="token punctuation">:</span> reason<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> success<span class="token punctuation">,</span> authenticationError <span class="token keyword">in</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> success <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unlockSecretMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">// error</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// no biometry</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There is one important new piece of syntax in there that we haven‚Äôt used before, which is <code>&amp;error</code>. The LocalAuthentication framework uses the Objective-C approach to reporting errors back to us, which is where the <code>NSError</code> type comes from ‚Äì where Swift likes to have an enum that conforms to the <code>Error</code> protocol, Objective-C had a dedicated <code>NSError</code> type for handling errors.</p><p>Here, though, we want LocalAuthentication to tell <em>us</em> what went wrong, and it can‚Äôt do that by returning a value from the <code>canEvaluatePolicy()</code> method ‚Äì that already returns a Boolean telling us whether biometric authentication is available or not. So, instead what we use is the Objective-C equivalent of Swift‚Äôs <code>inout</code> parameters: we pass an empty <code>NSError</code> variable into our call to <code>canEvaluatePolicy()</code>, and if an error occurs that error will get filled with a real <code>NSError</code> instance telling us what went wrong.</p><p>Objective-C‚Äôs equivalent to <code>inout</code> is what‚Äôs called a <em>pointer</em>, so named because it effectively points to a place in memory where something exists rather us passing around the actual value instead. If we had passed <code>error</code> into the method, it would mean ‚Äúhere‚Äôs the error you should use.‚Äù By passing in <code>&amp;error</code> ‚Äì Objective-C‚Äôs equivalent of <code>inout</code> ‚Äì it means ‚Äúif you hit an error, here‚Äôs the place in memory where you should store that error so I can read it.‚Äù</p><p>I hope you can now see this is another example of why Swift was such a leap forward compared to Objective-C ‚Äì having to pass around pointers to things wasn‚Äôt terribly pleasant!</p><p>Apart from that, there are a couple of reminders: we need <code>[weak self]</code> inside the first closure but not the second because it&#39;s already weak by that point. You also need to use <code>self?.</code> inside the closure to make capturing clear. Finally, you must provide a reason why you want Touch ID/Face ID to be used, so you might want to replace mine (&quot;Identify yourself!&quot;) with something a little more descriptive.</p><p>You can see the ‚ÄúIdentify yourself!‚Äù string in our code, which will be shown to Touch ID users. Face ID is handled slightly differently ‚Äì open Info.plist, then add a new key called ‚ÄúPrivacy - Face ID Usage Description‚Äù. This should contain similar text to what you use with Touch ID, so give it the value ‚ÄúIdentify yourself!‚Äù.</p><p>That&#39;s enough to get basic biometric authentication working, but there are error cases you need to catch. For example, you‚Äôll hit problems if the device does not have biometric capability or it isn‚Äôt configured. Similarly, you‚Äôll get an error if the user failed authentication, which might be because their fingerprint or face wasn&#39;t scanning for whatever reason, but also if the system has to cancel scanning for some reason.</p><p>To catch authentication failure errors, replace the <code>// error</code> comment with this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Authentication failed&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;You could not be verified; please try again.&quot;</span></span><span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>alert<span class="token punctuation">)</span></span>
<span class="line">ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;OK&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We also need to show an error if biometry just isn&#39;t available, so replace the <code>// no Touch ID</code> comment with this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Biometry unavailable&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Your device is not configured for biometric authentication.&quot;</span></span><span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>alert<span class="token punctuation">)</span></span>
<span class="line">ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;OK&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That completes the authentication code, so go ahead and try running the app now. If you‚Äôre using a physical device your regular Touch ID / Face ID should work just fine, but if you‚Äôre using the Simulator there are useful options under the Hardware menu ‚Äì go to Hardware &gt; Touch ID/Face ID &gt; Toggle Enrolled State to opt in to biometric authentication, then use Hardware &gt; Touch ID/Face ID &gt; Matching Touch/Face when you‚Äôre asked for a fingerprint/face.</p>`,20);function v(i,y){const t=o("VPCard"),c=o("VidStack");return d(),l("div",null,[n("h1",k,[n("a",m,[n("span",null,r(i.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),a(t,e(s({title:"Hacking with iOS ‚Äì learn to code iPhone and iPad apps with free Swift tutorials",desc:"Learn Swift coding for iOS with these free tutorials ‚Äì learn Swift, iOS, and Xcode",link:"/hackingwithswift.com/read/README.md",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(174,10,10,0.2)"})),null,16),f,w,a(t,e(s({title:"Touch to activate: Touch ID, Face ID and LocalAuthentication | Hacking with iOS",desc:"Touch to activate: Touch ID, Face ID and LocalAuthentication",link:"https://hackingwithswift.com/read/28/4/touch-to-activate-touch-id-face-id-and-localauthentication",logo:"https://hackingwithswift.com/favicon.svg",background:"rgba(174,10,10,0.2)"})),null,16),a(c,{src:"youtube/RMst1BtMTcE"}),g])}const T=p(h,[["render",v],["__file","04-touch-to-activate-touch-id-face-id-and-localauthentication.html.vue"]]),D=JSON.parse('{"path":"/hackingwithswift.com/read/28/04-touch-to-activate-touch-id-face-id-and-localauthentication.html","title":"Touch to activate: Touch ID, Face ID and LocalAuthentication","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Touch to activate: Touch ID, Face ID and LocalAuthentication","description":"Article(s) > Touch to activate: Touch ID, Face ID and LocalAuthentication","category":["Swift","iOS","Article(s)"],"tag":["blog","hackingwithswift.com","crashcourse","swift","xcode","appstore","ios"],"head":[[{"meta":null},{"property":"og:title","content":"Article(s) > Touch to activate: Touch ID, Face ID and LocalAuthentication"},{"property":"og:description","content":"Touch to activate: Touch ID, Face ID and LocalAuthentication"},{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/read/28/04-touch-to-activate-touch-id-face-id-and-localauthentication.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/bookshelf/hackingwithswift.com/read/28/04-touch-to-activate-touch-id-face-id-and-localauthentication.html"}],["meta",{"property":"og:site_name","content":"üìöBookshelf"}],["meta",{"property":"og:title","content":"Touch to activate: Touch ID, Face ID and LocalAuthentication"}],["meta",{"property":"og:description","content":"Article(s) > Touch to activate: Touch ID, Face ID and LocalAuthentication"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:tag","content":"hackingwithswift.com"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:tag","content":"ios"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Touch to activate: Touch ID, Face ID and LocalAuthentication\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]],"isOriginal":false},"headers":[],"git":{"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":2}]},"readingTime":{"minutes":3.83,"words":1149},"filePathRelative":"hackingwithswift.com/read/28/04-touch-to-activate-touch-id-face-id-and-localauthentication.md","excerpt":"\\n"}');export{T as comp,D as data};
